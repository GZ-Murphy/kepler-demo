"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _moment = _interopRequireDefault(require("moment"));

var _window = require("global/window");

var _slider = _interopRequireDefault(require("../slider/slider"));

var _styledComponents2 = require("../styled-components");

var _speedControl = _interopRequireDefault(require("./speed-control"));

var _playbackControls = _interopRequireDefault(require("./playback-controls"));

var _floatingTimeDisplay = _interopRequireDefault(require("./floating-time-display"));

var _defaultSettings = require("../../../constants/default-settings");

function _templateObject3() {
  var data = (0, _taggedTemplateLiteral2["default"])(["\n  color: ", ";\n  font-weight: 400;\n  font-size: 10px;\n"]);

  _templateObject3 = function _templateObject3() {
    return data;
  };

  return data;
}

function _templateObject2() {
  var data = (0, _taggedTemplateLiteral2["default"])(["\n  position: relative;\n  display: flex;\n  align-items: center;\n  height: 32px;\n\n  .animation-control__speed-control {\n    margin-right: -10px;\n\n    .animation-control__speed-slider {\n      right: calc(0% - 10px);\n    }\n  }\n"]);

  _templateObject2 = function _templateObject2() {
    return data;
  };

  return data;
}

function _templateObject() {
  var data = (0, _taggedTemplateLiteral2["default"])(["\n  display: flex;\n  position: relative;\n  flex-grow: 1;\n  margin-right: 24px;\n  margin-left: 24px;\n"]);

  _templateObject = function _templateObject() {
    return data;
  };

  return data;
}

var SliderWrapper = _styledComponents["default"].div(_templateObject());

var AnimationWidgetInner = _styledComponents["default"].div(_templateObject2());

var StyledDomain = _styledComponents["default"].div(_templateObject3(), function (props) {
  return props.theme.titleTextColor;
});

var defaultTimeFormat = 'MM/DD/YY hh:mm:ss';
var BUTTON_HEIGHT = '18px';
AnimationControlFactory.deps = [_speedControl["default"], _playbackControls["default"], _floatingTimeDisplay["default"]];

function AnimationControlFactory(SpeedControl, AnimationPlaybacks, FloatingTimeDisplay) {
  var AnimationControl =
  /*#__PURE__*/
  function (_Component) {
    (0, _inherits2["default"])(AnimationControl, _Component);

    function AnimationControl(props) {
      var _this;

      (0, _classCallCheck2["default"])(this, AnimationControl);
      _this = (0, _possibleConstructorReturn2["default"])(this, (0, _getPrototypeOf2["default"])(AnimationControl).call(this, props));
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onSlider1Change", function (val) {
        var domain = _this.props.animationConfig.domain;

        if (val >= domain[0] && val <= domain[1]) {
          _this.props.updateAnimationTime(val);
        }
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "_updateAnimationTime", function () {
        var domain = _this.props.animationConfig.domain;

        _this.props.updateAnimationTime(domain[0]);

        _this._startAnimation();
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "_startAnimation", function () {
        _this._pauseAnimation();

        _this.setState({
          isAnimating: true
        });
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "_nextFrame", function () {
        _this._animation = null;
        var _this$props$animation = _this.props.animationConfig,
            currentTime = _this$props$animation.currentTime,
            domain = _this$props$animation.domain,
            _this$props$animation2 = _this$props$animation.speed,
            speed = _this$props$animation2 === void 0 ? 1 : _this$props$animation2;
        var adjustedSpeed = (domain[1] - domain[0]) / _defaultSettings.BASE_SPEED * speed;
        var nextTime = currentTime + speed > domain[1] ? domain[0] : currentTime + adjustedSpeed;

        _this.props.updateAnimationTime(nextTime);
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "_pauseAnimation", function () {
        if (_this._animation) {
          (0, _window.cancelAnimationFrame)(_this._animation);
          _this._animation = null;
        }

        _this.setState({
          isAnimating: false
        });
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "toggleSpeedControl", function () {
        _this.setState({
          showSpeedControl: !_this.state.showSpeedControl
        });
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "onChange", function () {
        _this.toggleSpeedControl();
      });
      _this.state = {
        isAnimating: false,
        width: 288,
        showSpeedControl: false
      };
      _this._animation = null;
      return _this;
    }

    (0, _createClass2["default"])(AnimationControl, [{
      key: "componentDidUpdate",
      value: function componentDidUpdate() {
        if (!this._animation && this.state.isAnimating) {
          this._animation = (0, _window.requestAnimationFrame)(this._nextFrame);
        }
      }
    }, {
      key: "render",
      value: function render() {
        var _this$props$animation3 = this.props.animationConfig,
            currentTime = _this$props$animation3.currentTime,
            domain = _this$props$animation3.domain,
            speed = _this$props$animation3.speed;
        var showSpeedControl = this.state.showSpeedControl;
        return _react["default"].createElement(_styledComponents2.BottomWidgetInner, {
          className: "bottom-widget--inner"
        }, _react["default"].createElement(AnimationWidgetInner, {
          className: "animation-widget--inner"
        }, _react["default"].createElement("div", {
          style: {
            marginLeft: '-10px'
          }
        }, _react["default"].createElement(AnimationPlaybacks, {
          className: "animation-control-playpause",
          startAnimation: this._startAnimation,
          isAnimating: this.state.isAnimating,
          pauseAnimation: this._pauseAnimation,
          resetAnimation: this._resetAnimation,
          buttonHeight: BUTTON_HEIGHT,
          buttonStyle: "link"
        })), _react["default"].createElement(StyledDomain, {
          className: "animation-control__time-domain"
        }, _react["default"].createElement("span", null, _moment["default"].utc(domain[0]).format(defaultTimeFormat))), _react["default"].createElement(SliderWrapper, {
          className: "animation-control__slider"
        }, _react["default"].createElement(_slider["default"], {
          showValues: false,
          isRanged: false,
          minValue: domain ? domain[0] : 0,
          maxValue: domain ? domain[1] : 1,
          value1: currentTime,
          onSlider1Change: this.onSlider1Change,
          enableBarDrag: true
        })), _react["default"].createElement(StyledDomain, {
          className: "animation-control__time-domain"
        }, _react["default"].createElement("span", null, _moment["default"].utc(domain[1]).format(defaultTimeFormat))), _react["default"].createElement("div", {
          className: "animation-control__speed-control"
        }, _react["default"].createElement(SpeedControl, {
          onClick: this.toggleSpeedControl,
          showSpeedControl: showSpeedControl,
          updateAnimationSpeed: this.props.updateAnimationSpeed,
          speed: speed,
          buttonHeight: BUTTON_HEIGHT
        }))), _react["default"].createElement(FloatingTimeDisplay, {
          currentTime: currentTime
        }));
      }
    }]);
    return AnimationControl;
  }(_react.Component);

  AnimationControl.defaultProps = {
    sliderHandleWidth: 12,
    onChange: function onChange() {}
  };
  return AnimationControl;
}

var _default = AnimationControlFactory;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL2NvbW1vbi9hbmltYXRpb24tY29udHJvbC9hbmltYXRpb24tY29udHJvbC5qcyJdLCJuYW1lcyI6WyJTbGlkZXJXcmFwcGVyIiwic3R5bGVkIiwiZGl2IiwiQW5pbWF0aW9uV2lkZ2V0SW5uZXIiLCJTdHlsZWREb21haW4iLCJwcm9wcyIsInRoZW1lIiwidGl0bGVUZXh0Q29sb3IiLCJkZWZhdWx0VGltZUZvcm1hdCIsIkJVVFRPTl9IRUlHSFQiLCJBbmltYXRpb25Db250cm9sRmFjdG9yeSIsImRlcHMiLCJTcGVlZENvbnRyb2xGYWN0b3J5IiwiQW5pbWF0aW9uUGxheWJhY2tzRmFjdG9yeSIsIkZsb2F0aW5nVGltZURpc3BsYXlGYWN0b3J5IiwiU3BlZWRDb250cm9sIiwiQW5pbWF0aW9uUGxheWJhY2tzIiwiRmxvYXRpbmdUaW1lRGlzcGxheSIsIkFuaW1hdGlvbkNvbnRyb2wiLCJ2YWwiLCJkb21haW4iLCJhbmltYXRpb25Db25maWciLCJ1cGRhdGVBbmltYXRpb25UaW1lIiwiX3N0YXJ0QW5pbWF0aW9uIiwiX3BhdXNlQW5pbWF0aW9uIiwic2V0U3RhdGUiLCJpc0FuaW1hdGluZyIsIl9hbmltYXRpb24iLCJjdXJyZW50VGltZSIsInNwZWVkIiwiYWRqdXN0ZWRTcGVlZCIsIkJBU0VfU1BFRUQiLCJuZXh0VGltZSIsInNob3dTcGVlZENvbnRyb2wiLCJzdGF0ZSIsInRvZ2dsZVNwZWVkQ29udHJvbCIsIndpZHRoIiwiX25leHRGcmFtZSIsIm1hcmdpbkxlZnQiLCJfcmVzZXRBbmltYXRpb24iLCJtb21lbnQiLCJ1dGMiLCJmb3JtYXQiLCJvblNsaWRlcjFDaGFuZ2UiLCJ1cGRhdGVBbmltYXRpb25TcGVlZCIsIkNvbXBvbmVudCIsImRlZmF1bHRQcm9wcyIsInNsaWRlckhhbmRsZVdpZHRoIiwib25DaGFuZ2UiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9CQTs7QUFD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QUFsQyxVQXhDRixDQURGO0FBNENEO0FBL0dIO0FBQUE7QUFBQSxJQUMrQmlCLGdCQUQvQjs7QUFrSEEzQixFQUFBQSxnQkFBZ0IsQ0FBQzRCLFlBQWpCLEdBQWdDO0FBQzlCQyxJQUFBQSxpQkFBaUIsRUFBRSxFQURXO0FBRTlCQyxJQUFBQSxRQUFRLEVBQUUsb0JBQU0sQ0FBRTtBQUZZLEdBQWhDO0FBS0EsU0FBTzlCLGdCQUFQO0FBQ0Q7O2VBRWNSLHVCIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSAyMDE5IFViZXIgVGVjaG5vbG9naWVzLCBJbmMuXG4vL1xuLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxuLy8gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuLy8gaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xuLy8gdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuLy8gY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG4vLyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuLy9cbi8vIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluXG4vLyBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cbi8vXG4vLyBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG4vLyBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbi8vIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuLy8gQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuLy8gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbi8vIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU5cbi8vIFRIRSBTT0ZUV0FSRS5cblxuaW1wb3J0IFJlYWN0LCB7Q29tcG9uZW50fSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgc3R5bGVkIGZyb20gJ3N0eWxlZC1jb21wb25lbnRzJztcbmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JztcbmltcG9ydCB7cmVxdWVzdEFuaW1hdGlvbkZyYW1lLCBjYW5jZWxBbmltYXRpb25GcmFtZX0gZnJvbSAnZ2xvYmFsL3dpbmRvdyc7XG5cbmltcG9ydCBTbGlkZXIgZnJvbSAnY29tcG9uZW50cy9jb21tb24vc2xpZGVyL3NsaWRlcic7XG5pbXBvcnQge0JvdHRvbVdpZGdldElubmVyfSBmcm9tICdjb21wb25lbnRzL2NvbW1vbi9zdHlsZWQtY29tcG9uZW50cyc7XG5pbXBvcnQgU3BlZWRDb250cm9sRmFjdG9yeSBmcm9tICcuL3NwZWVkLWNvbnRyb2wnO1xuaW1wb3J0IEFuaW1hdGlvblBsYXliYWNrc0ZhY3RvcnkgZnJvbSAnLi9wbGF5YmFjay1jb250cm9scyc7XG5pbXBvcnQgRmxvYXRpbmdUaW1lRGlzcGxheUZhY3RvcnkgZnJvbSAnLi9mbG9hdGluZy10aW1lLWRpc3BsYXknO1xuaW1wb3J0IHtCQVNFX1NQRUVEfSBmcm9tICdjb25zdGFudHMvZGVmYXVsdC1zZXR0aW5ncyc7XG5cbmNvbnN0IFNsaWRlcldyYXBwZXIgPSBzdHlsZWQuZGl2YFxuICBkaXNwbGF5OiBmbGV4O1xuICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gIGZsZXgtZ3JvdzogMTtcbiAgbWFyZ2luLXJpZ2h0OiAyNHB4O1xuICBtYXJnaW4tbGVmdDogMjRweDtcbmA7XG5cbmNvbnN0IEFuaW1hdGlvbldpZGdldElubmVyID0gc3R5bGVkLmRpdmBcbiAgcG9zaXRpb246IHJlbGF0aXZlO1xuICBkaXNwbGF5OiBmbGV4O1xuICBhbGlnbi1pdGVtczogY2VudGVyO1xuICBoZWlnaHQ6IDMycHg7XG5cbiAgLmFuaW1hdGlvbi1jb250cm9sX19zcGVlZC1jb250cm9sIHtcbiAgICBtYXJnaW4tcmlnaHQ6IC0xMHB4O1xuXG4gICAgLmFuaW1hdGlvbi1jb250cm9sX19zcGVlZC1zbGlkZXIge1xuICAgICAgcmlnaHQ6IGNhbGMoMCUgLSAxMHB4KTtcbiAgICB9XG4gIH1cbmA7XG5cbmNvbnN0IFN0eWxlZERvbWFpbiA9IHN0eWxlZC5kaXZgXG4gIGNvbG9yOiAke3Byb3BzID0+IHByb3BzLnRoZW1lLnRpdGxlVGV4dENvbG9yfTtcbiAgZm9udC13ZWlnaHQ6IDQwMDtcbiAgZm9udC1zaXplOiAxMHB4O1xuYDtcblxuY29uc3QgZGVmYXVsdFRpbWVGb3JtYXQgPSAnTU0vREQvWVkgaGg6bW06c3MnO1xuY29uc3QgQlVUVE9OX0hFSUdIVCA9ICcxOHB4JztcblxuQW5pbWF0aW9uQ29udHJvbEZhY3RvcnkuZGVwcyA9IFtcbiAgU3BlZWRDb250cm9sRmFjdG9yeSxcbiAgQW5pbWF0aW9uUGxheWJhY2tzRmFjdG9yeSxcbiAgRmxvYXRpbmdUaW1lRGlzcGxheUZhY3Rvcnlcbl07XG5cbmZ1bmN0aW9uIEFuaW1hdGlvbkNvbnRyb2xGYWN0b3J5KFxuICBTcGVlZENvbnRyb2wsXG4gIEFuaW1hdGlvblBsYXliYWNrcyxcbiAgRmxvYXRpbmdUaW1lRGlzcGxheVxuKSB7XG4gIGNsYXNzIEFuaW1hdGlvbkNvbnRyb2wgZXh0ZW5kcyBDb21wb25lbnQge1xuICAgIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgICBzdXBlcihwcm9wcyk7XG4gICAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgICBpc0FuaW1hdGluZzogZmFsc2UsXG4gICAgICAgIHdpZHRoOiAyODgsXG4gICAgICAgIHNob3dTcGVlZENvbnRyb2w6IGZhbHNlXG4gICAgICB9O1xuICAgICAgdGhpcy5fYW5pbWF0aW9uID0gbnVsbDtcbiAgICB9XG5cbiAgICBjb21wb25lbnREaWRVcGRhdGUoKSB7XG4gICAgICBpZiAoIXRoaXMuX2FuaW1hdGlvbiAmJiB0aGlzLnN0YXRlLmlzQW5pbWF0aW5nKSB7XG4gICAgICAgIHRoaXMuX2FuaW1hdGlvbiA9IHJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLl9uZXh0RnJhbWUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIG9uU2xpZGVyMUNoYW5nZSA9IHZhbCA9PiB7XG4gICAgICBjb25zdCB7ZG9tYWlufSA9IHRoaXMucHJvcHMuYW5pbWF0aW9uQ29uZmlnO1xuICAgICAgaWYgKHZhbCA+PSBkb21haW5bMF0gJiYgdmFsIDw9IGRvbWFpblsxXSkge1xuICAgICAgICB0aGlzLnByb3BzLnVwZGF0ZUFuaW1hdGlvblRpbWUodmFsKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgX3VwZGF0ZUFuaW1hdGlvblRpbWUgPSAoKSA9PiB7XG4gICAgICBjb25zdCB7ZG9tYWlufSA9IHRoaXMucHJvcHMuYW5pbWF0aW9uQ29uZmlnO1xuICAgICAgdGhpcy5wcm9wcy51cGRhdGVBbmltYXRpb25UaW1lKGRvbWFpblswXSk7XG4gICAgICB0aGlzLl9zdGFydEFuaW1hdGlvbigpO1xuICAgIH07XG5cbiAgICBfc3RhcnRBbmltYXRpb24gPSAoKSA9PiB7XG4gICAgICB0aGlzLl9wYXVzZUFuaW1hdGlvbigpO1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7aXNBbmltYXRpbmc6IHRydWV9KTtcbiAgICB9O1xuXG4gICAgX25leHRGcmFtZSA9ICgpID0+IHtcbiAgICAgIHRoaXMuX2FuaW1hdGlvbiA9IG51bGw7XG4gICAgICBjb25zdCB7Y3VycmVudFRpbWUsIGRvbWFpbiwgc3BlZWQgPSAxfSA9IHRoaXMucHJvcHMuYW5pbWF0aW9uQ29uZmlnO1xuICAgICAgY29uc3QgYWRqdXN0ZWRTcGVlZCA9ICgoZG9tYWluWzFdIC0gZG9tYWluWzBdKSAvIEJBU0VfU1BFRUQpICogc3BlZWQ7XG4gICAgICBjb25zdCBuZXh0VGltZSA9XG4gICAgICAgIGN1cnJlbnRUaW1lICsgc3BlZWQgPiBkb21haW5bMV1cbiAgICAgICAgICA/IGRvbWFpblswXVxuICAgICAgICAgIDogY3VycmVudFRpbWUgKyBhZGp1c3RlZFNwZWVkO1xuICAgICAgdGhpcy5wcm9wcy51cGRhdGVBbmltYXRpb25UaW1lKG5leHRUaW1lKTtcbiAgICB9O1xuXG4gICAgX3BhdXNlQW5pbWF0aW9uID0gKCkgPT4ge1xuICAgICAgaWYgKHRoaXMuX2FuaW1hdGlvbikge1xuICAgICAgICBjYW5jZWxBbmltYXRpb25GcmFtZSh0aGlzLl9hbmltYXRpb24pO1xuICAgICAgICB0aGlzLl9hbmltYXRpb24gPSBudWxsO1xuICAgICAgfVxuICAgICAgdGhpcy5zZXRTdGF0ZSh7aXNBbmltYXRpbmc6IGZhbHNlfSk7XG4gICAgfTtcblxuICAgIHRvZ2dsZVNwZWVkQ29udHJvbCA9ICgpID0+IHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoe3Nob3dTcGVlZENvbnRyb2w6ICF0aGlzLnN0YXRlLnNob3dTcGVlZENvbnRyb2x9KTtcbiAgICB9O1xuXG4gICAgb25DaGFuZ2UgPSAoKSA9PiB7XG4gICAgICB0aGlzLnRvZ2dsZVNwZWVkQ29udHJvbCgpO1xuICAgIH07XG5cbiAgICByZW5kZXIoKSB7XG4gICAgICBjb25zdCB7Y3VycmVudFRpbWUsIGRvbWFpbiwgc3BlZWR9ID0gdGhpcy5wcm9wcy5hbmltYXRpb25Db25maWc7XG4gICAgICBjb25zdCB7c2hvd1NwZWVkQ29udHJvbH0gPSB0aGlzLnN0YXRlO1xuXG4gICAgICByZXR1cm4gKFxuICAgICAgICA8Qm90dG9tV2lkZ2V0SW5uZXIgY2xhc3NOYW1lPVwiYm90dG9tLXdpZGdldC0taW5uZXJcIj5cbiAgICAgICAgICA8QW5pbWF0aW9uV2lkZ2V0SW5uZXIgY2xhc3NOYW1lPVwiYW5pbWF0aW9uLXdpZGdldC0taW5uZXJcIj5cbiAgICAgICAgICAgIDxkaXYgc3R5bGU9e3ttYXJnaW5MZWZ0OiAnLTEwcHgnfX0+XG4gICAgICAgICAgICAgIDxBbmltYXRpb25QbGF5YmFja3NcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJhbmltYXRpb24tY29udHJvbC1wbGF5cGF1c2VcIlxuICAgICAgICAgICAgICAgIHN0YXJ0QW5pbWF0aW9uPXt0aGlzLl9zdGFydEFuaW1hdGlvbn1cbiAgICAgICAgICAgICAgICBpc0FuaW1hdGluZz17dGhpcy5zdGF0ZS5pc0FuaW1hdGluZ31cbiAgICAgICAgICAgICAgICBwYXVzZUFuaW1hdGlvbj17dGhpcy5fcGF1c2VBbmltYXRpb259XG4gICAgICAgICAgICAgICAgcmVzZXRBbmltYXRpb249e3RoaXMuX3Jlc2V0QW5pbWF0aW9ufVxuICAgICAgICAgICAgICAgIGJ1dHRvbkhlaWdodD17QlVUVE9OX0hFSUdIVH1cbiAgICAgICAgICAgICAgICBidXR0b25TdHlsZT1cImxpbmtcIlxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8U3R5bGVkRG9tYWluIGNsYXNzTmFtZT1cImFuaW1hdGlvbi1jb250cm9sX190aW1lLWRvbWFpblwiPlxuICAgICAgICAgICAgICA8c3Bhbj57bW9tZW50LnV0Yyhkb21haW5bMF0pLmZvcm1hdChkZWZhdWx0VGltZUZvcm1hdCl9PC9zcGFuPlxuICAgICAgICAgICAgPC9TdHlsZWREb21haW4+XG4gICAgICAgICAgICA8U2xpZGVyV3JhcHBlciBjbGFzc05hbWU9XCJhbmltYXRpb24tY29udHJvbF9fc2xpZGVyXCI+XG4gICAgICAgICAgICAgIDxTbGlkZXJcbiAgICAgICAgICAgICAgICBzaG93VmFsdWVzPXtmYWxzZX1cbiAgICAgICAgICAgICAgICBpc1JhbmdlZD17ZmFsc2V9XG4gICAgICAgICAgICAgICAgbWluVmFsdWU9e2RvbWFpbiA/IGRvbWFpblswXSA6IDB9XG4gICAgICAgICAgICAgICAgbWF4VmFsdWU9e2RvbWFpbiA/IGRvbWFpblsxXSA6IDF9XG4gICAgICAgICAgICAgICAgdmFsdWUxPXtjdXJyZW50VGltZX1cbiAgICAgICAgICAgICAgICBvblNsaWRlcjFDaGFuZ2U9e3RoaXMub25TbGlkZXIxQ2hhbmdlfVxuICAgICAgICAgICAgICAgIGVuYWJsZUJhckRyYWc9e3RydWV9XG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8L1NsaWRlcldyYXBwZXI+XG4gICAgICAgICAgICA8U3R5bGVkRG9tYWluIGNsYXNzTmFtZT1cImFuaW1hdGlvbi1jb250cm9sX190aW1lLWRvbWFpblwiPlxuICAgICAgICAgICAgICA8c3Bhbj57bW9tZW50LnV0Yyhkb21haW5bMV0pLmZvcm1hdChkZWZhdWx0VGltZUZvcm1hdCl9PC9zcGFuPlxuICAgICAgICAgICAgPC9TdHlsZWREb21haW4+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImFuaW1hdGlvbi1jb250cm9sX19zcGVlZC1jb250cm9sXCI+XG4gICAgICAgICAgICAgIDxTcGVlZENvbnRyb2xcbiAgICAgICAgICAgICAgICBvbkNsaWNrPXt0aGlzLnRvZ2dsZVNwZWVkQ29udHJvbH1cbiAgICAgICAgICAgICAgICBzaG93U3BlZWRDb250cm9sPXtzaG93U3BlZWRDb250cm9sfVxuICAgICAgICAgICAgICAgIHVwZGF0ZUFuaW1hdGlvblNwZWVkPXt0aGlzLnByb3BzLnVwZGF0ZUFuaW1hdGlvblNwZWVkfVxuICAgICAgICAgICAgICAgIHNwZWVkPXtzcGVlZH1cbiAgICAgICAgICAgICAgICBidXR0b25IZWlnaHQ9e0JVVFRPTl9IRUlHSFR9XG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L0FuaW1hdGlvbldpZGdldElubmVyPlxuICAgICAgICAgIDxGbG9hdGluZ1RpbWVEaXNwbGF5IGN1cnJlbnRUaW1lPXtjdXJyZW50VGltZX0gLz5cbiAgICAgICAgPC9Cb3R0b21XaWRnZXRJbm5lcj5cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgQW5pbWF0aW9uQ29udHJvbC5kZWZhdWx0UHJvcHMgPSB7XG4gICAgc2xpZGVySGFuZGxlV2lkdGg6IDEyLFxuICAgIG9uQ2hhbmdlOiAoKSA9PiB7fVxuICB9O1xuXG4gIHJldHVybiBBbmltYXRpb25Db250cm9sO1xufVxuXG5leHBvcnQgZGVmYXVsdCBBbmltYXRpb25Db250cm9sRmFjdG9yeTtcbiJdfQ==