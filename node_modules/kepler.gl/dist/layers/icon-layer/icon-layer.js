"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = exports.pointVisConfigs = exports.iconRequiredColumns = exports.iconResolver = exports.iconAccessor = exports.iconPosResolver = exports.iconPosAccessor = exports.SVG_ICON_URL = void 0;

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf2 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _get2 = _interopRequireDefault(require("@babel/runtime/helpers/get"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _baseLayer = _interopRequireDefault(require("../base-layer"));

var _lodash = _interopRequireDefault(require("lodash.memoize"));

var _window = _interopRequireDefault(require("global/window"));

var _colorUtils = require("../../utils/color-utils");

var _svgIconLayer = _interopRequireDefault(require("../../deckgl-layers/svg-icon-layer/svg-icon-layer"));

var _iconLayerIcon = _interopRequireDefault(require("./icon-layer-icon"));

var _defaultSettings = require("../../constants/default-settings");

var _iconInfoModal = _interopRequireDefault(require("./icon-info-modal"));

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var SVG_ICON_URL = "".concat(_defaultSettings.CLOUDFRONT, "/icons/svg-icons.json");
exports.SVG_ICON_URL = SVG_ICON_URL;

var iconPosAccessor = function iconPosAccessor(_ref) {
  var lat = _ref.lat,
      lng = _ref.lng;
  return function (d) {
    return [d.data[lng.fieldIdx], d.data[lat.fieldIdx]];
  };
};

exports.iconPosAccessor = iconPosAccessor;

var iconPosResolver = function iconPosResolver(_ref2) {
  var lat = _ref2.lat,
      lng = _ref2.lng;
  return "".concat(lat.fieldIdx, "-").concat(lng.fieldIdx);
};

exports.iconPosResolver = iconPosResolver;

var iconAccessor = function iconAccessor(_ref3) {
  var icon = _ref3.icon;
  return function (d) {
    return d.data[icon.fieldIdx];
  };
};

exports.iconAccessor = iconAccessor;

var iconResolver = function iconResolver(_ref4) {
  var icon = _ref4.icon;
  return icon.fieldIdx;
};

exports.iconResolver = iconResolver;
var iconRequiredColumns = ['lat', 'lng', 'icon'];
exports.iconRequiredColumns = iconRequiredColumns;
var pointVisConfigs = {
  radius: 'radius',
  fixedRadius: 'fixedRadius',
  opacity: 'opacity',
  colorRange: 'colorRange',
  radiusRange: 'radiusRange'
};
exports.pointVisConfigs = pointVisConfigs;

var IconLayer =
/*#__PURE__*/
function (_Layer) {
  (0, _inherits2["default"])(IconLayer, _Layer);

  function IconLayer(props) {
    var _this;

    (0, _classCallCheck2["default"])(this, IconLayer);
    _this = (0, _possibleConstructorReturn2["default"])(this, (0, _getPrototypeOf2["default"])(IconLayer).call(this, props));

    _this.registerVisConfig(pointVisConfigs);

    _this.getPosition = (0, _lodash["default"])(iconPosAccessor, iconPosResolver);
    _this.getIcon = (0, _lodash["default"])(iconAccessor, iconResolver); // prepare layer info modal

    _this._layerInfoModal = (0, _iconInfoModal["default"])();

    _this.getSvgIcons();

    return _this;
  }

  (0, _createClass2["default"])(IconLayer, [{
    key: "getSvgIcons",
    value: function () {
      var _getSvgIcons = (0, _asyncToGenerator2["default"])(
      /*#__PURE__*/
      _regenerator["default"].mark(function _callee() {
        var fetchConfig, response, _ref5, svgIcons;

        return _regenerator["default"].wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                fetchConfig = {
                  method: 'GET',
                  mode: 'cors',
                  cache: 'no-cache'
                };

                if (!_window["default"].fetch) {
                  _context.next = 11;
                  break;
                }

                _context.next = 4;
                return _window["default"].fetch(SVG_ICON_URL, fetchConfig);

              case 4:
                response = _context.sent;
                _context.next = 7;
                return response.json();

              case 7:
                _ref5 = _context.sent;
                svgIcons = _ref5.svgIcons;
                this.iconGeometry = svgIcons.reduce(function (accu, curr) {
                  return _objectSpread({}, accu, (0, _defineProperty2["default"])({}, curr.id, curr.mesh.cells.reduce(function (prev, cell) {
                    cell.forEach(function (p) {
                      Array.prototype.push.apply(prev, curr.mesh.positions[p]);
                    });
                    return prev;
                  }, [])));
                }, {});
                this._layerInfoModal = (0, _iconInfoModal["default"])(svgIcons);

              case 11:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, this);
      }));

      function getSvgIcons() {
        return _getSvgIcons.apply(this, arguments);
      }

      return getSvgIcons;
    }()
  }, {
    key: "formatLayerData",
    // TODO: fix complexity

    /* eslint-disable complexity */
    value: function formatLayerData(_, allData, filteredIndex, oldLayerData) {
      var _this2 = this;

      var opt = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};
      var _this$config = this.config,
          colorScale = _this$config.colorScale,
          colorDomain = _this$config.colorDomain,
          colorField = _this$config.colorField,
          color = _this$config.color,
          columns = _this$config.columns,
          sizeField = _this$config.sizeField,
          sizeScale = _this$config.sizeScale,
          sizeDomain = _this$config.sizeDomain,
          _this$config$visConfi = _this$config.visConfig,
          radiusRange = _this$config$visConfi.radiusRange,
          colorRange = _this$config$visConfi.colorRange; // point color

      var cScale = colorField && this.getVisChannelScale(colorScale, colorDomain, colorRange.colors.map(_colorUtils.hexToRgb)); // point radius

      var rScale = sizeField && this.getVisChannelScale(sizeScale, sizeDomain, radiusRange, 0);
      var getPosition = this.getPosition(columns);
      var getIcon = this.getIcon(columns);

      if (!oldLayerData || oldLayerData.getPosition !== getPosition) {
        this.updateLayerMeta(allData, getPosition);
      }

      var data;

      if (oldLayerData && oldLayerData.data && opt.sameData && oldLayerData.getPosition === getPosition && oldLayerData.getIcon === getIcon) {
        data = oldLayerData.data;
      } else {
        data = filteredIndex.reduce(function (accu, index) {
          var pos = getPosition({
            data: allData[index]
          });
          var icon = getIcon({
            data: allData[index]
          }); // if doesn't have point lat or lng, do not add the point
          // deck.gl can't handle position = null

          if (!pos.every(Number.isFinite) || typeof icon !== 'string') {
            return accu;
          }

          accu.push({
            index: index,
            icon: icon,
            data: allData[index]
          });
          return accu;
        }, []);
      }

      var getRadius = rScale ? function (d) {
        return _this2.getEncodedChannelValue(rScale, d.data, sizeField, 0);
      } : 1;
      var getColor = cScale ? function (d) {
        return _this2.getEncodedChannelValue(cScale, d.data, colorField);
      } : color;
      return {
        data: data,
        getPosition: getPosition,
        getIcon: getIcon,
        getColor: getColor,
        getRadius: getRadius
      };
    }
    /* eslint-enable complexity */

  }, {
    key: "updateLayerMeta",
    value: function updateLayerMeta(allData, getPosition) {
      var bounds = this.getPointsBounds(allData, function (d) {
        return getPosition({
          data: d
        });
      });
      this.updateMeta({
        bounds: bounds
      });
    }
  }, {
    key: "renderLayer",
    value: function renderLayer(_ref6) {
      var _this3 = this;

      var data = _ref6.data,
          idx = _ref6.idx,
          objectHovered = _ref6.objectHovered,
          mapState = _ref6.mapState,
          interactionConfig = _ref6.interactionConfig,
          layerInteraction = _ref6.layerInteraction;

      var layerProps = _objectSpread({
        radiusMinPixels: 1,
        radiusScale: this.getRadiusScaleByZoom(mapState)
      }, this.config.visConfig.fixedRadius ? {} : {
        radiusMaxPixels: 500
      });

      return !this.iconGeometry ? [] : [new _svgIconLayer["default"](_objectSpread({}, layerProps, {}, data, {}, layerInteraction, {
        id: this.id,
        idx: idx,
        opacity: this.config.visConfig.opacity,
        getIconGeometry: function getIconGeometry(id) {
          return _this3.iconGeometry[id];
        },
        // picking
        autoHighlight: true,
        highlightColor: this.config.highlightColor,
        pickable: true,
        // parameters
        parameters: {
          depthTest: mapState.dragRotate
        },
        // update triggers
        updateTriggers: {
          getRadius: {
            sizeField: this.config.colorField,
            radiusRange: this.config.visConfig.radiusRange,
            sizeScale: this.config.sizeScale
          },
          getColor: {
            color: this.config.color,
            colorField: this.config.colorField,
            colorRange: this.config.visConfig.colorRange,
            colorScale: this.config.colorScale
          }
        }
      }))].concat((0, _toConsumableArray2["default"])(this.isLayerHovered(objectHovered) ? [new _svgIconLayer["default"](_objectSpread({}, layerProps, {
        id: "".concat(this.id, "-hovered"),
        data: [objectHovered.object],
        getPosition: data.getPosition,
        getRadius: data.getRadius,
        getColor: this.config.highlightColor,
        getIconGeometry: function getIconGeometry(id) {
          return _this3.iconGeometry[id];
        },
        pickable: false
      }))] : []));
    }
  }, {
    key: "type",
    get: function get() {
      return 'icon';
    }
  }, {
    key: "requiredLayerColumns",
    get: function get() {
      return iconRequiredColumns;
    }
  }, {
    key: "columnPairs",
    get: function get() {
      return this.defaultPointColumnPairs;
    }
  }, {
    key: "layerIcon",
    get: function get() {
      return _iconLayerIcon["default"];
    }
  }, {
    key: "visualChannels",
    get: function get() {
      return _objectSpread({}, (0, _get2["default"])((0, _getPrototypeOf2["default"])(IconLayer.prototype), "visualChannels", this), {
        size: _objectSpread({}, (0, _get2["default"])((0, _getPrototypeOf2["default"])(IconLayer.prototype), "visualChannels", this).size, {
          range: 'radiusRange',
          property: 'radius',
          channelScaleType: 'radius'
        })
      });
    }
  }, {
    key: "layerInfoModal",
    get: function get() {
      return {
        id: 'iconInfo',
        template: this._layerInfoModal,
        modalProps: {
          title: 'How to draw icons'
        }
      };
    }
  }], [{
    key: "findDefaultLayerProps",
    value: function findDefaultLayerProps(_ref7) {
      var _ref7$fieldPairs = _ref7.fieldPairs,
          fieldPairs = _ref7$fieldPairs === void 0 ? [] : _ref7$fieldPairs,
          _ref7$fields = _ref7.fields,
          fields = _ref7$fields === void 0 ? [] : _ref7$fields;
      var notFound = {
        props: []
      };

      if (!fieldPairs.length || !fields.length) {
        return notFound;
      }

      var iconFields = fields.filter(function (_ref8) {
        var name = _ref8.name;
        return name.replace(/[_,.]+/g, ' ').trim().split(' ').some(function (seg) {
          return _defaultSettings.ICON_FIELDS.icon.some(function (t) {
            return t.includes(seg);
          });
        });
      });

      if (!iconFields.length) {
        return notFound;
      } // create icon layers for first point pair


      var ptPair = fieldPairs[0];
      var props = iconFields.map(function (iconField) {
        return {
          label: iconField.name.replace(/[_,.]+/g, ' ').trim(),
          columns: {
            lat: ptPair.pair.lat,
            lng: ptPair.pair.lng,
            icon: {
              value: iconField.name,
              fieldIdx: iconField.tableFieldIndex - 1
            }
          },
          isVisible: true
        };
      });
      return {
        props: props
      };
    }
  }]);
  return IconLayer;
}(_baseLayer["default"]);

exports["default"] = IconLayer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9sYXllcnMvaWNvbi1sYXllci9pY29uLWxheWVyLmpzIl0sIm5hbWVzIjpbIlNWR19JQ09OX1VSTCIsIkNMT1VERlJPTlQiLCJpY29uUG9zQWNjZXNzb3IiLCJsYXQiLCJsbmciLCJkIiwiZGF0YSIsImZpZWxkSWR4IiwiaWNvblBvc1Jlc29sdmVyIiwiaWNvbkFjY2Vzc29yIiwiaWNvbiIsImljb25SZXNvbHZlciIsImljb25SZXF1aXJlZENvbHVtbnMiLCJwb2ludFZpc0NvbmZpZ3MiLCJyYWRpdXMiLCJmaXhlZFJhZGl1cyIsIm9wYWNpdHkiLCJjb2xvclJhbmdlIiwicmFkaXVzUmFuZ2UiLCJJY29uTGF5ZXIiLCJwcm9wcyIsInJlZ2lzdGVyVmlzQ29uZmlnIiwiZ2V0UG9zaXRpb24iLCJnZXRJY29uIiwiX2xheWVySW5mb01vZGFsIiwiZ2V0U3ZnSWNvbnMiLCJmZXRjaENvbmZpZyIsIm1ldGhvZCIsIm1vZGUiLCJjYWNoZSIsIndpbmRvdyIsImZldGNoIiwicmVzcG9uc2UiLCJqc29uIiwic3ZnSWNvbnMiLCJpY29uR2VvbWV0cnkiLCJyZWR1Y2UiLCJhY2N1IiwiY3VyciIsImlkIiwibWVzaCIsImNlbGxzIiwicHJldiIsImNlbGwiLCJmb3JFYWNoIiwicCIsIkFycmF5IiwicHJvdG90eXBlIiwicHVzaCIsImFwcGx5IiwicG9zaXRpb25zIiwiXyIsImFsbERhdGEiLCJmaWx0ZXJlZEluZGV4Iiwib2xkTGF5ZXJEYXRhIiwib3B0IiwiY29uZmlnIiwiY29sb3JTY2FsZSIsImNvbG9yRG9tYWluIiwiY29sb3JGaWVsZCIsImNvbG9yIiwiY29sdW1ucyIsInNpemVGaWVsZCIsInNpemVTY2FsZSIsInNpemVEb21haW4iLCJ2aXNDb25maWciLCJjU2NhbGUiLCJnZXRWaXNDaGFubmVsU2NhbGUiLCJjb2xvcnMiLCJtYXAiLCJoZXhUb1JnYiIsInJTY2FsZSIsInVwZGF0ZUxheWVyTWV0YSIsInNhbWVEYXRhIiwiaW5kZXgiLCJwb3MiLCJldmVyeSIsIk51bWJlciIsImlzRmluaXRlIiwiZ2V0UmFkaXVzIiwiZ2V0RW5jb2RlZENoYW5uZWxWYWx1ZSIsImdldENvbG9yIiwiYm91bmRzIiwiZ2V0UG9pbnRzQm91bmRzIiwidXBkYXRlTWV0YSIsImlkeCIsIm9iamVjdEhvdmVyZWQiLCJtYXBTdGF0ZSIsImludGVyYWN0aW9uQ29uZmlnIiwibGF5ZXJJbnRlcmFjdGlvbiIsImxheWVyUHJvcHMiLCJyYWRpdXNNaW5QaXhlbHMiLCJyYWRpdXNTY2FsZSIsImdldFJhZGl1c1NjYWxlQnlab29tIiwicmFkaXVzTWF4UGl4ZWxzIiwiU3ZnSWNvbkxheWVyIiwiZ2V0SWNvbkdlb21ldHJ5IiwiYXV0b0hpZ2hsaWdodCIsImhpZ2hsaWdodENvbG9yIiwicGlja2FibGUiLCJwYXJhbWV0ZXJzIiwiZGVwdGhUZXN0IiwiZHJhZ1JvdGF0ZSIsInVwZGF0ZVRyaWdnZXJzIiwiaXNMYXllckhvdmVyZWQiLCJvYmplY3QiLCJkZWZhdWx0UG9pbnRDb2x1bW5QYWlycyIsIkljb25MYXllckljb24iLCJzaXplIiwicmFuZ2UiLCJwcm9wZXJ0eSIsImNoYW5uZWxTY2FsZVR5cGUiLCJ0ZW1wbGF0ZSIsIm1vZGFsUHJvcHMiLCJ0aXRsZSIsImZpZWxkUGFpcnMiLCJmaWVsZHMiLCJub3RGb3VuZCIsImxlbmd0aCIsImljb25GaWVsZHMiLCJmaWx0ZXIiLCJuYW1lIiwicmVwbGFjZSIsInRyaW0iLCJzcGxpdCIsInNvbWUiLCJzZWciLCJJQ09OX0ZJRUxEUyIsInQiLCJpbmNsdWRlcyIsInB0UGFpciIsImljb25GaWVsZCIsImxhYmVsIiwicGFpciIsInZhbHVlIiwidGFibGVGaWVsZEluZGV4IiwiaXNWaXNpYmxlIiwiTGF5ZXIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBb0JBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7QUFFTyxJQUFNQSxZQUFZLGFBQU1DLDJCQUFOLDBC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QUN0QixlQUFPRCxRQUFQO0FBQ0QsT0FoQjBELENBa0IzRDs7O0FBQ0EsVUFBTWEsTUFBTSxHQUFHZixVQUFVLENBQUMsQ0FBRCxDQUF6QjtBQUVBLFVBQU0vRixLQUFLLEdBQUdtRyxVQUFVLENBQUNsRCxHQUFYLENBQWUsVUFBQThELFNBQVM7QUFBQSxlQUFLO0FBQ3pDQyxVQUFBQSxLQUFLLEVBQUVELFNBQVMsQ0FBQ1YsSUFBVixDQUFlQyxPQUFmLENBQXVCLFNBQXZCLEVBQWtDLEdBQWxDLEVBQXVDQyxJQUF2QyxFQURrQztBQUV6QzlELFVBQUFBLE9BQU8sRUFBRTtBQUNQMUQsWUFBQUEsR0FBRyxFQUFFK0gsTUFBTSxDQUFDRyxJQUFQLENBQVlsSSxHQURWO0FBRVBDLFlBQUFBLEdBQUcsRUFBRThILE1BQU0sQ0FBQ0csSUFBUCxDQUFZakksR0FGVjtBQUdQTSxZQUFBQSxJQUFJLEVBQUU7QUFDSjRILGNBQUFBLEtBQUssRUFBRUgsU0FBUyxDQUFDVixJQURiO0FBRUpsSCxjQUFBQSxRQUFRLEVBQUU0SCxTQUFTLENBQUNJLGVBQVYsR0FBNEI7QUFGbEM7QUFIQyxXQUZnQztBQVV6Q0MsVUFBQUEsU0FBUyxFQUFFO0FBVjhCLFNBQUw7QUFBQSxPQUF4QixDQUFkO0FBYUEsYUFBTztBQUFDcEgsUUFBQUEsS0FBSyxFQUFMQTtBQUFELE9BQVA7QUFDRDs7O0VBakhvQ3FILHFCIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSAyMDE5IFViZXIgVGVjaG5vbG9naWVzLCBJbmMuXG4vL1xuLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxuLy8gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuLy8gaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xuLy8gdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuLy8gY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG4vLyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuLy9cbi8vIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluXG4vLyBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cbi8vXG4vLyBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG4vLyBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbi8vIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuLy8gQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuLy8gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbi8vIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU5cbi8vIFRIRSBTT0ZUV0FSRS5cblxuaW1wb3J0IExheWVyIGZyb20gJy4uL2Jhc2UtbGF5ZXInO1xuaW1wb3J0IG1lbW9pemUgZnJvbSAnbG9kYXNoLm1lbW9pemUnO1xuaW1wb3J0IHdpbmRvdyBmcm9tICdnbG9iYWwvd2luZG93JztcblxuaW1wb3J0IHtoZXhUb1JnYn0gZnJvbSAndXRpbHMvY29sb3ItdXRpbHMnO1xuaW1wb3J0IFN2Z0ljb25MYXllciBmcm9tICdkZWNrZ2wtbGF5ZXJzL3N2Zy1pY29uLWxheWVyL3N2Zy1pY29uLWxheWVyJztcbmltcG9ydCBJY29uTGF5ZXJJY29uIGZyb20gJy4vaWNvbi1sYXllci1pY29uJztcbmltcG9ydCB7SUNPTl9GSUVMRFMsIENMT1VERlJPTlR9IGZyb20gJ2NvbnN0YW50cy9kZWZhdWx0LXNldHRpbmdzJztcbmltcG9ydCBJY29uSW5mb01vZGFsRmFjdG9yeSBmcm9tICcuL2ljb24taW5mby1tb2RhbCc7XG5cbmV4cG9ydCBjb25zdCBTVkdfSUNPTl9VUkwgPSBgJHtDTE9VREZST05UfS9pY29ucy9zdmctaWNvbnMuanNvbmA7XG5cbmV4cG9ydCBjb25zdCBpY29uUG9zQWNjZXNzb3IgPSAoe2xhdCwgbG5nfSkgPT4gZCA9PiBbXG4gIGQuZGF0YVtsbmcuZmllbGRJZHhdLFxuICBkLmRhdGFbbGF0LmZpZWxkSWR4XVxuXTtcblxuZXhwb3J0IGNvbnN0IGljb25Qb3NSZXNvbHZlciA9ICh7bGF0LCBsbmd9KSA9PiBgJHtsYXQuZmllbGRJZHh9LSR7bG5nLmZpZWxkSWR4fWA7XG5cbmV4cG9ydCBjb25zdCBpY29uQWNjZXNzb3IgPSAoe2ljb259KSA9PiBkID0+IGQuZGF0YVtpY29uLmZpZWxkSWR4XTtcbmV4cG9ydCBjb25zdCBpY29uUmVzb2x2ZXIgPSAoe2ljb259KSA9PiBpY29uLmZpZWxkSWR4O1xuXG5leHBvcnQgY29uc3QgaWNvblJlcXVpcmVkQ29sdW1ucyA9IFsnbGF0JywgJ2xuZycsICdpY29uJ107XG5cbmV4cG9ydCBjb25zdCBwb2ludFZpc0NvbmZpZ3MgPSB7XG4gIHJhZGl1czogJ3JhZGl1cycsXG4gIGZpeGVkUmFkaXVzOiAnZml4ZWRSYWRpdXMnLFxuICBvcGFjaXR5OiAnb3BhY2l0eScsXG4gIGNvbG9yUmFuZ2U6ICdjb2xvclJhbmdlJyxcbiAgcmFkaXVzUmFuZ2U6ICdyYWRpdXNSYW5nZSdcbn07XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEljb25MYXllciBleHRlbmRzIExheWVyIHtcbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG5cbiAgICB0aGlzLnJlZ2lzdGVyVmlzQ29uZmlnKHBvaW50VmlzQ29uZmlncyk7XG4gICAgdGhpcy5nZXRQb3NpdGlvbiA9IG1lbW9pemUoaWNvblBvc0FjY2Vzc29yLCBpY29uUG9zUmVzb2x2ZXIpO1xuICAgIHRoaXMuZ2V0SWNvbiA9IG1lbW9pemUoaWNvbkFjY2Vzc29yLCBpY29uUmVzb2x2ZXIpO1xuXG4gICAgLy8gcHJlcGFyZSBsYXllciBpbmZvIG1vZGFsXG4gICAgdGhpcy5fbGF5ZXJJbmZvTW9kYWwgPSBJY29uSW5mb01vZGFsRmFjdG9yeSgpO1xuICAgIHRoaXMuZ2V0U3ZnSWNvbnMoKTtcbiAgfVxuXG4gIGdldCB0eXBlKCkge1xuICAgIHJldHVybiAnaWNvbic7XG4gIH1cblxuICBnZXQgcmVxdWlyZWRMYXllckNvbHVtbnMoKSB7XG4gICAgcmV0dXJuIGljb25SZXF1aXJlZENvbHVtbnM7XG4gIH1cblxuICBnZXQgY29sdW1uUGFpcnMoKSB7XG4gICAgcmV0dXJuIHRoaXMuZGVmYXVsdFBvaW50Q29sdW1uUGFpcnM7XG4gIH1cblxuICBnZXQgbGF5ZXJJY29uKCkge1xuICAgIHJldHVybiBJY29uTGF5ZXJJY29uO1xuICB9XG5cbiAgZ2V0IHZpc3VhbENoYW5uZWxzKCkge1xuICAgIHJldHVybiB7XG4gICAgICAuLi5zdXBlci52aXN1YWxDaGFubmVscyxcbiAgICAgIHNpemU6IHtcbiAgICAgICAgLi4uc3VwZXIudmlzdWFsQ2hhbm5lbHMuc2l6ZSxcbiAgICAgICAgcmFuZ2U6ICdyYWRpdXNSYW5nZScsXG4gICAgICAgIHByb3BlcnR5OiAncmFkaXVzJyxcbiAgICAgICAgY2hhbm5lbFNjYWxlVHlwZTogJ3JhZGl1cydcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgZ2V0IGxheWVySW5mb01vZGFsKCkge1xuICAgIHJldHVybiB7XG4gICAgICBpZDogJ2ljb25JbmZvJyxcbiAgICAgIHRlbXBsYXRlOiB0aGlzLl9sYXllckluZm9Nb2RhbCxcbiAgICAgIG1vZGFsUHJvcHM6IHtcbiAgICAgICAgdGl0bGU6ICdIb3cgdG8gZHJhdyBpY29ucydcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgYXN5bmMgZ2V0U3ZnSWNvbnMoKSB7XG4gICAgY29uc3QgZmV0Y2hDb25maWcgPSB7XG4gICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgbW9kZTogJ2NvcnMnLFxuICAgICAgY2FjaGU6ICduby1jYWNoZSdcbiAgICB9O1xuXG4gICAgaWYgKHdpbmRvdy5mZXRjaCkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB3aW5kb3cuZmV0Y2goU1ZHX0lDT05fVVJMLCBmZXRjaENvbmZpZyk7XG4gICAgICBjb25zdCB7c3ZnSWNvbnN9ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuXG4gICAgICB0aGlzLmljb25HZW9tZXRyeSA9IHN2Z0ljb25zLnJlZHVjZShcbiAgICAgICAgKGFjY3UsIGN1cnIpID0+ICh7XG4gICAgICAgICAgLi4uYWNjdSxcbiAgICAgICAgICBbY3Vyci5pZF06IGN1cnIubWVzaC5jZWxscy5yZWR1Y2UoKHByZXYsIGNlbGwpID0+IHtcbiAgICAgICAgICAgIGNlbGwuZm9yRWFjaChwID0+IHtcbiAgICAgICAgICAgICAgQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkocHJldiwgY3Vyci5tZXNoLnBvc2l0aW9uc1twXSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBwcmV2O1xuICAgICAgICAgIH0sIFtdKVxuICAgICAgICB9KSxcbiAgICAgICAge31cbiAgICAgICk7XG4gICAgICB0aGlzLl9sYXllckluZm9Nb2RhbCA9IEljb25JbmZvTW9kYWxGYWN0b3J5KHN2Z0ljb25zKTtcbiAgICB9XG4gIH1cblxuICBzdGF0aWMgZmluZERlZmF1bHRMYXllclByb3BzKHtmaWVsZFBhaXJzID0gW10sIGZpZWxkcyA9IFtdfSkge1xuICAgIGNvbnN0IG5vdEZvdW5kID0ge3Byb3BzOiBbXX07XG4gICAgaWYgKCFmaWVsZFBhaXJzLmxlbmd0aCB8fCAhZmllbGRzLmxlbmd0aCkge1xuICAgICAgcmV0dXJuIG5vdEZvdW5kO1xuICAgIH1cblxuICAgIGNvbnN0IGljb25GaWVsZHMgPSBmaWVsZHMuZmlsdGVyKCh7bmFtZX0pID0+XG4gICAgICBuYW1lXG4gICAgICAgIC5yZXBsYWNlKC9bXywuXSsvZywgJyAnKVxuICAgICAgICAudHJpbSgpXG4gICAgICAgIC5zcGxpdCgnICcpXG4gICAgICAgIC5zb21lKHNlZyA9PiBJQ09OX0ZJRUxEUy5pY29uLnNvbWUodCA9PiB0LmluY2x1ZGVzKHNlZykpKVxuICAgICk7XG5cbiAgICBpZiAoIWljb25GaWVsZHMubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gbm90Rm91bmQ7XG4gICAgfVxuXG4gICAgLy8gY3JlYXRlIGljb24gbGF5ZXJzIGZvciBmaXJzdCBwb2ludCBwYWlyXG4gICAgY29uc3QgcHRQYWlyID0gZmllbGRQYWlyc1swXTtcblxuICAgIGNvbnN0IHByb3BzID0gaWNvbkZpZWxkcy5tYXAoaWNvbkZpZWxkID0+ICh7XG4gICAgICBsYWJlbDogaWNvbkZpZWxkLm5hbWUucmVwbGFjZSgvW18sLl0rL2csICcgJykudHJpbSgpLFxuICAgICAgY29sdW1uczoge1xuICAgICAgICBsYXQ6IHB0UGFpci5wYWlyLmxhdCxcbiAgICAgICAgbG5nOiBwdFBhaXIucGFpci5sbmcsXG4gICAgICAgIGljb246IHtcbiAgICAgICAgICB2YWx1ZTogaWNvbkZpZWxkLm5hbWUsXG4gICAgICAgICAgZmllbGRJZHg6IGljb25GaWVsZC50YWJsZUZpZWxkSW5kZXggLSAxXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBpc1Zpc2libGU6IHRydWVcbiAgICB9KSk7XG5cbiAgICByZXR1cm4ge3Byb3BzfTtcbiAgfVxuXG4gIC8vIFRPRE86IGZpeCBjb21wbGV4aXR5XG4gIC8qIGVzbGludC1kaXNhYmxlIGNvbXBsZXhpdHkgKi9cbiAgZm9ybWF0TGF5ZXJEYXRhKF8sIGFsbERhdGEsIGZpbHRlcmVkSW5kZXgsIG9sZExheWVyRGF0YSwgb3B0ID0ge30pIHtcbiAgICBjb25zdCB7XG4gICAgICBjb2xvclNjYWxlLFxuICAgICAgY29sb3JEb21haW4sXG4gICAgICBjb2xvckZpZWxkLFxuICAgICAgY29sb3IsXG4gICAgICBjb2x1bW5zLFxuICAgICAgc2l6ZUZpZWxkLFxuICAgICAgc2l6ZVNjYWxlLFxuICAgICAgc2l6ZURvbWFpbixcbiAgICAgIHZpc0NvbmZpZzoge3JhZGl1c1JhbmdlLCBjb2xvclJhbmdlfVxuICAgIH0gPSB0aGlzLmNvbmZpZztcblxuICAgIC8vIHBvaW50IGNvbG9yXG4gICAgY29uc3QgY1NjYWxlID1cbiAgICAgIGNvbG9yRmllbGQgJiZcbiAgICAgIHRoaXMuZ2V0VmlzQ2hhbm5lbFNjYWxlKFxuICAgICAgICBjb2xvclNjYWxlLFxuICAgICAgICBjb2xvckRvbWFpbixcbiAgICAgICAgY29sb3JSYW5nZS5jb2xvcnMubWFwKGhleFRvUmdiKVxuICAgICAgKTtcblxuICAgIC8vIHBvaW50IHJhZGl1c1xuICAgIGNvbnN0IHJTY2FsZSA9XG4gICAgICBzaXplRmllbGQgJiYgdGhpcy5nZXRWaXNDaGFubmVsU2NhbGUoc2l6ZVNjYWxlLCBzaXplRG9tYWluLCByYWRpdXNSYW5nZSwgMCk7XG5cbiAgICBjb25zdCBnZXRQb3NpdGlvbiA9IHRoaXMuZ2V0UG9zaXRpb24oY29sdW1ucyk7XG4gICAgY29uc3QgZ2V0SWNvbiA9IHRoaXMuZ2V0SWNvbihjb2x1bW5zKTtcblxuICAgIGlmICghb2xkTGF5ZXJEYXRhIHx8IG9sZExheWVyRGF0YS5nZXRQb3NpdGlvbiAhPT0gZ2V0UG9zaXRpb24pIHtcbiAgICAgIHRoaXMudXBkYXRlTGF5ZXJNZXRhKGFsbERhdGEsIGdldFBvc2l0aW9uKTtcbiAgICB9XG5cbiAgICBsZXQgZGF0YTtcbiAgICBpZiAoXG4gICAgICBvbGRMYXllckRhdGEgJiZcbiAgICAgIG9sZExheWVyRGF0YS5kYXRhICYmXG4gICAgICBvcHQuc2FtZURhdGEgJiZcbiAgICAgIG9sZExheWVyRGF0YS5nZXRQb3NpdGlvbiA9PT0gZ2V0UG9zaXRpb24gJiZcbiAgICAgIG9sZExheWVyRGF0YS5nZXRJY29uID09PSBnZXRJY29uXG4gICAgKSB7XG4gICAgICBkYXRhID0gb2xkTGF5ZXJEYXRhLmRhdGE7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRhdGEgPSBmaWx0ZXJlZEluZGV4LnJlZHVjZSgoYWNjdSwgaW5kZXgpID0+IHtcbiAgICAgICAgY29uc3QgcG9zID0gZ2V0UG9zaXRpb24oe2RhdGE6IGFsbERhdGFbaW5kZXhdfSk7XG4gICAgICAgIGNvbnN0IGljb24gPSBnZXRJY29uKHtkYXRhOiBhbGxEYXRhW2luZGV4XX0pO1xuXG4gICAgICAgIC8vIGlmIGRvZXNuJ3QgaGF2ZSBwb2ludCBsYXQgb3IgbG5nLCBkbyBub3QgYWRkIHRoZSBwb2ludFxuICAgICAgICAvLyBkZWNrLmdsIGNhbid0IGhhbmRsZSBwb3NpdGlvbiA9IG51bGxcbiAgICAgICAgaWYgKCFwb3MuZXZlcnkoTnVtYmVyLmlzRmluaXRlKSB8fCB0eXBlb2YgaWNvbiAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICByZXR1cm4gYWNjdTtcbiAgICAgICAgfVxuXG4gICAgICAgIGFjY3UucHVzaCh7XG4gICAgICAgICAgaW5kZXgsXG4gICAgICAgICAgaWNvbixcbiAgICAgICAgICBkYXRhOiBhbGxEYXRhW2luZGV4XVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gYWNjdTtcbiAgICAgIH0sIFtdKTtcbiAgICB9XG5cbiAgICBjb25zdCBnZXRSYWRpdXMgPSByU2NhbGVcbiAgICAgID8gZCA9PiB0aGlzLmdldEVuY29kZWRDaGFubmVsVmFsdWUoclNjYWxlLCBkLmRhdGEsIHNpemVGaWVsZCwgMClcbiAgICAgIDogMTtcblxuICAgIGNvbnN0IGdldENvbG9yID0gY1NjYWxlXG4gICAgICA/IGQgPT4gdGhpcy5nZXRFbmNvZGVkQ2hhbm5lbFZhbHVlKGNTY2FsZSwgZC5kYXRhLCBjb2xvckZpZWxkKVxuICAgICAgOiBjb2xvcjtcblxuICAgIHJldHVybiB7XG4gICAgICBkYXRhLFxuICAgICAgZ2V0UG9zaXRpb24sXG4gICAgICBnZXRJY29uLFxuICAgICAgZ2V0Q29sb3IsXG4gICAgICBnZXRSYWRpdXNcbiAgICB9O1xuICB9XG4gIC8qIGVzbGludC1lbmFibGUgY29tcGxleGl0eSAqL1xuXG4gIHVwZGF0ZUxheWVyTWV0YShhbGxEYXRhLCBnZXRQb3NpdGlvbikge1xuICAgIGNvbnN0IGJvdW5kcyA9IHRoaXMuZ2V0UG9pbnRzQm91bmRzKGFsbERhdGEsIGQgPT4gZ2V0UG9zaXRpb24oe2RhdGE6IGR9KSk7XG4gICAgdGhpcy51cGRhdGVNZXRhKHtib3VuZHN9KTtcbiAgfVxuXG4gIHJlbmRlckxheWVyKHtcbiAgICBkYXRhLFxuICAgIGlkeCxcbiAgICBvYmplY3RIb3ZlcmVkLFxuICAgIG1hcFN0YXRlLFxuICAgIGludGVyYWN0aW9uQ29uZmlnLFxuICAgIGxheWVySW50ZXJhY3Rpb25cbiAgfSkge1xuICAgIGNvbnN0IGxheWVyUHJvcHMgPSB7XG4gICAgICByYWRpdXNNaW5QaXhlbHM6IDEsXG4gICAgICByYWRpdXNTY2FsZTogdGhpcy5nZXRSYWRpdXNTY2FsZUJ5Wm9vbShtYXBTdGF0ZSksXG4gICAgICAuLi4odGhpcy5jb25maWcudmlzQ29uZmlnLmZpeGVkUmFkaXVzID8ge30gOiB7cmFkaXVzTWF4UGl4ZWxzOiA1MDB9KVxuICAgIH07XG5cbiAgICByZXR1cm4gIXRoaXMuaWNvbkdlb21ldHJ5XG4gICAgICA/IFtdXG4gICAgICA6IFtcbiAgICAgICAgICBuZXcgU3ZnSWNvbkxheWVyKHtcbiAgICAgICAgICAgIC4uLmxheWVyUHJvcHMsXG4gICAgICAgICAgICAuLi5kYXRhLFxuICAgICAgICAgICAgLi4ubGF5ZXJJbnRlcmFjdGlvbixcbiAgICAgICAgICAgIGlkOiB0aGlzLmlkLFxuICAgICAgICAgICAgaWR4LFxuICAgICAgICAgICAgb3BhY2l0eTogdGhpcy5jb25maWcudmlzQ29uZmlnLm9wYWNpdHksXG4gICAgICAgICAgICBnZXRJY29uR2VvbWV0cnk6IGlkID0+IHRoaXMuaWNvbkdlb21ldHJ5W2lkXSxcblxuICAgICAgICAgICAgLy8gcGlja2luZ1xuICAgICAgICAgICAgYXV0b0hpZ2hsaWdodDogdHJ1ZSxcbiAgICAgICAgICAgIGhpZ2hsaWdodENvbG9yOiB0aGlzLmNvbmZpZy5oaWdobGlnaHRDb2xvcixcbiAgICAgICAgICAgIHBpY2thYmxlOiB0cnVlLFxuXG4gICAgICAgICAgICAvLyBwYXJhbWV0ZXJzXG4gICAgICAgICAgICBwYXJhbWV0ZXJzOiB7ZGVwdGhUZXN0OiBtYXBTdGF0ZS5kcmFnUm90YXRlfSxcblxuICAgICAgICAgICAgLy8gdXBkYXRlIHRyaWdnZXJzXG4gICAgICAgICAgICB1cGRhdGVUcmlnZ2Vyczoge1xuICAgICAgICAgICAgICBnZXRSYWRpdXM6IHtcbiAgICAgICAgICAgICAgICBzaXplRmllbGQ6IHRoaXMuY29uZmlnLmNvbG9yRmllbGQsXG4gICAgICAgICAgICAgICAgcmFkaXVzUmFuZ2U6IHRoaXMuY29uZmlnLnZpc0NvbmZpZy5yYWRpdXNSYW5nZSxcbiAgICAgICAgICAgICAgICBzaXplU2NhbGU6IHRoaXMuY29uZmlnLnNpemVTY2FsZVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBnZXRDb2xvcjoge1xuICAgICAgICAgICAgICAgIGNvbG9yOiB0aGlzLmNvbmZpZy5jb2xvcixcbiAgICAgICAgICAgICAgICBjb2xvckZpZWxkOiB0aGlzLmNvbmZpZy5jb2xvckZpZWxkLFxuICAgICAgICAgICAgICAgIGNvbG9yUmFuZ2U6IHRoaXMuY29uZmlnLnZpc0NvbmZpZy5jb2xvclJhbmdlLFxuICAgICAgICAgICAgICAgIGNvbG9yU2NhbGU6IHRoaXMuY29uZmlnLmNvbG9yU2NhbGVcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIC4uLih0aGlzLmlzTGF5ZXJIb3ZlcmVkKG9iamVjdEhvdmVyZWQpXG4gICAgICAgICAgICA/IFtcbiAgICAgICAgICAgICAgICBuZXcgU3ZnSWNvbkxheWVyKHtcbiAgICAgICAgICAgICAgICAgIC4uLmxheWVyUHJvcHMsXG4gICAgICAgICAgICAgICAgICBpZDogYCR7dGhpcy5pZH0taG92ZXJlZGAsXG4gICAgICAgICAgICAgICAgICBkYXRhOiBbb2JqZWN0SG92ZXJlZC5vYmplY3RdLFxuICAgICAgICAgICAgICAgICAgZ2V0UG9zaXRpb246IGRhdGEuZ2V0UG9zaXRpb24sXG4gICAgICAgICAgICAgICAgICBnZXRSYWRpdXM6IGRhdGEuZ2V0UmFkaXVzLFxuICAgICAgICAgICAgICAgICAgZ2V0Q29sb3I6IHRoaXMuY29uZmlnLmhpZ2hsaWdodENvbG9yLFxuICAgICAgICAgICAgICAgICAgZ2V0SWNvbkdlb21ldHJ5OiBpZCA9PiB0aGlzLmljb25HZW9tZXRyeVtpZF0sXG4gICAgICAgICAgICAgICAgICBwaWNrYWJsZTogZmFsc2VcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICBdXG4gICAgICAgICAgICA6IFtdKVxuICAgICAgICBdO1xuICB9XG59XG4iXX0=