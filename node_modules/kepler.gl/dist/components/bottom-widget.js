"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = BottomWidgetFactory;

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireDefault(require("react"));

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _timeWidget = _interopRequireDefault(require("./filters/time-widget"));

var _animationControl = _interopRequireDefault(require("./common/animation-control/animation-control"));

var _filterUtils = require("../utils/filter-utils");

function _templateObject() {
  var data = (0, _taggedTemplateLiteral2["default"])(["\n  position: absolute;\n  display: flex;\n  flex-direction: column;\n  padding-top: ", "px;\n  padding-right: ", "px;\n  padding-bottom: ", "px;\n  padding-left: ", "px;\n  width: ", "px;\n  bottom: 0;\n  right: 0;\n  z-index: 1;\n"]);

  _templateObject = function _templateObject() {
    return data;
  };

  return data;
}

var propTypes = {
  filters: _propTypes["default"].arrayOf(_propTypes["default"].object),
  datasets: _propTypes["default"].object,
  uiState: _propTypes["default"].object,
  layers: _propTypes["default"].arrayOf(_propTypes["default"].object),
  animationConfig: _propTypes["default"].object,
  visStateActions: _propTypes["default"].object,
  sidePanelWidth: _propTypes["default"].number,
  containerW: _propTypes["default"].number
};
var maxWidth = 1080;
BottomWidgetFactory.deps = [_timeWidget["default"], _animationControl["default"]];

var BottomWidgetContainer = _styledComponents["default"].div(_templateObject(), function (props) {
  return props.theme.sidePanel.margin.top;
}, function (props) {
  return props.theme.sidePanel.margin.right;
}, function (props) {
  return props.theme.sidePanel.margin.bottom;
}, function (props) {
  return props.theme.sidePanel.margin.left;
}, function (props) {
  return props.width;
});

function BottomWidgetFactory(TimeWidget, AnimationControl) {
  var BottomWidget = function BottomWidget(props) {
    var datasets = props.datasets,
        filters = props.filters,
        animationConfig = props.animationConfig,
        visStateActions = props.visStateActions,
        containerW = props.containerW,
        uiState = props.uiState,
        sidePanelWidth = props.sidePanelWidth,
        layers = props.layers;
    var activeSidePanel = uiState.activeSidePanel,
        readOnly = uiState.readOnly;
    var isOpen = Boolean(activeSidePanel);
    var enlargedFilterIdx = filters.findIndex(function (f) {
      return f.enlarged && f.type === _filterUtils.FILTER_TYPES.timeRange;
    });
    var isAnyFilterAnimating = filters.some(function (f) {
      return f.isAnimating;
    });
    var enlargedFilterWidth = isOpen ? containerW - sidePanelWidth : containerW; // show playback control if layers contain trip layer & at least one trip layer is visible

    var animatedLayer = layers.filter(function (l) {
      return l.config.animation && l.config.animation.enabled && l.config.isVisible;
    });
    var readToAnimation = Array.isArray(animationConfig.domain) && animationConfig.currentTime; // if animation control is showing, hide time display in time slider

    var showFloatingTimeDisplay = !animatedLayer.length;
    return _react["default"].createElement(BottomWidgetContainer, {
      width: Math.min(maxWidth, enlargedFilterWidth),
      className: "bottom-widget--container"
    }, animatedLayer.length && readToAnimation ? _react["default"].createElement(AnimationControl, {
      animationConfig: animationConfig,
      updateAnimationTime: visStateActions.updateAnimationTime,
      updateAnimationSpeed: visStateActions.updateLayerAnimationSpeed
    }) : null, enlargedFilterIdx > -1 ? _react["default"].createElement(TimeWidget, {
      filter: filters[enlargedFilterIdx],
      index: enlargedFilterIdx,
      isAnyFilterAnimating: isAnyFilterAnimating,
      datasets: datasets,
      readOnly: readOnly,
      showTimeDisplay: showFloatingTimeDisplay,
      setFilterPlot: visStateActions.setFilterPlot,
      setFilter: visStateActions.setFilter,
      toggleAnimation: visStateActions.toggleFilterAnimation,
      updateAnimationSpeed: visStateActions.updateFilterAnimationSpeed,
      enlargeFilter: visStateActions.enlargeFilter
    }) : null);
  };

  BottomWidget.propTypes = propTypes;
  return BottomWidget;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb21wb25lbnRzL2JvdHRvbS13aWRnZXQuanMiXSwibmFtZXMiOlsicHJvcFR5cGVzIiwiZmlsdGVycyIsIlByb3BUeXBlcyIsImFycmF5T2YiLCJvYmplY3QiLCJkYXRhc2V0cyIsInVpU3RhdGUiLCJsYXllcnMiLCJhbmltYXRpb25Db25maWciLCJ2aXNTdGF0ZUFjdGlvbnMiLCJzaWRlUGFuZWxXaWR0aCIsIm51bWJlciIsImNvbnRhaW5lclciLCJtYXhXaWR0aCIsIkJvdHRvbVdpZGdldEZhY3RvcnkiLCJkZXBzIiwiVGltZVdpZGdldEZhY3RvcnkiLCJBbmltYXRpb25Db250cm9sRmFjdG9yeSIsIkJvdHRvbVdpZGdldENvbnRhaW5lciIsInN0eWxlZCIsImRpdiIsInByb3BzIiwidGhlbWUiLCJzaWRlUGFuZWwiLCJtYXJnaW4iLCJ0b3AiLCJyaWdodCIsImJvdHRvbSIsImxlZnQiLCJ3aWR0aCIsIlRpbWVXaWRnZXQiLCJBbmltYXRpb25Db250cm9sIiwiQm90dG9tV2lkZ2V0IiwiYWN0aXZlU2lkZVBhbmVsIiwicmVhZE9ubHkiLCJpc09wZW4iLCJCb29sZWFuIiwiZW5sYXJnZWRGaWx0ZXJJZHgiLCJmaW5kSW5kZXgiLCJmIiwiZW5sYXJnZWQiLCJ0eXBlIiwiRklMVEVSX1RZUEVTIiwidGltZVJhbmdlIiwiaXNBbnlGaWx0ZXJBbmltYXRpbmciLCJzb21lIiwiaXNBbmltYXRpbmciLCJlbmxhcmdlZEZpbHRlcldpZHRoIiwiYW5pbWF0ZWRMYXllciIsImZpbHRlciIsImwiLCJjb25maWciLCJhbmltYXRpb24iLCJlbmFibGVkIiwiaXNWaXNpYmxlIiwicmVhZFRvQW5pbWF0aW9uIiwiQXJyYXkiLCJpc0FycmF5IiwiZG9tYWluIiwiY3VycmVudFRpbWUiLCJzaG93RmxvYXRpbmdUaW1lRGlzcGxheSIsImxlbmd0aCIsIk1hdGgiLCJtaW4iLCJ1cGRhdGVBbmltYXRpb25UaW1lIiwidXBkYXRlTGF5ZXJBbmltYXRpb25TcGVlZCIsInNldEZpbHRlclBsb3QiLCJzZXRGaWx0ZXIiLCJ0b2dnbGVGaWx0ZXJBbmltYXRpb24iLCJ1cGRhdGVGaWx0ZXJBbmltYXRpb25TcGVlZCIsImVubGFyZ2VGaWx0ZXIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBb0JBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7Ozs7Ozs7QUFFQSxJQUFNQSxTQUFTLEdBQUc7QUFDaEJDLEVBQUFBLE9BQU8sRUFBRUMsc0JBQVVDLE9BQVYsQ0FBa0JELHNCQUFVRSxNQUE1QixDQURPO0FBRWhCQyxFQUFBQSxRQUFRLEVBQUVILHNCQUFVRSxNQUZKO0FBR2hCRSxFQUFBQSxPQUFPLEVBQUVKLHNCQUFVRSxNQUhIO0FBSWhCRyxFQUFBQSxNQUFNLEVBQUVMLHNCQUFVQyxPQUFWLENBQWtCRCxzQkFBVUUsTUFBNUIsQ0FKUTtBQUtoQkksRUFBQUEsZUFBZSxFQUFFTixzQkFBVUUsTUFMWDtBQU1oQkssRUFBQUEsZUFBZSxFQUFFUCxzQkFBVUUsTUFOWDtBQU9oQk0sRUFBQUEsY0FBYyxFQUFFUixzQkFBVVMsTUFQVjtBQVFoQkMsRUFBQUEsVUFBVSxFQUFFVixzQkFBVVM7QUFSTixDQUFsQjtBQVdBLElBQU1FLFFBQVEsR0FBRyxJQUFqQjtBQUVBQyxtQkFBbUIsQ0FBQ0MsSUFBcEIsR0FBMkIsQ0FBQ0Msc0JBQUQsRUFBb0JDLDRCQUFwQixDQUEzQjs7QUFFQSxJQUFNQyxxQkFBcUIsR0FBR0MsNkJBQU9DLEdBQVYsb0JBSVYsVUFBQUMsS0FBSztBQUFBLFNBQUlBLEtBQUssQ0FBQ0MsS0FBTixDQUFZQyxTQUFaLENBQXNCQyxNQUF0QixDQUE2QkMsR0FBakM7QUFBQSxDQUpLLEVBS1IsVUFBQUosS0FBSztBQUFBLFNBQUlBLEtBQUssQ0FBQ0MsS0FBTixDQUFZQyxTQUFaLENBQXNCQyxNQUF0QixDQUE2QkUsS0FBakM7QUFBQSxDQUxHLEVBTVAsVUFBQUwsS0FBSztBQUFBLFNBQUlBLEtBQUssQ0FBQ0MsS0FBTixDQUFZQyxTQUFaLENB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QUFFcEMsT0FBTyxDQUFDb0MsaUJBQUQsQ0FEakI7QUFFRSxNQUFBLEtBQUssRUFBRUEsaUJBRlQ7QUFHRSxNQUFBLG9CQUFvQixFQUFFTyxvQkFIeEI7QUFJRSxNQUFBLFFBQVEsRUFBRXZDLFFBSlo7QUFLRSxNQUFBLFFBQVEsRUFBRTZCLFFBTFo7QUFNRSxNQUFBLGVBQWUsRUFBRTBCLHVCQU5uQjtBQU9FLE1BQUEsYUFBYSxFQUFFbkQsZUFBZSxDQUFDeUQsYUFQakM7QUFRRSxNQUFBLFNBQVMsRUFBRXpELGVBQWUsQ0FBQzBELFNBUjdCO0FBU0UsTUFBQSxlQUFlLEVBQUUxRCxlQUFlLENBQUMyRCxxQkFUbkM7QUFVRSxNQUFBLG9CQUFvQixFQUFFM0QsZUFBZSxDQUFDNEQsMEJBVnhDO0FBV0UsTUFBQSxhQUFhLEVBQUU1RCxlQUFlLENBQUM2RDtBQVhqQyxNQURELEdBY0csSUF6Qk4sQ0FERjtBQTZCRCxHQTNERDs7QUE2REF0QyxFQUFBQSxZQUFZLENBQUNoQyxTQUFiLEdBQXlCQSxTQUF6QjtBQUVBLFNBQU9nQyxZQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgKGMpIDIwMTkgVWJlciBUZWNobm9sb2dpZXMsIEluYy5cbi8vXG4vLyBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG4vLyBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG4vLyBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG4vLyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG4vLyBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbi8vIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG4vL1xuLy8gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW5cbi8vIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuLy9cbi8vIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1Jcbi8vIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuLy8gRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG4vLyBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG4vLyBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuLy8gT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxuLy8gVEhFIFNPRlRXQVJFLlxuXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHN0eWxlZCBmcm9tICdzdHlsZWQtY29tcG9uZW50cyc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IFRpbWVXaWRnZXRGYWN0b3J5IGZyb20gJy4vZmlsdGVycy90aW1lLXdpZGdldCc7XG5pbXBvcnQgQW5pbWF0aW9uQ29udHJvbEZhY3RvcnkgZnJvbSAnLi9jb21tb24vYW5pbWF0aW9uLWNvbnRyb2wvYW5pbWF0aW9uLWNvbnRyb2wnO1xuaW1wb3J0IHtGSUxURVJfVFlQRVN9IGZyb20gJ3V0aWxzL2ZpbHRlci11dGlscyc7XG5cbmNvbnN0IHByb3BUeXBlcyA9IHtcbiAgZmlsdGVyczogUHJvcFR5cGVzLmFycmF5T2YoUHJvcFR5cGVzLm9iamVjdCksXG4gIGRhdGFzZXRzOiBQcm9wVHlwZXMub2JqZWN0LFxuICB1aVN0YXRlOiBQcm9wVHlwZXMub2JqZWN0LFxuICBsYXllcnM6IFByb3BUeXBlcy5hcnJheU9mKFByb3BUeXBlcy5vYmplY3QpLFxuICBhbmltYXRpb25Db25maWc6IFByb3BUeXBlcy5vYmplY3QsXG4gIHZpc1N0YXRlQWN0aW9uczogUHJvcFR5cGVzLm9iamVjdCxcbiAgc2lkZVBhbmVsV2lkdGg6IFByb3BUeXBlcy5udW1iZXIsXG4gIGNvbnRhaW5lclc6IFByb3BUeXBlcy5udW1iZXJcbn07XG5cbmNvbnN0IG1heFdpZHRoID0gMTA4MDtcblxuQm90dG9tV2lkZ2V0RmFjdG9yeS5kZXBzID0gW1RpbWVXaWRnZXRGYWN0b3J5LCBBbmltYXRpb25Db250cm9sRmFjdG9yeV07XG5cbmNvbnN0IEJvdHRvbVdpZGdldENvbnRhaW5lciA9IHN0eWxlZC5kaXZgXG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgZGlzcGxheTogZmxleDtcbiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAgcGFkZGluZy10b3A6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUuc2lkZVBhbmVsLm1hcmdpbi50b3B9cHg7XG4gIHBhZGRpbmctcmlnaHQ6ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUuc2lkZVBhbmVsLm1hcmdpbi5yaWdodH1weDtcbiAgcGFkZGluZy1ib3R0b206ICR7cHJvcHMgPT4gcHJvcHMudGhlbWUuc2lkZVBhbmVsLm1hcmdpbi5ib3R0b219cHg7XG4gIHBhZGRpbmctbGVmdDogJHtwcm9wcyA9PiBwcm9wcy50aGVtZS5zaWRlUGFuZWwubWFyZ2luLmxlZnR9cHg7XG4gIHdpZHRoOiAke3Byb3BzID0+IHByb3BzLndpZHRofXB4O1xuICBib3R0b206IDA7XG4gIHJpZ2h0OiAwO1xuICB6LWluZGV4OiAxO1xuYDtcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gQm90dG9tV2lkZ2V0RmFjdG9yeShUaW1lV2lkZ2V0LCBBbmltYXRpb25Db250cm9sKSB7XG4gIGNvbnN0IEJvdHRvbVdpZGdldCA9IHByb3BzID0+IHtcbiAgICBjb25zdCB7XG4gICAgICBkYXRhc2V0cyxcbiAgICAgIGZpbHRlcnMsXG4gICAgICBhbmltYXRpb25Db25maWcsXG4gICAgICB2aXNTdGF0ZUFjdGlvbnMsXG4gICAgICBjb250YWluZXJXLFxuICAgICAgdWlTdGF0ZSxcbiAgICAgIHNpZGVQYW5lbFdpZHRoLFxuICAgICAgbGF5ZXJzXG4gICAgfSA9IHByb3BzO1xuXG4gICAgY29uc3Qge2FjdGl2ZVNpZGVQYW5lbCwgcmVhZE9ubHl9ID0gdWlTdGF0ZTtcbiAgICBjb25zdCBpc09wZW4gPSBCb29sZWFuKGFjdGl2ZVNpZGVQYW5lbCk7XG5cbiAgICBjb25zdCBlbmxhcmdlZEZpbHRlcklkeCA9IGZpbHRlcnMuZmluZEluZGV4KGYgPT4gZi5lbmxhcmdlZCAmJiBmLnR5cGUgPT09IEZJTFRFUl9UWVBFUy50aW1lUmFuZ2UpO1xuICAgIGNvbnN0IGlzQW55RmlsdGVyQW5pbWF0aW5nID0gZmlsdGVycy5zb21lKGYgPT4gZi5pc0FuaW1hdGluZyk7XG4gICAgY29uc3QgZW5sYXJnZWRGaWx0ZXJXaWR0aCA9IGlzT3BlblxuICAgICAgPyBjb250YWluZXJXIC0gc2lkZVBhbmVsV2lkdGhcbiAgICAgIDogY29udGFpbmVyVztcblxuICAgIC8vIHNob3cgcGxheWJhY2sgY29udHJvbCBpZiBsYXllcnMgY29udGFpbiB0cmlwIGxheWVyICYgYXQgbGVhc3Qgb25lIHRyaXAgbGF5ZXIgaXMgdmlzaWJsZVxuICAgIGNvbnN0IGFuaW1hdGVkTGF5ZXIgPSBsYXllcnMuZmlsdGVyKFxuICAgICAgbCA9PlxuICAgICAgICBsLmNvbmZpZy5hbmltYXRpb24gJiYgbC5jb25maWcuYW5pbWF0aW9uLmVuYWJsZWQgJiYgbC5jb25maWcuaXNWaXNpYmxlXG4gICAgKTtcblxuICAgIGNvbnN0IHJlYWRUb0FuaW1hdGlvbiA9IEFycmF5LmlzQXJyYXkoYW5pbWF0aW9uQ29uZmlnLmRvbWFpbikgJiYgYW5pbWF0aW9uQ29uZmlnLmN1cnJlbnRUaW1lO1xuICAgIC8vIGlmIGFuaW1hdGlvbiBjb250cm9sIGlzIHNob3dpbmcsIGhpZGUgdGltZSBkaXNwbGF5IGluIHRpbWUgc2xpZGVyXG4gICAgY29uc3Qgc2hvd0Zsb2F0aW5nVGltZURpc3BsYXkgPSAhYW5pbWF0ZWRMYXllci5sZW5ndGg7XG4gICAgcmV0dXJuIChcbiAgICAgIDxCb3R0b21XaWRnZXRDb250YWluZXJcbiAgICAgICAgd2lkdGg9e01hdGgubWluKG1heFdpZHRoLCBlbmxhcmdlZEZpbHRlcldpZHRoKX1cbiAgICAgICAgY2xhc3NOYW1lPVwiYm90dG9tLXdpZGdldC0tY29udGFpbmVyXCJcbiAgICAgID5cbiAgICAgICAge2FuaW1hdGVkTGF5ZXIubGVuZ3RoICYmIHJlYWRUb0FuaW1hdGlvbiA/IChcbiAgICAgICAgICA8QW5pbWF0aW9uQ29udHJvbFxuICAgICAgICAgICAgYW5pbWF0aW9uQ29uZmlnPXthbmltYXRpb25Db25maWd9XG4gICAgICAgICAgICB1cGRhdGVBbmltYXRpb25UaW1lPXt2aXNTdGF0ZUFjdGlvbnMudXBkYXRlQW5pbWF0aW9uVGltZX1cbiAgICAgICAgICAgIHVwZGF0ZUFuaW1hdGlvblNwZWVkPXt2aXNTdGF0ZUFjdGlvbnMudXBkYXRlTGF5ZXJBbmltYXRpb25TcGVlZH1cbiAgICAgICAgICAvPlxuICAgICAgICApIDogbnVsbH1cbiAgICAgICAge2VubGFyZ2VkRmlsdGVySWR4ID4gLTEgPyAoXG4gICAgICAgICAgPFRpbWVXaWRnZXRcbiAgICAgICAgICAgIGZpbHRlcj17ZmlsdGVyc1tlbmxhcmdlZEZpbHRlcklkeF19XG4gICAgICAgICAgICBpbmRleD17ZW5sYXJnZWRGaWx0ZXJJZHh9XG4gICAgICAgICAgICBpc0FueUZpbHRlckFuaW1hdGluZz17aXNBbnlGaWx0ZXJBbmltYXRpbmd9XG4gICAgICAgICAgICBkYXRhc2V0cz17ZGF0YXNldHN9XG4gICAgICAgICAgICByZWFkT25seT17cmVhZE9ubHl9XG4gICAgICAgICAgICBzaG93VGltZURpc3BsYXk9e3Nob3dGbG9hdGluZ1RpbWVEaXNwbGF5fVxuICAgICAgICAgICAgc2V0RmlsdGVyUGxvdD17dmlzU3RhdGVBY3Rpb25zLnNldEZpbHRlclBsb3R9XG4gICAgICAgICAgICBzZXRGaWx0ZXI9e3Zpc1N0YXRlQWN0aW9ucy5zZXRGaWx0ZXJ9XG4gICAgICAgICAgICB0b2dnbGVBbmltYXRpb249e3Zpc1N0YXRlQWN0aW9ucy50b2dnbGVGaWx0ZXJBbmltYXRpb259XG4gICAgICAgICAgICB1cGRhdGVBbmltYXRpb25TcGVlZD17dmlzU3RhdGVBY3Rpb25zLnVwZGF0ZUZpbHRlckFuaW1hdGlvblNwZWVkfVxuICAgICAgICAgICAgZW5sYXJnZUZpbHRlcj17dmlzU3RhdGVBY3Rpb25zLmVubGFyZ2VGaWx0ZXJ9XG4gICAgICAgICAgLz5cbiAgICAgICAgKSA6IG51bGx9XG4gICAgICA8L0JvdHRvbVdpZGdldENvbnRhaW5lcj5cbiAgICApO1xuICB9O1xuXG4gIEJvdHRvbVdpZGdldC5wcm9wVHlwZXMgPSBwcm9wVHlwZXM7XG5cbiAgcmV0dXJuIEJvdHRvbVdpZGdldDtcbn1cbiJdfQ==