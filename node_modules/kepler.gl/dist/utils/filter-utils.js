"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getDefaultFilter = getDefaultFilter;
exports.getFilterProps = getFilterProps;
exports.getFieldDomain = getFieldDomain;
exports.filterData = filterData;
exports.isDataMatchFilter = isDataMatchFilter;
exports.adjustValueToFilterDomain = adjustValueToFilterDomain;
exports.getNumericFieldDomain = getNumericFieldDomain;
exports.getTimestampFieldDomain = getTimestampFieldDomain;
exports.histogramConstruct = histogramConstruct;
exports.formatNumberByStep = formatNumberByStep;
exports.isInRange = isInRange;
exports.getTimeWidgetTitleFormatter = getTimeWidgetTitleFormatter;
exports.getTimeWidgetHintFormatter = getTimeWidgetHintFormatter;
exports.isValidFilterValue = isValidFilterValue;
exports.getFilterPlot = getFilterPlot;
exports.getDefaultFilterPlotType = getDefaultFilterPlotType;
exports.FILTER_COMPONENTS = exports.PLOT_TYPES = exports.FILTER_TYPES = exports.enlargedHistogramBins = exports.histogramBins = exports.TimestampStepMap = void 0;

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _moment = _interopRequireDefault(require("moment"));

var _d3Array = require("d3-array");

var _keymirror = _interopRequireDefault(require("keymirror"));

var _defaultSettings = require("../constants/default-settings");

var _dataUtils = require("./data-utils");

var ScaleUtils = _interopRequireWildcard(require("./data-scale-utils"));

var _utils = require("./utils");

var _FILTER_TYPES$timeRan, _FILTER_TYPES$range, _SupportedPlotType, _FILTER_COMPONENTS;

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var TimestampStepMap = [{
  max: 1,
  step: 0.05
}, {
  max: 10,
  step: 0.1
}, {
  max: 100,
  step: 1
}, {
  max: 500,
  step: 5
}, {
  max: 1000,
  step: 10
}, {
  max: 5000,
  step: 50
}, {
  max: Number.POSITIVE_INFINITY,
  step: 1000
}];
exports.TimestampStepMap = TimestampStepMap;
var histogramBins = 30;
exports.histogramBins = histogramBins;
var enlargedHistogramBins = 100;
exports.enlargedHistogramBins = enlargedHistogramBins;
var durationSecond = 1000;
var durationMinute = durationSecond * 60;
var durationHour = durationMinute * 60;
var durationDay = durationHour * 24;
var durationWeek = durationDay * 7;
var durationYear = durationDay * 365;
var FILTER_TYPES = (0, _keymirror["default"])({
  range: null,
  select: null,
  timeRange: null,
  multiSelect: null
});
exports.FILTER_TYPES = FILTER_TYPES;
var PLOT_TYPES = (0, _keymirror["default"])({
  histogram: null,
  lineChart: null
});
exports.PLOT_TYPES = PLOT_TYPES;
var SupportedPlotType = (_SupportedPlotType = {}, (0, _defineProperty2["default"])(_SupportedPlotType, FILTER_TYPES.timeRange, (_FILTER_TYPES$timeRan = {
  "default": 'histogram'
}, (0, _defineProperty2["default"])(_FILTER_TYPES$timeRan, _defaultSettings.ALL_FIELD_TYPES.integer, 'lineChart'), (0, _defineProperty2["default"])(_FILTER_TYPES$timeRan, _defaultSettings.ALL_FIELD_TYPES.real, 'lineChart'), _FILTER_TYPES$timeRan)), (0, _defineProperty2["default"])(_SupportedPlotType, FILTER_TYPES.range, (_FILTER_TYPES$range = {
  "default": 'histogram'
}, (0, _defineProperty2["default"])(_FILTER_TYPES$range, _defaultSettings.ALL_FIELD_TYPES.integer, 'lineChart'), (0, _defineProperty2["default"])(_FILTER_TYPES$range, _defaultSettings.ALL_FIELD_TYPES.real, 'lineChart'), _FILTER_TYPES$range)), _SupportedPlotType);
var FILTER_COMPONENTS = (_FILTER_COMPONENTS = {}, (0, _defineProperty2["default"])(_FILTER_COMPONENTS, FILTER_TYPES.select, 'SingleSelectFilter'), (0, _defineProperty2["default"])(_FILTER_COMPONENTS, FILTER_TYPES.multiSelect, 'MultiSelectFilter'), (0, _defineProperty2["default"])(_FILTER_COMPONENTS, FILTER_TYPES.timeRange, 'TimeRangeFilter'), (0, _defineProperty2["default"])(_FILTER_COMPONENTS, FILTER_TYPES.range, 'RangeFilter'), _FILTER_COMPONENTS);
exports.FILTER_COMPONENTS = FILTER_COMPONENTS;

function getDefaultFilter(dataId) {
  return {
    // link to dataset Id
    dataId: dataId,
    // should allow to edit dataId
    freeze: false,
    id: (0, _utils.generateHashId)(4),
    // time range filter specific
    fixedDomain: false,
    enlarged: false,
    isAnimating: false,
    speed: 1,
    // field specific
    name: null,
    type: null,
    fieldIdx: null,
    domain: null,
    value: null,
    // plot
    plotType: PLOT_TYPES.histogram,
    yAxis: null,
    interval: null
  };
}
/**
 * Get default filter prop based on field type
 *
 * @param {Object[]} data
 * @param {object} field
 * @returns {object} default filter
 */


function getFilterProps(data, field) {
  var filterProp = _objectSpread({}, getFieldDomain(data, field), {
    fieldType: field.type
  });

  switch (field.type) {
    case _defaultSettings.ALL_FIELD_TYPES.real:
    case _defaultSettings.ALL_FIELD_TYPES.integer:
      return _objectSpread({}, filterProp, {
        value: filterProp.domain,
        type: FILTER_TYPES.range,
        typeOptions: [FILTER_TYPES.range]
      });

    case _defaultSettings.ALL_FIELD_TYPES["boolean"]:
      return _objectSpread({}, filterProp, {
        type: FILTER_TYPES.select,
        value: true
      });

    case _defaultSettings.ALL_FIELD_TYPES.string:
    case _defaultSettings.ALL_FIELD_TYPES.date:
      return _objectSpread({}, filterProp, {
        type: FILTER_TYPES.multiSelect,
        value: []
      });

    case _defaultSettings.ALL_FIELD_TYPES.timestamp:
      return _objectSpread({}, filterProp, {
        type: FILTER_TYPES.timeRange,
        enlarged: true,
        fixedDomain: true,
        value: filterProp.domain
      });

    default:
      return {};
  }
}
/**
 * Calculate field domain based on field type and data
 *
 * @param {Object[]} data
 * @param {object} field
 * @returns {object} with domain as key
 */


function getFieldDomain(data, field) {
  var fieldIdx = field.tableFieldIndex - 1;
  var isTime = field.type === _defaultSettings.ALL_FIELD_TYPES.timestamp;

  var valueAccessor = _dataUtils.maybeToDate.bind(null, isTime, fieldIdx, field.format);

  var domain;

  switch (field.type) {
    case _defaultSettings.ALL_FIELD_TYPES.real:
    case _defaultSettings.ALL_FIELD_TYPES.integer:
      // calculate domain and step
      return getNumericFieldDomain(data, valueAccessor);

    case _defaultSettings.ALL_FIELD_TYPES["boolean"]:
      return {
        domain: [true, false]
      };

    case _defaultSettings.ALL_FIELD_TYPES.string:
    case _defaultSettings.ALL_FIELD_TYPES.date:
      domain = ScaleUtils.getOrdinalDomain(data, valueAccessor);
      return {
        domain: domain
      };

    case _defaultSettings.ALL_FIELD_TYPES.timestamp:
      return getTimestampFieldDomain(data, valueAccessor);

    default:
      return {
        domain: ScaleUtils.getOrdinalDomain(data, valueAccessor)
      };
  }
}
/**
 * Filter data based on an array of filters
 *
 * @param {Object[]} data
 * @param {string} dataId
 * @param {Object[]} filters
 * @returns {Object[]} data
 * @returns {Number[]} filteredIndex
 */


function filterData(data, dataId, filters) {
  if (!data || !dataId) {
    // why would there not be any data? are we over doing this?
    return {
      data: [],
      filteredIndex: []
    };
  }

  if (!filters.length) {
    return {
      data: data,
      filteredIndex: data.map(function (d, i) {
        return i;
      })
    };
  }

  var appliedFilters = filters.filter(function (d) {
    return d.dataId === dataId && d.fieldIdx > -1 && d.value !== null;
  });

  var _appliedFilters$reduc = appliedFilters.reduce(function (accu, f) {
    if (f.dataId === dataId && f.fieldIdx > -1 && f.value !== null) {
      (f.fixedDomain ? accu[1] : accu[0]).push(f);
    }

    return accu;
  }, [[], []]),
      _appliedFilters$reduc2 = (0, _slicedToArray2["default"])(_appliedFilters$reduc, 2),
      dynamicDomainFilters = _appliedFilters$reduc2[0],
      fixedDomainFilters = _appliedFilters$reduc2[1]; // console.log(dynamicDomainFilters)
  // console.log(fixedDomainFilters)
  // we save a reference of allData index here to access dataToFeature
  // in geojson and hexgonId layer
  // console.time('filterData');


  var _data$reduce = data.reduce(function (accu, d, i) {
    // generate 2 sets of
    // filter data used to calculate layer Domain
    var matchForDomain = dynamicDomainFilters.every(function (filter) {
      return isDataMatchFilter(d, filter, i);
    });

    if (matchForDomain) {
      accu.filteredIndexForDomain.push(i); // filter data for render

      var matchForRender = fixedDomainFilters.every(function (filter) {
        return isDataMatchFilter(d, filter, i);
      });

      if (matchForRender) {
        accu.filtered.push(d);
        accu.filteredIndex.push(i);
      }
    }

    return accu;
  }, {
    filtered: [],
    filteredIndex: [],
    filteredIndexForDomain: []
  }),
      filtered = _data$reduce.filtered,
      filteredIndex = _data$reduce.filteredIndex,
      filteredIndexForDomain = _data$reduce.filteredIndexForDomain; // console.log('data==', data.length)
  // console.log('filtered==', filtered.length)
  // console.log('filteredIndex==', filteredIndex.length)
  // console.log('filteredIndexForDomain==', filteredIndexForDomain.length)
  //
  // console.timeEnd('filterData');


  return {
    data: filtered,
    filteredIndex: filteredIndex,
    filteredIndexForDomain: filteredIndexForDomain
  };
}
/**
 * Check if value is in range of filter
 *
 * @param {Object[]} data
 * @param {Object} filter
 * @param {number} i
 * @returns {Boolean} - whether value falls in the range of the filter
 */


function isDataMatchFilter(data, filter, i) {
  var val = data[filter.fieldIdx];

  if (!filter.type) {
    return true;
  }

  switch (filter.type) {
    case FILTER_TYPES.range:
      return isInRange(val, filter.value);

    case FILTER_TYPES.timeRange:
      var timeVal = filter.mappedValue ? filter.mappedValue[i] : _moment["default"].utc(val).valueOf();
      return isInRange(timeVal, filter.value);

    case FILTER_TYPES.multiSelect:
      return filter.value.includes(val);

    case FILTER_TYPES.select:
      return filter.value === val;

    default:
      return true;
  }
}
/**
 * Call by parsing filters from URL
 * Check if value of filter within filter domain, if not adjust it to match
 * filter domain
 *
 * @param {string[] | string | number | number[]} value
 * @param {Array} filter.domain
 * @param {String} filter.type
 * @returns {*} - adjusted value to match filter or null to remove filter
 */

/* eslint-disable complexity */


function adjustValueToFilterDomain(value, _ref) {
  var domain = _ref.domain,
      type = _ref.type;

  if (!domain || !type) {
    return false;
  }

  switch (type) {
    case FILTER_TYPES.range:
    case FILTER_TYPES.timeRange:
      if (!Array.isArray(value) || value.length !== 2) {
        return domain.map(function (d) {
          return d;
        });
      }

      return value.map(function (d, i) {
        return (0, _dataUtils.notNullorUndefined)(d) && isInRange(d, domain) ? d : domain[i];
      });

    case FILTER_TYPES.multiSelect:
      if (!Array.isArray(value)) {
        return [];
      }

      var filteredValue = value.filter(function (d) {
        return domain.includes(d);
      });
      return filteredValue.length ? filteredValue : [];

    case FILTER_TYPES.select:
      return domain.includes(value) ? value : true;

    default:
      return null;
  }
}
/* eslint-enable complexity */

/**
 * Calculate numeric domain and suitable step
 *
 * @param {Object[]} data
 * @param {function} valueAccessor
 * @returns {object} domain and step
 */


function getNumericFieldDomain(data, valueAccessor) {
  var domain = [0, 1];
  var step = 0.1;
  var mappedValue = Array.isArray(data) ? data.map(valueAccessor) : [];

  if (Array.isArray(data) && data.length > 1) {
    domain = ScaleUtils.getLinearDomain(mappedValue);
    var diff = domain[1] - domain[0]; // in case equal domain, [96, 96], which will break quantize scale

    if (!diff) {
      domain[1] = domain[0] + 1;
    }

    step = getNumericStepSize(diff) || step;
    domain[0] = formatNumberByStep(domain[0], step, 'floor');
    domain[1] = formatNumberByStep(domain[1], step, 'ceil');
  }

  var _getHistogram = getHistogram(domain, mappedValue),
      histogram = _getHistogram.histogram,
      enlargedHistogram = _getHistogram.enlargedHistogram;

  return {
    domain: domain,
    step: step,
    histogram: histogram,
    enlargedHistogram: enlargedHistogram
  };
}

function getNumericStepSize(diff) {
  if (diff > 100) {
    return 1;
  } else if (diff < 20 && diff > 3) {
    return 0.01;
  } else if (diff <= 3) {
    return 0.001;
  }
}
/**
 * Calculate timestamp domain and suitable step
 *
 * @param {Object[]} data
 * @param {function} valueAccessor
 * @returns {object} domain and step
 */


function getTimestampFieldDomain(data, valueAccessor) {
  // to avoid converting string format time to epoch
  // every time we compare we store a value mapped to int in filter domain
  var mappedValue = Array.isArray(data) ? data.map(valueAccessor) : [];
  var domain = ScaleUtils.getLinearDomain(mappedValue);
  var step = 0.01;
  var diff = domain[1] - domain[0];
  var entry = TimestampStepMap.find(function (f) {
    return f.max >= diff;
  });

  if (entry) {
    step = entry.step;
  }

  var _getHistogram2 = getHistogram(domain, mappedValue),
      histogram = _getHistogram2.histogram,
      enlargedHistogram = _getHistogram2.enlargedHistogram;

  return {
    domain: domain,
    step: step,
    mappedValue: mappedValue,
    histogram: histogram,
    enlargedHistogram: enlargedHistogram
  };
}

function histogramConstruct(domain, mappedValue, bins) {
  return (0, _d3Array.histogram)().thresholds((0, _d3Array.ticks)(domain[0], domain[1], bins)).domain(domain)(mappedValue).map(function (bin) {
    return {
      count: bin.length,
      x0: bin.x0,
      x1: bin.x1
    };
  });
}
/**
 * Calculate histogram from domain and array of values
 *
 * @param {number[]} domain
 * @param {Object[]} mappedValue
 * @returns {Array[]} histogram
 */


function getHistogram(domain, mappedValue) {
  var histogram = histogramConstruct(domain, mappedValue, histogramBins);
  var enlargedHistogram = histogramConstruct(domain, mappedValue, enlargedHistogramBins);
  return {
    histogram: histogram,
    enlargedHistogram: enlargedHistogram
  };
}
/**
 * round number based on step
 *
 * @param {number} val
 * @param {number} step
 * @param {string} bound
 * @returns {number} rounded number
 */


function formatNumberByStep(val, step, bound) {
  if (bound === 'floor') {
    return Math.floor(val * (1 / step)) / (1 / step);
  }

  return Math.ceil(val * (1 / step)) / (1 / step);
}

function isInRange(val, domain) {
  if (!Array.isArray(domain)) {
    return false;
  }

  return val >= domain[0] && val <= domain[1];
}

function getTimeWidgetTitleFormatter(domain) {
  if (!Array.isArray(domain)) {
    return null;
  }

  var diff = domain[1] - domain[0];
  return diff > durationYear ? 'MM/DD/YY' : diff > durationDay ? 'MM/DD/YY hh:mma' : 'MM/DD/YY hh:mm:ssa';
}

function getTimeWidgetHintFormatter(domain) {
  if (!Array.isArray(domain)) {
    return null;
  }

  var diff = domain[1] - domain[0];
  return diff > durationYear ? 'MM/DD/YY' : diff > durationWeek ? 'MM/DD' : diff > durationDay ? 'MM/DD hha' : diff > durationHour ? 'hh:mma' : 'hh:mm:ssa';
}
/**
 * Sanity check on filters to prepare for save
 * @param {String} type - filter type
 * @param {*} value - filter value
 * @returns {boolean} whether filter is value
 */


function isValidFilterValue(_ref2) {
  var type = _ref2.type,
      value = _ref2.value;

  if (!type) {
    return false;
  }

  switch (type) {
    case FILTER_TYPES.select:
      return value === true || value === false;

    case FILTER_TYPES.range:
    case FILTER_TYPES.timeRange:
      return Array.isArray(value) && value.every(function (v) {
        return v !== null && !isNaN(v);
      });

    case FILTER_TYPES.multiSelect:
      return Array.isArray(value) && Boolean(value.length);

    case FILTER_TYPES.input:
      return Boolean(value.length);

    default:
      return true;
  }
}

function getFilterPlot(filter, allData) {
  if (filter.plotType === PLOT_TYPES.histogram || !filter.yAxis) {
    // histogram should be calculated when create filter
    return {};
  }

  var mappedValue = filter.mappedValue;
  var yAxis = filter.yAxis; // return lineChart

  var series = allData.map(function (d, i) {
    return {
      x: mappedValue[i],
      y: d[yAxis.tableFieldIndex - 1]
    };
  }).filter(function (_ref3) {
    var x = _ref3.x,
        y = _ref3.y;
    return Number.isFinite(x) && Number.isFinite(y);
  }).sort(function (a, b) {
    return (0, _d3Array.ascending)(a.x, b.x);
  });
  var yDomain = (0, _d3Array.extent)(series, function (d) {
    return d.y;
  });
  var xDomain = [series[0].x, series[series.length - 1].x];
  return {
    lineChart: {
      series: series,
      yDomain: yDomain,
      xDomain: xDomain
    },
    yAxis: yAxis
  };
}

function getDefaultFilterPlotType(filter) {
  var filterPlotTypes = SupportedPlotType[filter.type];

  if (!filterPlotTypes) {
    return null;
  }

  if (!filter.yAxis) {
    return filterPlotTypes["default"];
  }

  return filterPlotTypes[filter.yAxis.type] || null;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy9maWx0ZXItdXRpbHMuanMiXSwibmFtZXMiOlsiVGltZXN0YW1wU3RlcE1hcCIsIm1heCIsInN0ZXAiLCJOdW1iZXIiLCJQT1NJVElWRV9JTkZJTklUWSIsImhpc3RvZ3JhbUJpbnMiLCJlbmxhcmdlZEhpc3RvZ3JhbUJpbnMiLCJkdXJhdGlvblNlY29uZCIsImR1cmF0aW9uTWludXRlIiwiZHVyYXRpb25Ib3VyIiwiZHVyYXRpb25EYXkiLCJkdXJhdGlvbldlZWsiLCJkdXJhdGlvblllYXIiLCJGSUxURVJfVFlQRVMiLCJyYW5nZSIsInNlbGVjdCIsInRpbWVSYW5nZSIsIm11bHRpU2VsZWN0IiwiUExPVF9UWVBFUyIsImhpc3RvZ3JhbSIsImxpbmVDaGFydCIsIlN1cHBvcnRlZFBsb3RUeXBlIiwiQUxMX0ZJRUxEX1RZUEVTIiwiaW50ZWdlciIsInJlYWwiLCJGSUxURVJfQ09NUE9ORU5UUyIsImdldERlZmF1bHRGaWx0ZXIiLCJkYXRhSWQiLCJmcmVlemUiLCJpZCIsImZpeGVkRG9tYWluIiwiZW5sYXJnZWQiLCJpc0FuaW1hdGluZyIsInNwZWVkIiwibmFtZSIsInR5cGUiLCJmaWVsZElkeCIsImRvbWFpbiIsInZhbHVlIiwicGxvdFR5cGUiLCJ5QXhpcyIsImludGVydmFsIiwiZ2V0RmlsdGVyUHJvcHMiLCJkYXRhIiwiZmllbGQiLCJmaWx0ZXJQcm9wIiwiZ2V0RmllbGREb21haW4iLCJmaWVsZFR5cGUiLCJ0eXBlT3B0aW9ucyIsInN0cmluZyIsImRhdGUiLCJ0aW1lc3RhbXAiLCJ0YWJsZUZpZWxkSW5kZXgiLCJpc1RpbWUiLCJ2YWx1ZUFjY2Vzc29yIiwibWF5YmVUb0RhdGUiLCJiaW5kIiwiZm9ybWF0IiwiZ2V0TnVtZXJpY0ZpZWxkRG9tYWluIiwiU2NhbGVVdGlscyIsImdldE9yZGluYWxEb21haW4iLCJnZXRUaW1lc3RhbXBGaWVsZERvbWFpbiIsImZpbHRlckRhdGEiLCJmaWx0ZXJzIiwiZmlsdGVyZWRJbmRleCIsImxlbmd0aCIsIm1hcCIsImQiLCJpIiwiYXBwbGllZEZpbHRlcnMiLCJmaWx0ZXIiLCJyZWR1Y2UiLCJhY2N1IiwiZiIsInB1c2giLCJkeW5hbWljRG9tYWluRmlsdGVycyIsImZpeGVkRG9tYWluRmlsdGVycyIsIm1hdGNoRm9yRG9tYWluIiwiZXZlcnkiLCJpc0RhdGFNYXRjaEZpbHRlciIsImZpbHRlcmVkSW5kZXhGb3JEb21haW4iLCJtYXRjaEZvclJlbmRlciIsImZpbHRlcmVkIiwidmFsIiwiaXNJblJhbmdlIiwidGltZVZhbCIsIm1hcHBlZFZhbHVlIiwibW9tZW50IiwidXRjIiwidmFsdWVPZiIsImluY2x1ZGVzIiwiYWRqdXN0VmFsdWVUb0ZpbHRlckRvbWFpbiIsIkFycmF5IiwiaXNBcnJheSIsImZpbHRlcmVkVmFsdWUiLCJnZXRMaW5lYXJEb21haW4iLCJkaWZmIiwiZ2V0TnVtZXJpY1N0ZXBTaXplIiwiZm9ybWF0TnVtYmVyQnlTdGVwIiwiZ2V0SGlzdG9ncmFtIiwiZW5sYXJnZWRIaXN0b2dyYW0iLCJlbnRyeSIsImZpbmQiLCJoaXN0b2dyYW1Db25zdHJ1Y3QiLCJiaW5zIiwidGhyZXNob2xkcyIsImJpbiIsImNvdW50IiwieDAiLCJ4MSIsImJvdW5kIiwiTWF0aCIsImZsb29yIiwiY2VpbCIsImdldFRpbWVXaWRnZXRUaXRsZUZvcm1hdHRlciIsImdldFRpbWVXaWRnZXRIaW50Rm9ybWF0dGVyIiwiaXNWYWxpZEZpbHRlclZhbHVlIiwidiIsImlzTmFOIiwiQm9vbGVhbiIsImlucHV0IiwiZ2V0RmlsdGVyUGxvdCIsImFsbERhdGEiLCJzZXJpZXMiLCJ4IiwieSIsImlzRmluaXRlIiwic29ydCIsImEiLCJiIiwieURvbWFpbiIsInhEb21haW4iLCJnZXREZWZhdWx0RmlsdGVyUGxvdFR5cGUiLCJmaWx0ZXJQbG90VHlwZXMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvQkE7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7O0FBRU8sSUFBTUEsZ0JBQWdCLEdBQUcsQ0FDOUI7QUFBQ0MsRUFBQUEsR0FBRyxFQUFFLENBQU47QUFBU0MsRUFBQUEsSUFBSSxFQUFFO0FBQWYsQ0FEOEIsRUFFOUI7QUFBQ0QsRUFBQUEsR0FBRyxFQUFFLEVBQU47QUFBVUMsRUFBQUEsSUFBSSxFQUFFO0FBQWhCLENBRjhCLEVBRzlCO0FBQUNELEVBQUFBLEdBQUcsRUFBRSxHQUFOO0FBQVdDLEVBQUFBLElBQUksRUFBRTtBQUFqQixDQUg4QixFQUk5QjtBQUFDRCxFQUFBQSxHQUFHLEVBQUUsR0FBTjtBQUFXQyxFQUFBQSxJQUFJLEVBQUU7QUFBakIsQ0FKOEIsRUFLOUI7QUFBQ0QsRUFBQUEsR0FBRyxFQUFFLElBQU47QUFBWUMsRUFBQUEsSUFBSSxFQUFFO0FBQWxCLENBTDhCLEVBTTlCO0FBQUNELEVBQUFBLEdBQUcsRUFBRSxJQUFOO0FBQVlDLEVBQUFBLElBQUksRUFBRTtBQUFsQixDQU44QixFQU85QjtBQUFDRCxFQUFBQSxHQUFHLEVBQUVFLE1BQU0sQ0FBQ0MsaUJBQWI7QUFBZ0NGLEVBQUFBLElBQUksRUFBRTtBQUF0QyxDQVA4QixDQUF6Qjs7QUFVQSxJQUFNRyxhQUFhLEdBQUcsRUFBdEI7O0FBQ0EsSUFBTUMscUJBQXFCLEdBQUcsR0FBOUI7O0FBRVAsSUFBTUMsY0FBYyxHQUFHLElBQXZCO0FBQ0EsSUFBTUMsY0FBYyxHQUFHRCxjQUFjLEdBQUcsRUFBeEM7QUFDQSxJQUFNRSxZQUFZLEdBQUdELGNBQWMsR0FBRyxFQUF0QztBQUNBLElBQU1FLFdBQVcsR0FBR0QsWUFBWSxHQUFHLEVBQW5DO0FBQ0EsSUFBTUUsWUFBWSxHQUFHRCxXQUFXLEdBQUcsQ0FBbkM7QUFDQSxJQUFNRSxZQUFZLEdBQUdGLFdBQVcsR0FBRyxHQUFuQztBQUVPLElBQU1HLFlBQVksR0FBRywyQkFBVTtBQUNwQ0MsRUFBQUEsS0FBSyxFQUFFLElBRDZCO0FBRXBDQyxFQUFBQSxNQUFNLEVBQUUsSUFGNEI7QUFHcENDLEVBQUFBLFNBQVMsRUFBRSxJQUh5QjtBQUlwQ0MsRUFBQUEsV0FBVyxFQUFFO0FBSnVCLENBQVYsQ0FBckI7O0FBT0EsSUFBTUMsVUFBVSxHQUFHLDJCQUFVO0FBQ2xDQyxFQUFBQSxTQUFTLEVBQUUsSUFEdUI7QUFFbENDLEVBQUFBLFNBQVMsRUFBRTtBQUZ1QixDQUFWLENBQW5COztBQUtQLElBQU1DLGlCQUFpQixrRkFDcEJSLFlBQVksQ0FBQ0csU0FETztBQUVuQixhQUFTO0FBRlUsMkRBR2xCTSxpQ0FBZ0JDLE9BSEUsRUFHUSxXQUhSLDJEQUlsQkQsaUNBQWdCRSxJQUpFLEVBSUssV0FKTCxpRkFNcEJYLFlBQVksQ0FBQ0MsS0FOTztBQU9uQixhQUFTO0FBUFUseURBUWxCUSxpQ0FBZ0JDLE9BUkUsRUFRUSxXQVJSLHlEQVNsQkQsaUNBQWdCRSxJQVRFLEVBU0ssV0FUTCw2Q0FBdkI7QUFhTyxJQUFNQyxpQkFBaUIsa0ZBQzNCWixZQUFZLENBQUNFLE1BRGMsRUFDTCxvQkFESyx3REFFM0JGLFlBQVksQ0FBQ0ksV0FGYyxFQUVBLG1CQUZBLHdEQUczQkosWUFBWSxDQUFDRyxTQUhjLEVBR0YsaUJBSEUsd0RBSTNCSCxZQUFZLENBQUNDLEtBSmMsRUFJTixhQUpNLHNCQUF2Qjs7O0FBT0EsU0FBU1ksZ0JBQVQsQ0FBMEJDLE1BQTFCLEVBQWtDO0FBQ3ZDLFNBQU87QUFDTDtBQUNBQSxJQUFBQSxNQUFNLEVBQU5BLE1BRks7QUFHTDtBQUNBQyxJQUFBQSxNQUFNLEVBQUUsS0FKSDtBQUtMQyxJQUFBQSxFQUFFLEVBQUUsMkJBQWUsQ0FBZixDQUxDO0FBT0w7QUFDQUMsSUFBQUEsV0FBVyxFQUFFLEtBUlI7QUFTTEMsSUFBQUEsUUFBUSxFQUFFLEtBVEw7QUFVTEMsSUFBQUEsV0FBVyxFQUFFLEtBVlI7QUFXTEMsSUFBQUEsS0FBSyxFQUFFLENBWEY7QUFhTDtBQUNBQyxJQUFBQSxJQUFJLEVBQUUsSUFkRDtBQWVMQyxJQUFBQSxJQUFJLEVBQUUsSUFmRDtBQWdCTEMsSUFBQUEsUUFBUSxFQUFFLElBaEJMO0FBaUJMQyxJQUFBQSxNQUFNLEVBQUUsSUFqQkg7QUFrQkxDLElBQUFBLEtBQUssRUFBRSxJQWxCRjtBQW9CTDtBQUNBQyxJQUFBQSxRQUFRLEVBQUVyQixVQUFVLENBQUNDLFNBckJoQjtBQXNCTHFCLElBQUFBLEtBQUssRUFBRSxJQXRCRjtBQXVCTEMsSUFBQUEsUUFBUSxFQUFFO0FBdkJMLEdBQVA7QUF5QkQ7QUFFRDs7Ozs7Ozs7O0FBT08sU0FBU0MsY0FBVCxDQUF3QkMsSUFBeEIsRUFBOEJDLEtBQTlCLEVBQXFDO0FBQzFDLE1BQU1DLFVBQVUscUJBQ1hDLGNBQWMsQ0FBQ0gsSUFBRCxFQUFPQyxLQUFQLENBREg7QUFFZEcsSUFBQUEsU0FBUyxFQUFFSCxLQUFLLENBQUNUO0FBRkgsSUFBaEI7O0FBS0EsVUFBUVMsS0FBSyxDQUFDVCxJQUFkO0FBQ0UsU0FBS2IsaUNBQWdCRSxJQUFyQjtBQUNBLFNBQUtGLGlDQUFnQkMsT0FBckI7QUFDRSwrQkFDS3NCLFVBREw7QUFFRVAsUUFBQUEsS0FBSyxFQUFFTyxVQUFVLENBQUNSLE1BRnBCO0FBR0VGLFFBQUFBLElBQUksRUFBRXRCLFlBQVksQ0FBQ0MsS0FIckI7QUFJRWtDLFFBQUFBLFdBQVcsRUFBRSxDQUFDbkMsWUFBWSxDQUFDQyxLQUFkO0FBSmY7O0FBT0YsU0FBS1EsMkNBQUw7QUFDRSwrQkFDS3VCLFVBREw7QUFFRVYsUUFBQUEsSUFBSSxFQUFFdEIsWUFBWSxDQUFDRSxNQUZyQjtBQUdFdUIsUUFBQUEsS0FBSyxFQUFFO0FBSFQ7O0FBTUYsU0FBS2hCLGlDQUFnQjJCLE1BQXJCO0FBQ0EsU0FBSzNCLGlDQUFnQjRCLElBQXJCO0FBQ0UsK0JBQ0tMLFVBREw7QUFFRVYsUUFBQUEsSUFBSSxFQUFFdEIsWUFBWSxDQUFDSSxXQUZyQjtBQUdFcUIsUUFBQUEsS0FBSyxFQUFFO0FBSFQ7O0FBTUYsU0FBS2hCLGlDQUFnQjZCLFNBQXJCO0FBQ0UsK0JBQ0tOLFVBREw7QUFFRVYsUUFBQUEsSUFBSSxFQUFFdEIsWUFBWSxDQUFDRyxTQUZyQjtBQUdFZSxRQUFBQSxRQUFRLEVBQUUsSUFIWjtBQUlFRCxRQUFBQSxXQUFXLEVBQUUsSUFKZjtBQUtFUSxRQUFBQSxLQUFLLEVBQUVPLFVBQVUsQ0FBQ1I7QUFMcEI7O0FBUUY7QUFDRSxhQUFPLEVBQVA7QUFuQ0o7QUFxQ0Q7QUFFRDs7Ozs7Ozs7O0FBT08sU0FBU1MsY0FBVCxDQUF3QkgsSUFBeEIsRUFBOEJDLEtBQTlCLEVBQXFDO0FBQzFDLE1BQU1SLFFBQVEsR0FBR1EsS0FBSyxDQUFDUSxlQUFOLEdBQXdCLENBQXpDO0FBQ0EsTUFBTUMsTUFBTSxHQUFHVCxLQUFLLENBQUNULElBQU4sS0FBZWIsaUNBQWdCNkIsU0FBOUM7O0FBQ0EsTUFBTUcsYUFBYSxHQUFHQyx1QkFBWUMsSUFBWixDQUFpQixJQUFqQixFQUF1QkgsTUFBdkIsRUFBK0JqQixRQUEvQixFQUF5Q1EsS0FBSyxDQUFDYSxNQUEvQyxDQUF0Qjs7QUFDQSxNQUFJcEIsTUFBSjs7QUFFQSxVQUFRTyxLQUFLLENBQUNULElBQWQ7QUFDRSxTQUFLYixpQ0FBZ0JFLElBQXJCO0FBQ0EsU0FBS0YsaUNBQWdCQyxPQUFyQjtBQUNFO0FBQ0EsYUFBT21DLHFCQUFxQixDQUFDZixJQUFELEVBQU9XLGFBQVAsQ0FBNUI7O0FBRUYsU0FBS2hDLDJDQUFMO0FBQ0UsYUFBTztBQUFDZSxRQUFBQSxNQUFNLEVBQUUsQ0FBQyxJQUFELEVBQU8sS0FBUDtBQUFULE9BQVA7O0FBRUYsU0FBS2YsaUNBQWdCMkIsTUFBckI7QUFDQSxTQUFLM0IsaUNBQWdCNEIsSUFBckI7QUFDRWIsTUFBQUEsTUFBTSxHQUFHc0IsVUFBVSxDQUFDQyxnQkFBWCxDQUE0QmpCLElBQTVCLEVBQWtDVyxhQUFsQyxDQUFUO0FBQ0EsYUFBTztBQUFDakIsUUFBQUEsTUFBTSxFQUFOQTtBQUFELE9BQVA7O0FBRUYsU0FBS2YsaUNBQWdCNkIsU0FBckI7QUFDRSxhQUFPVSx1QkFBdUIsQ0FBQ2xCLElBQUQsRUFBT1csYUFBUCxDQUE5Qjs7QUFFRjtBQUNFLGFBQU87QUFBQ2pCLFFBQUFBLE1BQU0sRUFBRXNCLFVBQVUsQ0FBQ0MsZ0JBQVgsQ0FBNEJqQixJQUE1QixFQUFrQ1csYUFBbEM7QUFBVCxPQUFQO0FBbEJKO0FBb0JEO0FBRUQ7Ozs7Ozs7Ozs7O0FBU08sU0FBU1EsVUFBVCxDQUFvQm5CLElBQXBCLEVBQTBCaEIsTUFBMUIsRUFBa0NvQyxPQUFsQyxFQUEyQztBQUNoRCxNQUFJLENBQUNwQixJQUFELElBQVMsQ0FBQ2hCLE1BQWQsRUFBc0I7QUFDcEI7QUFDQSxXQUFPO0FBQUNnQixNQUFBQSxJQUFJLEVBQUUsRUFBUDtBQUFXcUIsTUFBQUEsYUFBYSxFQUFFO0FBQTFCLEtBQVA7QUFDRDs7QUFFRCxNQUFJLENBQUNELE9BQU8sQ0FBQ0UsTUFBYixFQUFxQjtBQUNuQixXQUFPO0FBQUN0QixNQUFBQSxJQUFJLEVBQUpBLElBQUQ7QUFBT3FCLE1BQUFBLGFBQWEsRUFBRXJCLElBQUksQ0FBQ3VCLEdBQUwsQ0FBUyxVQUFDQyxDQUFELEVBQUlDLENBQUo7QUFBQSxlQUFVQSxDQUFWO0FBQUEsT0FBVDtBQUF0QixLQUFQO0FBQ0Q7O0FBRUQsTUFBTUMsY0FBYyxHQUFHTixPQUFPLENBQUNPLE1BQVIsQ0FDckIsVUFBQUgsQ0FBQztBQUFBLFdBQUlBLENBQUMsQ0FBQ3hDLE1BQUYsS0FBYUEsTUFBYixJQUF1QndDLENBQUMsQ0FBQy9CLFFBQUYsR0FBYSxDQUFDLENBQXJDLElBQTBDK0IsQ0FBQyxDQUFDN0IsS0FBRixLQUFZLElBQTFEO0FBQUEsR0FEb0IsQ0FBdkI7O0FBVmdELDhCQWNHK0IsY0FBYyxDQUFDRSxNQUFmLENBQ2pELFVBQUNDLElBQUQsRUFBT0MsQ0FBUCxFQUFhO0FBQ1gsUUFBSUEsQ0FBQyxDQUFDOUMsTUFBRixLQUFhQSxNQUFiLElBQXVCOEMsQ0FBQyxDQUFDckMsUUFBRixHQUFhLENBQUMsQ0FBckMsSUFBMENxQyxDQUFDLENBQUNuQyxLQUFGLEtBQVksSUFBMUQsRUFBZ0U7QUFDOUQsT0FBQ21DLENBQUMsQ0FBQzNDLFdBQUYsR0FBZ0IwQyxJQUFJLENBQUMsQ0FBRCxDQUFwQixHQUEwQkEsSUFBSSxDQUFDLENBQUQsQ0FBL0IsRUFBb0NFLElBQXBDLENBQXlDRCxDQUF6QztBQUNEOztBQUNELFdBQU9ELElBQVA7QUFDRCxHQU5nRCxFQU9qRCxDQUFDLEVBQUQsRUFBSyxFQUFMLENBUGlELENBZEg7QUFBQTtBQUFBLE1BY3pDRyxvQkFkeUM7QUFBQSxNQWNuQkMsa0JBZG1CLDhCQXVCaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBM0JnRCxxQkE2QlVqQyxJQUFJLENBQUM0QixNQUFMLENBQ3hELFVBQUNDLElBQUQsRUFBT0wsQ0FBUCxFQUFVQyxDQUFWLEVBQWdCO0FBQ2Q7QUFDQTtBQUNBLFFBQU1TLGNBQWMsR0FBR0Ysb0JBQW9CLENBQUNHLEtBQXJCLENBQTJCLFVBQUFSLE1BQU07QUFBQSxhQUN0RFMsaUJBQWlCLENBQUNaLENBQUQsRUFBSUcsTUFBSixFQUFZRixDQUFaLENBRHFDO0FBQUEsS0FBakMsQ0FBdkI7O0FBSUEsUUFBSVMsY0FBSixFQUFvQjtBQUNsQkwsTUFBQUEsSUFBSSxDQUFDUSxzQkFBTCxDQUE0Qk4sSUFBNUIsQ0FBaUNOLENBQWpDLEVBRGtCLENBR2xCOztBQUNBLFVBQU1hLGNBQWMsR0FBR0wsa0JBQWtCLENBQUNFLEtBQW5CLENBQXlCLFVBQUFSLE1BQU07QUFBQSxlQUNwRFMsaUJBQWlCLENBQUNaLENBQUQsRUFBSUcsTUFBSixFQUFZRixDQUFaLENBRG1DO0FBQUEsT0FBL0IsQ0FBdkI7O0FBSUEsVUFBSWEsY0FBSixFQUFvQjtBQUNsQlQsUUFBQUEsSUFBSSxDQUFDVSxRQUFMLENBQWNSLElBQWQsQ0FBbUJQLENBQW5CO0FBQ0FLLFFBQUFBLElBQUksQ0FBQ1IsYUFBTCxDQUFtQlUsSUFBbkIsQ0FBd0JOLENBQXhCO0FBQ0Q7QUFDRjs7QUFFRCxXQUFPSSxJQUFQO0FBQ0QsR0F2QnVELEVBd0J4RDtBQUFDVSxJQUFBQSxRQUFRLEVBQUUsRUFBWDtBQUFlbEIsSUFBQUEsYUFBYSxFQUFFLEVBQTlCO0FBQWtDZ0IsSUFBQUEsc0JBQXNCLEVBQUU7QUFBMUQsR0F4QndELENBN0JWO0FBQUEsTUE2QnpDRSxRQTdCeUMsZ0JBNkJ6Q0EsUUE3QnlDO0FBQUEsTUE2Qi9CbEIsYUE3QitCLGdCQTZCL0JBLGFBN0IrQjtBQUFBLE1BNkJoQmdCLHNCQTdCZ0IsZ0JBNkJoQkEsc0JBN0JnQixFQXdEaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFFQSxTQUFPO0FBQUNyQyxJQUFBQSxJQUFJLEVBQUV1QyxRQUFQO0FBQWlCbEIsSUFBQUEsYUFBYSxFQUFiQSxhQUFqQjtBQUFnQ2dCLElBQUFBLHNCQUFzQixFQUF0QkE7QUFBaEMsR0FBUDtBQUNEO0FBRUQ7Ozs7Ozs7Ozs7QUFRTyxTQUFTRCxpQkFBVCxDQUEyQnBDLElBQTNCLEVBQWlDMkIsTUFBakMsRUFBeUNGLENBQXpDLEVBQTRDO0FBQ2pELE1BQU1lLEdBQUcsR0FBR3hDLElBQUksQ0FBQzJCLE1BQU0sQ0FBQ2xDLFFBQVIsQ0FBaEI7O0FBQ0EsTUFBSSxDQUFDa0MsTUFBTSxDQUFDbkMsSUFBWixFQUFrQjtBQUNoQixXQUFPLElBQVA7QUFDRDs7QUFFRCxVQUFRbUMsTUFBTSxDQUFDbkMsSUFBZjtBQUNFLFNBQUt0QixZQUFZLENBQUNDLEtBQWxCO0FBQ0UsYUFBT3NFLFNBQVMsQ0FBQ0QsR0FBRCxFQUFNYixNQUFNLENBQUNoQyxLQUFiLENBQWhCOztBQUVGLFNBQUt6QixZQUFZLENBQUNHLFNBQWxCO0FBQ0UsVUFBTXFFLE9BQU8sR0FBR2YsTUFBTSxDQUFDZ0IsV0FBUCxHQUNaaEIsTUFBTSxDQUFDZ0IsV0FBUCxDQUFtQmxCLENBQW5CLENBRFksR0FFWm1CLG1CQUFPQyxHQUFQLENBQVdMLEdBQVgsRUFBZ0JNLE9BQWhCLEVBRko7QUFHQSxhQUFPTCxTQUFTLENBQUNDLE9BQUQsRUFBVWYsTUFBTSxDQUFDaEMsS0FBakIsQ0FBaEI7O0FBRUYsU0FBS3pCLFlBQVksQ0FBQ0ksV0FBbEI7QUFDRSxhQUFPcUQsTUFBTSxDQUFDaEMsS0FBUCxDQUFhb0QsUUFBYixDQUFzQlAsR0FBdEIsQ0FBUDs7QUFFRixTQUFLdEUsWUFBWSxDQUFDRSxNQUFsQjtBQUNFLGFBQU91RCxNQUFNLENBQUNoQyxLQUFQLEtBQWlCNkMsR0FBeEI7O0FBRUY7QUFDRSxhQUFPLElBQVA7QUFqQko7QUFtQkQ7QUFFRDs7Ozs7Ozs7Ozs7QUFXQTs7O0FBQ08sU0FBU1EseUJBQVQsQ0FBbUNyRCxLQUFuQyxRQUEwRDtBQUFBLE1BQWZELE1BQWUsUUFBZkEsTUFBZTtBQUFBLE1BQVBGLElBQU8sUUFBUEEsSUFBTzs7QUFDL0QsTUFBSSxDQUFDRSxNQUFELElBQVcsQ0FBQ0YsSUFBaEIsRUFBc0I7QUFDcEIsV0FBTyxLQUFQO0FBQ0Q7O0FBRUQsVUFBUUEsSUFBUjtBQUNFLFNBQUt0QixZQUFZLENBQUNDLEtBQWxCO0FBQ0EsU0FBS0QsWUFBWSxDQUFDRyxTQUFsQjtBQUNFLFVBQUksQ0FBQzRFLEtBQUssQ0FBQ0MsT0FBTixDQUFjdkQsS0FBZCxDQUFELElBQXlCQSxLQUFLLENBQUMyQixNQUFOLEtBQWlCLENBQTlDLEVBQWlEO0FBQy9DLGVBQU81QixNQUFNLENBQUM2QixHQUFQLENBQVcsVUFBQUMsQ0FBQztBQUFBLGlCQUFJQSxDQUFKO0FBQUEsU0FBWixDQUFQO0FBQ0Q7O0FBRUQsYUFBTzdCLEtBQUssQ0FBQzRCLEdBQU4sQ0FBVSxVQUFDQyxDQUFELEVBQUlDLENBQUo7QUFBQSxlQUNmLG1DQUFtQkQsQ0FBbkIsS0FBeUJpQixTQUFTLENBQUNqQixDQUFELEVBQUk5QixNQUFKLENBQWxDLEdBQWdEOEIsQ0FBaEQsR0FBb0Q5QixNQUFNLENBQUMrQixDQUFELENBRDNDO0FBQUEsT0FBVixDQUFQOztBQUlGLFNBQUt2RCxZQUFZLENBQUNJLFdBQWxCO0FBQ0UsVUFBSSxDQUFDMkUsS0FBSyxDQUFDQyxPQUFOLENBQWN2RCxLQUFkLENBQUwsRUFBMkI7QUFDekIsZUFBTyxFQUFQO0FBQ0Q7O0FBQ0QsVUFBTXdELGFBQWEsR0FBR3hELEtBQUssQ0FBQ2dDLE1BQU4sQ0FBYSxVQUFBSCxDQUFDO0FBQUEsZUFBSTlCLE1BQU0sQ0FBQ3FELFFBQVAsQ0FBZ0J2QixDQUFoQixDQUFKO0FBQUEsT0FBZCxDQUF0QjtBQUNBLGFBQU8yQixhQUFhLENBQUM3QixNQUFkLEdBQXVCNkIsYUFBdkIsR0FBdUMsRUFBOUM7O0FBRUYsU0FBS2pGLFlBQVksQ0FBQ0UsTUFBbEI7QUFDRSxhQUFPc0IsTUFBTSxDQUFDcUQsUUFBUCxDQUFnQnBELEtBQWhCLElBQXlCQSxLQUF6QixHQUFpQyxJQUF4Qzs7QUFFRjtBQUNFLGFBQU8sSUFBUDtBQXRCSjtBQXdCRDtBQUNEOztBQUVBOzs7Ozs7Ozs7QUFPTyxTQUFTb0IscUJBQVQsQ0FBK0JmLElBQS9CLEVBQXFDVyxhQUFyQyxFQUFvRDtBQUN6RCxNQUFJakIsTUFBTSxHQUFHLENBQUMsQ0FBRCxFQUFJLENBQUosQ0FBYjtBQUNBLE1BQUluQyxJQUFJLEdBQUcsR0FBWDtBQUVBLE1BQU1vRixXQUFXLEdBQUdNLEtBQUssQ0FBQ0MsT0FBTixDQUFjbEQsSUFBZCxJQUFzQkEsSUFBSSxDQUFDdUIsR0FBTCxDQUFTWixhQUFULENBQXRCLEdBQWdELEVBQXBFOztBQUVBLE1BQUlzQyxLQUFLLENBQUNDLE9BQU4sQ0FBY2xELElBQWQsS0FBdUJBLElBQUksQ0FBQ3NCLE1BQUwsR0FBYyxDQUF6QyxFQUE0QztBQUMxQzVCLElBQUFBLE1BQU0sR0FBR3NCLFVBQVUsQ0FBQ29DLGVBQVgsQ0FBMkJULFdBQTNCLENBQVQ7QUFDQSxRQUFNVSxJQUFJLEdBQUczRCxNQUFNLENBQUMsQ0FBRCxDQUFOLEdBQVlBLE1BQU0sQ0FBQyxDQUFELENBQS9CLENBRjBDLENBSTFDOztBQUNBLFFBQUksQ0FBQzJELElBQUwsRUFBVztBQUNUM0QsTUFBQUEsTUFBTSxDQUFDLENBQUQsQ0FBTixHQUFZQSxNQUFNLENBQUMsQ0FBRCxDQUFOLEdBQVksQ0FBeEI7QUFDRDs7QUFFRG5DLElBQUFBLElBQUksR0FBRytGLGtCQUFrQixDQUFDRCxJQUFELENBQWxCLElBQTRCOUYsSUFBbkM7QUFDQW1DLElBQUFBLE1BQU0sQ0FBQyxDQUFELENBQU4sR0FBWTZELGtCQUFrQixDQUFDN0QsTUFBTSxDQUFDLENBQUQsQ0FBUCxFQUFZbkMsSUFBWixFQUFrQixPQUFsQixDQUE5QjtBQUNBbUMsSUFBQUEsTUFBTSxDQUFDLENBQUQsQ0FBTixHQUFZNkQsa0JBQWtCLENBQUM3RCxNQUFNLENBQUMsQ0FBRCxDQUFQLEVBQVluQyxJQUFaLEVBQWtCLE1BQWxCLENBQTlCO0FBQ0Q7O0FBbEJ3RCxzQkFvQmxCaUcsWUFBWSxDQUFDOUQsTUFBRCxFQUFTaUQsV0FBVCxDQXBCTTtBQUFBLE1Bb0JsRG5FLFNBcEJrRCxpQkFvQmxEQSxTQXBCa0Q7QUFBQSxNQW9CdkNpRixpQkFwQnVDLGlCQW9CdkNBLGlCQXBCdUM7O0FBc0J6RCxTQUFPO0FBQUMvRCxJQUFBQSxNQUFNLEVBQU5BLE1BQUQ7QUFBU25DLElBQUFBLElBQUksRUFBSkEsSUFBVDtBQUFlaUIsSUFBQUEsU0FBUyxFQUFUQSxTQUFmO0FBQTBCaUYsSUFBQUEsaUJBQWlCLEVBQWpCQTtBQUExQixHQUFQO0FBQ0Q7O0FBRUQsU0FBU0gsa0JBQVQsQ0FBNEJELElBQTVCLEVBQWtDO0FBQ2hDLE1BQUlBLElBQUksR0FBRyxHQUFYLEVBQWdCO0FBQ2QsV0FBTyxDQUFQO0FBQ0QsR0FGRCxNQUVPLElBQUlBLElBQUksR0FBRyxFQUFQLElBQWFBLElBQUksR0FBRyxDQUF4QixFQUEyQjtBQUNoQyxXQUFPLElBQVA7QUFDRCxHQUZNLE1BRUEsSUFBSUEsSUFBSSxJQUFJLENBQVosRUFBZTtBQUNwQixXQUFPLEtBQVA7QUFDRDtBQUNGO0FBRUQ7Ozs7Ozs7OztBQU9PLFNBQVNuQyx1QkFBVCxDQUFpQ2xCLElBQWpDLEVBQXVDVyxhQUF2QyxFQUFzRDtBQUMzRDtBQUNBO0FBRUEsTUFBTWdDLFdBQVcsR0FBR00sS0FBSyxDQUFDQyxPQUFOLENBQWNsRCxJQUFkLElBQXNCQSxJQUFJLENBQUN1QixHQUFMLENBQVNaLGFBQVQsQ0FBdEIsR0FBZ0QsRUFBcEU7QUFDQSxNQUFNakIsTUFBTSxHQUFHc0IsVUFBVSxDQUFDb0MsZUFBWCxDQUEyQlQsV0FBM0IsQ0FBZjtBQUNBLE1BQUlwRixJQUFJLEdBQUcsSUFBWDtBQUVBLE1BQU04RixJQUFJLEdBQUczRCxNQUFNLENBQUMsQ0FBRCxDQUFOLEdBQVlBLE1BQU0sQ0FBQyxDQUFELENBQS9CO0FBQ0EsTUFBTWdFLEtBQUssR0FBR3JHLGdCQUFnQixDQUFDc0csSUFBakIsQ0FBc0IsVUFBQTdCLENBQUM7QUFBQSxXQUFJQSxDQUFDLENBQUN4RSxHQUFGLElBQVMrRixJQUFiO0FBQUEsR0FBdkIsQ0FBZDs7QUFDQSxNQUFJSyxLQUFKLEVBQVc7QUFDVG5HLElBQUFBLElBQUksR0FBR21HLEtBQUssQ0FBQ25HLElBQWI7QUFDRDs7QUFaMEQsdUJBY3BCaUcsWUFBWSxDQUFDOUQsTUFBRCxFQUFTaUQsV0FBVCxDQWRRO0FBQUEsTUFjcERuRSxTQWRvRCxrQkFjcERBLFNBZG9EO0FBQUEsTUFjekNpRixpQkFkeUMsa0JBY3pDQSxpQkFkeUM7O0FBZ0IzRCxTQUFPO0FBQUMvRCxJQUFBQSxNQUFNLEVBQU5BLE1BQUQ7QUFBU25DLElBQUFBLElBQUksRUFBSkEsSUFBVDtBQUFlb0YsSUFBQUEsV0FBVyxFQUFYQSxXQUFmO0FBQTRCbkUsSUFBQUEsU0FBUyxFQUFUQSxTQUE1QjtBQUF1Q2lGLElBQUFBLGlCQUFpQixFQUFqQkE7QUFBdkMsR0FBUDtBQUNEOztBQUVNLFNBQVNHLGtCQUFULENBQTRCbEUsTUFBNUIsRUFBb0NpRCxXQUFwQyxFQUFpRGtCLElBQWpELEVBQXVEO0FBQzVELFNBQU8sMEJBQ0pDLFVBREksQ0FDTyxvQkFBTXBFLE1BQU0sQ0FBQyxDQUFELENBQVosRUFBaUJBLE1BQU0sQ0FBQyxDQUFELENBQXZCLEVBQTRCbUUsSUFBNUIsQ0FEUCxFQUVKbkUsTUFGSSxDQUVHQSxNQUZILEVBRVdpRCxXQUZYLEVBR0pwQixHQUhJLENBR0EsVUFBQXdDLEdBQUc7QUFBQSxXQUFLO0FBQ1hDLE1BQUFBLEtBQUssRUFBRUQsR0FBRyxDQUFDekMsTUFEQTtBQUVYMkMsTUFBQUEsRUFBRSxFQUFFRixHQUFHLENBQUNFLEVBRkc7QUFHWEMsTUFBQUEsRUFBRSxFQUFFSCxHQUFHLENBQUNHO0FBSEcsS0FBTDtBQUFBLEdBSEgsQ0FBUDtBQVFEO0FBQ0Q7Ozs7Ozs7OztBQU9BLFNBQVNWLFlBQVQsQ0FBc0I5RCxNQUF0QixFQUE4QmlELFdBQTlCLEVBQTJDO0FBQ3pDLE1BQU1uRSxTQUFTLEdBQUdvRixrQkFBa0IsQ0FBQ2xFLE1BQUQsRUFBU2lELFdBQVQsRUFBc0JqRixhQUF0QixDQUFwQztBQUNBLE1BQU0rRixpQkFBaUIsR0FBR0csa0JBQWtCLENBQzFDbEUsTUFEMEMsRUFFMUNpRCxXQUYwQyxFQUcxQ2hGLHFCQUgwQyxDQUE1QztBQU1BLFNBQU87QUFBQ2EsSUFBQUEsU0FBUyxFQUFUQSxTQUFEO0FBQVlpRixJQUFBQSxpQkFBaUIsRUFBakJBO0FBQVosR0FBUDtBQUNEO0FBRUQ7Ozs7Ozs7Ozs7QUFRTyxTQUFTRixrQkFBVCxDQUE0QmYsR0FBNUIsRUFBaUNqRixJQUFqQyxFQUF1QzRHLEtBQXZDLEVBQThDO0FBQ25ELE1BQUlBLEtBQUssS0FBSyxPQUFkLEVBQXVCO0FBQ3JCLFdBQU9DLElBQUksQ0FBQ0MsS0FBTCxDQUFXN0IsR0FBRyxJQUFJLElBQUlqRixJQUFSLENBQWQsS0FBZ0MsSUFBSUEsSUFBcEMsQ0FBUDtBQUNEOztBQUVELFNBQU82RyxJQUFJLENBQUNFLElBQUwsQ0FBVTlCLEdBQUcsSUFBSSxJQUFJakYsSUFBUixDQUFiLEtBQStCLElBQUlBLElBQW5DLENBQVA7QUFDRDs7QUFFTSxTQUFTa0YsU0FBVCxDQUFtQkQsR0FBbkIsRUFBd0I5QyxNQUF4QixFQUFnQztBQUNyQyxNQUFJLENBQUN1RCxLQUFLLENBQUNDLE9BQU4sQ0FBY3hELE1BQWQsQ0FBTCxFQUE0QjtBQUMxQixXQUFPLEtBQVA7QUFDRDs7QUFFRCxTQUFPOEMsR0FBRyxJQUFJOUMsTUFBTSxDQUFDLENBQUQsQ0FBYixJQUFvQjhDLEdBQUcsSUFBSTlDLE1BQU0sQ0FBQyxDQUFELENBQXhDO0FBQ0Q7O0FBRU0sU0FBUzZFLDJCQUFULENBQXFDN0UsTUFBckMsRUFBNkM7QUFDbEQsTUFBSSxDQUFDdUQsS0FBSyxDQUFDQyxPQUFOLENBQWN4RCxNQUFkLENBQUwsRUFBNEI7QUFDMUIsV0FBTyxJQUFQO0FBQ0Q7O0FBRUQsTUFBTTJELElBQUksR0FBRzNELE1BQU0sQ0FBQyxDQUFELENBQU4sR0FBWUEsTUFBTSxDQUFDLENBQUQsQ0FBL0I7QUFDQSxTQUFPMkQsSUFBSSxHQUFHcEYsWUFBUCxHQUNILFVBREcsR0FFSG9GLElBQUksR0FBR3RGLFdBQVAsR0FDQSxpQkFEQSxHQUVBLG9CQUpKO0FBS0Q7O0FBRU0sU0FBU3lHLDBCQUFULENBQW9DOUUsTUFBcEMsRUFBNEM7QUFDakQsTUFBSSxDQUFDdUQsS0FBSyxDQUFDQyxPQUFOLENBQWN4RCxNQUFkLENBQUwsRUFBNEI7QUFDMUIsV0FBTyxJQUFQO0FBQ0Q7O0FBRUQsTUFBTTJELElBQUksR0FBRzNELE1BQU0sQ0FBQyxDQUFELENBQU4sR0FBWUEsTUFBTSxDQUFDLENBQUQsQ0FBL0I7QUFDQSxTQUFPMkQsSUFBSSxHQUFHcEYsWUFBUCxHQUNILFVBREcsR0FFSG9GLElBQUksR0FBR3JGLFlBQVAsR0FDQSxPQURBLEdBRUFxRixJQUFJLEdBQUd0RixXQUFQLEdBQ0EsV0FEQSxHQUVBc0YsSUFBSSxHQUFHdkYsWUFBUCxHQUNBLFFBREEsR0FFQSxXQVJKO0FBU0Q7QUFFRDs7Ozs7Ozs7QUFNTyxTQUFTMkcsa0JBQVQsUUFBMkM7QUFBQSxNQUFkakYsSUFBYyxTQUFkQSxJQUFjO0FBQUEsTUFBUkcsS0FBUSxTQUFSQSxLQUFROztBQUNoRCxNQUFJLENBQUNILElBQUwsRUFBVztBQUNULFdBQU8sS0FBUDtBQUNEOztBQUNELFVBQVFBLElBQVI7QUFDRSxTQUFLdEIsWUFBWSxDQUFDRSxNQUFsQjtBQUNFLGFBQU91QixLQUFLLEtBQUssSUFBVixJQUFrQkEsS0FBSyxLQUFLLEtBQW5DOztBQUVGLFNBQUt6QixZQUFZLENBQUNDLEtBQWxCO0FBQ0EsU0FBS0QsWUFBWSxDQUFDRyxTQUFsQjtBQUNFLGFBQU80RSxLQUFLLENBQUNDLE9BQU4sQ0FBY3ZELEtBQWQsS0FBd0JBLEtBQUssQ0FBQ3dDLEtBQU4sQ0FBWSxVQUFBdUMsQ0FBQztBQUFBLGVBQUlBLENBQUMsS0FBSyxJQUFOLElBQWMsQ0FBQ0MsS0FBSyxDQUFDRCxDQUFELENBQXhCO0FBQUEsT0FBYixDQUEvQjs7QUFFRixTQUFLeEcsWUFBWSxDQUFDSSxXQUFsQjtBQUNFLGFBQU8yRSxLQUFLLENBQUNDLE9BQU4sQ0FBY3ZELEtBQWQsS0FBd0JpRixPQUFPLENBQUNqRixLQUFLLENBQUMyQixNQUFQLENBQXRDOztBQUVGLFNBQUtwRCxZQUFZLENBQUMyRyxLQUFsQjtBQUNFLGFBQU9ELE9BQU8sQ0FBQ2pGLEtBQUssQ0FBQzJCLE1BQVAsQ0FBZDs7QUFFRjtBQUNFLGFBQU8sSUFBUDtBQWZKO0FBaUJEOztBQUVNLFNBQVN3RCxhQUFULENBQXVCbkQsTUFBdkIsRUFBK0JvRCxPQUEvQixFQUF3QztBQUM3QyxNQUFJcEQsTUFBTSxDQUFDL0IsUUFBUCxLQUFvQnJCLFVBQVUsQ0FBQ0MsU0FBL0IsSUFBNEMsQ0FBQ21ELE1BQU0sQ0FBQzlCLEtBQXhELEVBQStEO0FBQzdEO0FBQ0EsV0FBTyxFQUFQO0FBQ0Q7O0FBSjRDLE1BTXRDOEMsV0FOc0MsR0FNdkJoQixNQU51QixDQU10Q2dCLFdBTnNDO0FBQUEsTUFPdEM5QyxLQVBzQyxHQU83QjhCLE1BUDZCLENBT3RDOUIsS0FQc0MsRUFTN0M7O0FBQ0EsTUFBTW1GLE1BQU0sR0FBR0QsT0FBTyxDQUNuQnhELEdBRFksQ0FDUixVQUFDQyxDQUFELEVBQUlDLENBQUo7QUFBQSxXQUFXO0FBQ2R3RCxNQUFBQSxDQUFDLEVBQUV0QyxXQUFXLENBQUNsQixDQUFELENBREE7QUFFZHlELE1BQUFBLENBQUMsRUFBRTFELENBQUMsQ0FBQzNCLEtBQUssQ0FBQ1ksZUFBTixHQUF3QixDQUF6QjtBQUZVLEtBQVg7QUFBQSxHQURRLEVBS1prQixNQUxZLENBS0w7QUFBQSxRQUFFc0QsQ0FBRixTQUFFQSxDQUFGO0FBQUEsUUFBS0MsQ0FBTCxTQUFLQSxDQUFMO0FBQUEsV0FBWTFILE1BQU0sQ0FBQzJILFFBQVAsQ0FBZ0JGLENBQWhCLEtBQXNCekgsTUFBTSxDQUFDMkgsUUFBUCxDQUFnQkQsQ0FBaEIsQ0FBbEM7QUFBQSxHQUxLLEVBTVpFLElBTlksQ0FNUCxVQUFDQyxDQUFELEVBQUlDLENBQUo7QUFBQSxXQUFVLHdCQUFVRCxDQUFDLENBQUNKLENBQVosRUFBZUssQ0FBQyxDQUFDTCxDQUFqQixDQUFWO0FBQUEsR0FOTyxDQUFmO0FBUUEsTUFBTU0sT0FBTyxHQUFHLHFCQUFPUCxNQUFQLEVBQWUsVUFBQXhELENBQUM7QUFBQSxXQUFJQSxDQUFDLENBQUMwRCxDQUFOO0FBQUEsR0FBaEIsQ0FBaEI7QUFDQSxNQUFNTSxPQUFPLEdBQUcsQ0FBQ1IsTUFBTSxDQUFDLENBQUQsQ0FBTixDQUFVQyxDQUFYLEVBQWNELE1BQU0sQ0FBQ0EsTUFBTSxDQUFDMUQsTUFBUCxHQUFnQixDQUFqQixDQUFOLENBQTBCMkQsQ0FBeEMsQ0FBaEI7QUFFQSxTQUFPO0FBQUN4RyxJQUFBQSxTQUFTLEVBQUU7QUFBQ3VHLE1BQUFBLE1BQU0sRUFBTkEsTUFBRDtBQUFTTyxNQUFBQSxPQUFPLEVBQVBBLE9BQVQ7QUFBa0JDLE1BQUFBLE9BQU8sRUFBUEE7QUFBbEIsS0FBWjtBQUF3QzNGLElBQUFBLEtBQUssRUFBTEE7QUFBeEMsR0FBUDtBQUNEOztBQUVNLFNBQVM0Rix3QkFBVCxDQUFrQzlELE1BQWxDLEVBQTBDO0FBQy9DLE1BQU0rRCxlQUFlLEdBQUdoSCxpQkFBaUIsQ0FBQ2lELE1BQU0sQ0FBQ25DLElBQVIsQ0FBekM7O0FBQ0EsTUFBSSxDQUFDa0csZUFBTCxFQUFzQjtBQUNwQixXQUFPLElBQVA7QUFDRDs7QUFFRCxNQUFJLENBQUMvRCxNQUFNLENBQUM5QixLQUFaLEVBQW1CO0FBQ2pCLFdBQU82RixlQUFlLFdBQXRCO0FBQ0Q7O0FBRUQsU0FBT0EsZUFBZSxDQUFDL0QsTUFBTSxDQUFDOUIsS0FBUCxDQUFhTCxJQUFkLENBQWYsSUFBc0MsSUFBN0M7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbIi8vIENvcHlyaWdodCAoYykgMjAxOSBVYmVyIFRlY2hub2xvZ2llcywgSW5jLlxuLy9cbi8vIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbi8vIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbi8vIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbi8vIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbi8vIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuLy8gZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcbi8vXG4vLyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpblxuLy8gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4vL1xuLy8gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuLy8gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG4vLyBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbi8vIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbi8vIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG4vLyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXG4vLyBUSEUgU09GVFdBUkUuXG5cbmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JztcbmltcG9ydCB7YXNjZW5kaW5nLCBleHRlbnQsIGhpc3RvZ3JhbSBhcyBkM0hpc3RvZ3JhbSwgdGlja3N9IGZyb20gJ2QzLWFycmF5JztcbmltcG9ydCBrZXlNaXJyb3IgZnJvbSAna2V5bWlycm9yJztcblxuaW1wb3J0IHtBTExfRklFTERfVFlQRVN9IGZyb20gJ2NvbnN0YW50cy9kZWZhdWx0LXNldHRpbmdzJztcbmltcG9ydCB7bWF5YmVUb0RhdGUsIG5vdE51bGxvclVuZGVmaW5lZH0gZnJvbSAnLi9kYXRhLXV0aWxzJztcbmltcG9ydCAqIGFzIFNjYWxlVXRpbHMgZnJvbSAnLi9kYXRhLXNjYWxlLXV0aWxzJztcbmltcG9ydCB7Z2VuZXJhdGVIYXNoSWR9IGZyb20gJy4vdXRpbHMnO1xuXG5leHBvcnQgY29uc3QgVGltZXN0YW1wU3RlcE1hcCA9IFtcbiAge21heDogMSwgc3RlcDogMC4wNX0sXG4gIHttYXg6IDEwLCBzdGVwOiAwLjF9LFxuICB7bWF4OiAxMDAsIHN0ZXA6IDF9LFxuICB7bWF4OiA1MDAsIHN0ZXA6IDV9LFxuICB7bWF4OiAxMDAwLCBzdGVwOiAxMH0sXG4gIHttYXg6IDUwMDAsIHN0ZXA6IDUwfSxcbiAge21heDogTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZLCBzdGVwOiAxMDAwfVxuXTtcblxuZXhwb3J0IGNvbnN0IGhpc3RvZ3JhbUJpbnMgPSAzMDtcbmV4cG9ydCBjb25zdCBlbmxhcmdlZEhpc3RvZ3JhbUJpbnMgPSAxMDA7XG5cbmNvbnN0IGR1cmF0aW9uU2Vjb25kID0gMTAwMDtcbmNvbnN0IGR1cmF0aW9uTWludXRlID0gZHVyYXRpb25TZWNvbmQgKiA2MDtcbmNvbnN0IGR1cmF0aW9uSG91ciA9IGR1cmF0aW9uTWludXRlICogNjA7XG5jb25zdCBkdXJhdGlvbkRheSA9IGR1cmF0aW9uSG91ciAqIDI0O1xuY29uc3QgZHVyYXRpb25XZWVrID0gZHVyYXRpb25EYXkgKiA3O1xuY29uc3QgZHVyYXRpb25ZZWFyID0gZHVyYXRpb25EYXkgKiAzNjU7XG5cbmV4cG9ydCBjb25zdCBGSUxURVJfVFlQRVMgPSBrZXlNaXJyb3Ioe1xuICByYW5nZTogbnVsbCxcbiAgc2VsZWN0OiBudWxsLFxuICB0aW1lUmFuZ2U6IG51bGwsXG4gIG11bHRpU2VsZWN0OiBudWxsXG59KTtcblxuZXhwb3J0IGNvbnN0IFBMT1RfVFlQRVMgPSBrZXlNaXJyb3Ioe1xuICBoaXN0b2dyYW06IG51bGwsXG4gIGxpbmVDaGFydDogbnVsbFxufSk7XG5cbmNvbnN0IFN1cHBvcnRlZFBsb3RUeXBlID0ge1xuICBbRklMVEVSX1RZUEVTLnRpbWVSYW5nZV06IHtcbiAgICBkZWZhdWx0OiAnaGlzdG9ncmFtJyxcbiAgICBbQUxMX0ZJRUxEX1RZUEVTLmludGVnZXJdOiAnbGluZUNoYXJ0JyxcbiAgICBbQUxMX0ZJRUxEX1RZUEVTLnJlYWxdOiAnbGluZUNoYXJ0J1xuICB9LFxuICBbRklMVEVSX1RZUEVTLnJhbmdlXToge1xuICAgIGRlZmF1bHQ6ICdoaXN0b2dyYW0nLFxuICAgIFtBTExfRklFTERfVFlQRVMuaW50ZWdlcl06ICdsaW5lQ2hhcnQnLFxuICAgIFtBTExfRklFTERfVFlQRVMucmVhbF06ICdsaW5lQ2hhcnQnXG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBGSUxURVJfQ09NUE9ORU5UUyA9IHtcbiAgW0ZJTFRFUl9UWVBFUy5zZWxlY3RdOiAnU2luZ2xlU2VsZWN0RmlsdGVyJyxcbiAgW0ZJTFRFUl9UWVBFUy5tdWx0aVNlbGVjdF06ICdNdWx0aVNlbGVjdEZpbHRlcicsXG4gIFtGSUxURVJfVFlQRVMudGltZVJhbmdlXTogJ1RpbWVSYW5nZUZpbHRlcicsXG4gIFtGSUxURVJfVFlQRVMucmFuZ2VdOiAnUmFuZ2VGaWx0ZXInXG59O1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGVmYXVsdEZpbHRlcihkYXRhSWQpIHtcbiAgcmV0dXJuIHtcbiAgICAvLyBsaW5rIHRvIGRhdGFzZXQgSWRcbiAgICBkYXRhSWQsXG4gICAgLy8gc2hvdWxkIGFsbG93IHRvIGVkaXQgZGF0YUlkXG4gICAgZnJlZXplOiBmYWxzZSxcbiAgICBpZDogZ2VuZXJhdGVIYXNoSWQoNCksXG5cbiAgICAvLyB0aW1lIHJhbmdlIGZpbHRlciBzcGVjaWZpY1xuICAgIGZpeGVkRG9tYWluOiBmYWxzZSxcbiAgICBlbmxhcmdlZDogZmFsc2UsXG4gICAgaXNBbmltYXRpbmc6IGZhbHNlLFxuICAgIHNwZWVkOiAxLFxuXG4gICAgLy8gZmllbGQgc3BlY2lmaWNcbiAgICBuYW1lOiBudWxsLFxuICAgIHR5cGU6IG51bGwsXG4gICAgZmllbGRJZHg6IG51bGwsXG4gICAgZG9tYWluOiBudWxsLFxuICAgIHZhbHVlOiBudWxsLFxuXG4gICAgLy8gcGxvdFxuICAgIHBsb3RUeXBlOiBQTE9UX1RZUEVTLmhpc3RvZ3JhbSxcbiAgICB5QXhpczogbnVsbCxcbiAgICBpbnRlcnZhbDogbnVsbFxuICB9O1xufVxuXG4vKipcbiAqIEdldCBkZWZhdWx0IGZpbHRlciBwcm9wIGJhc2VkIG9uIGZpZWxkIHR5cGVcbiAqXG4gKiBAcGFyYW0ge09iamVjdFtdfSBkYXRhXG4gKiBAcGFyYW0ge29iamVjdH0gZmllbGRcbiAqIEByZXR1cm5zIHtvYmplY3R9IGRlZmF1bHQgZmlsdGVyXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRGaWx0ZXJQcm9wcyhkYXRhLCBmaWVsZCkge1xuICBjb25zdCBmaWx0ZXJQcm9wID0ge1xuICAgIC4uLmdldEZpZWxkRG9tYWluKGRhdGEsIGZpZWxkKSxcbiAgICBmaWVsZFR5cGU6IGZpZWxkLnR5cGVcbiAgfTtcblxuICBzd2l0Y2ggKGZpZWxkLnR5cGUpIHtcbiAgICBjYXNlIEFMTF9GSUVMRF9UWVBFUy5yZWFsOlxuICAgIGNhc2UgQUxMX0ZJRUxEX1RZUEVTLmludGVnZXI6XG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5maWx0ZXJQcm9wLFxuICAgICAgICB2YWx1ZTogZmlsdGVyUHJvcC5kb21haW4sXG4gICAgICAgIHR5cGU6IEZJTFRFUl9UWVBFUy5yYW5nZSxcbiAgICAgICAgdHlwZU9wdGlvbnM6IFtGSUxURVJfVFlQRVMucmFuZ2VdXG4gICAgICB9O1xuXG4gICAgY2FzZSBBTExfRklFTERfVFlQRVMuYm9vbGVhbjpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLmZpbHRlclByb3AsXG4gICAgICAgIHR5cGU6IEZJTFRFUl9UWVBFUy5zZWxlY3QsXG4gICAgICAgIHZhbHVlOiB0cnVlXG4gICAgICB9O1xuXG4gICAgY2FzZSBBTExfRklFTERfVFlQRVMuc3RyaW5nOlxuICAgIGNhc2UgQUxMX0ZJRUxEX1RZUEVTLmRhdGU6XG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5maWx0ZXJQcm9wLFxuICAgICAgICB0eXBlOiBGSUxURVJfVFlQRVMubXVsdGlTZWxlY3QsXG4gICAgICAgIHZhbHVlOiBbXVxuICAgICAgfTtcblxuICAgIGNhc2UgQUxMX0ZJRUxEX1RZUEVTLnRpbWVzdGFtcDpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLmZpbHRlclByb3AsXG4gICAgICAgIHR5cGU6IEZJTFRFUl9UWVBFUy50aW1lUmFuZ2UsXG4gICAgICAgIGVubGFyZ2VkOiB0cnVlLFxuICAgICAgICBmaXhlZERvbWFpbjogdHJ1ZSxcbiAgICAgICAgdmFsdWU6IGZpbHRlclByb3AuZG9tYWluXG4gICAgICB9O1xuXG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiB7fTtcbiAgfVxufVxuXG4vKipcbiAqIENhbGN1bGF0ZSBmaWVsZCBkb21haW4gYmFzZWQgb24gZmllbGQgdHlwZSBhbmQgZGF0YVxuICpcbiAqIEBwYXJhbSB7T2JqZWN0W119IGRhdGFcbiAqIEBwYXJhbSB7b2JqZWN0fSBmaWVsZFxuICogQHJldHVybnMge29iamVjdH0gd2l0aCBkb21haW4gYXMga2V5XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRGaWVsZERvbWFpbihkYXRhLCBmaWVsZCkge1xuICBjb25zdCBmaWVsZElkeCA9IGZpZWxkLnRhYmxlRmllbGRJbmRleCAtIDE7XG4gIGNvbnN0IGlzVGltZSA9IGZpZWxkLnR5cGUgPT09IEFMTF9GSUVMRF9UWVBFUy50aW1lc3RhbXA7XG4gIGNvbnN0IHZhbHVlQWNjZXNzb3IgPSBtYXliZVRvRGF0ZS5iaW5kKG51bGwsIGlzVGltZSwgZmllbGRJZHgsIGZpZWxkLmZvcm1hdCk7XG4gIGxldCBkb21haW47XG5cbiAgc3dpdGNoIChmaWVsZC50eXBlKSB7XG4gICAgY2FzZSBBTExfRklFTERfVFlQRVMucmVhbDpcbiAgICBjYXNlIEFMTF9GSUVMRF9UWVBFUy5pbnRlZ2VyOlxuICAgICAgLy8gY2FsY3VsYXRlIGRvbWFpbiBhbmQgc3RlcFxuICAgICAgcmV0dXJuIGdldE51bWVyaWNGaWVsZERvbWFpbihkYXRhLCB2YWx1ZUFjY2Vzc29yKTtcblxuICAgIGNhc2UgQUxMX0ZJRUxEX1RZUEVTLmJvb2xlYW46XG4gICAgICByZXR1cm4ge2RvbWFpbjogW3RydWUsIGZhbHNlXX07XG5cbiAgICBjYXNlIEFMTF9GSUVMRF9UWVBFUy5zdHJpbmc6XG4gICAgY2FzZSBBTExfRklFTERfVFlQRVMuZGF0ZTpcbiAgICAgIGRvbWFpbiA9IFNjYWxlVXRpbHMuZ2V0T3JkaW5hbERvbWFpbihkYXRhLCB2YWx1ZUFjY2Vzc29yKTtcbiAgICAgIHJldHVybiB7ZG9tYWlufTtcblxuICAgIGNhc2UgQUxMX0ZJRUxEX1RZUEVTLnRpbWVzdGFtcDpcbiAgICAgIHJldHVybiBnZXRUaW1lc3RhbXBGaWVsZERvbWFpbihkYXRhLCB2YWx1ZUFjY2Vzc29yKTtcblxuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4ge2RvbWFpbjogU2NhbGVVdGlscy5nZXRPcmRpbmFsRG9tYWluKGRhdGEsIHZhbHVlQWNjZXNzb3IpfTtcbiAgfVxufVxuXG4vKipcbiAqIEZpbHRlciBkYXRhIGJhc2VkIG9uIGFuIGFycmF5IG9mIGZpbHRlcnNcbiAqXG4gKiBAcGFyYW0ge09iamVjdFtdfSBkYXRhXG4gKiBAcGFyYW0ge3N0cmluZ30gZGF0YUlkXG4gKiBAcGFyYW0ge09iamVjdFtdfSBmaWx0ZXJzXG4gKiBAcmV0dXJucyB7T2JqZWN0W119IGRhdGFcbiAqIEByZXR1cm5zIHtOdW1iZXJbXX0gZmlsdGVyZWRJbmRleFxuICovXG5leHBvcnQgZnVuY3Rpb24gZmlsdGVyRGF0YShkYXRhLCBkYXRhSWQsIGZpbHRlcnMpIHtcbiAgaWYgKCFkYXRhIHx8ICFkYXRhSWQpIHtcbiAgICAvLyB3aHkgd291bGQgdGhlcmUgbm90IGJlIGFueSBkYXRhPyBhcmUgd2Ugb3ZlciBkb2luZyB0aGlzP1xuICAgIHJldHVybiB7ZGF0YTogW10sIGZpbHRlcmVkSW5kZXg6IFtdfTtcbiAgfVxuXG4gIGlmICghZmlsdGVycy5sZW5ndGgpIHtcbiAgICByZXR1cm4ge2RhdGEsIGZpbHRlcmVkSW5kZXg6IGRhdGEubWFwKChkLCBpKSA9PiBpKX07XG4gIH1cblxuICBjb25zdCBhcHBsaWVkRmlsdGVycyA9IGZpbHRlcnMuZmlsdGVyKFxuICAgIGQgPT4gZC5kYXRhSWQgPT09IGRhdGFJZCAmJiBkLmZpZWxkSWR4ID4gLTEgJiYgZC52YWx1ZSAhPT0gbnVsbFxuICApO1xuXG4gIGNvbnN0IFtkeW5hbWljRG9tYWluRmlsdGVycywgZml4ZWREb21haW5GaWx0ZXJzXSA9IGFwcGxpZWRGaWx0ZXJzLnJlZHVjZShcbiAgICAoYWNjdSwgZikgPT4ge1xuICAgICAgaWYgKGYuZGF0YUlkID09PSBkYXRhSWQgJiYgZi5maWVsZElkeCA+IC0xICYmIGYudmFsdWUgIT09IG51bGwpIHtcbiAgICAgICAgKGYuZml4ZWREb21haW4gPyBhY2N1WzFdIDogYWNjdVswXSkucHVzaChmKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhY2N1O1xuICAgIH0sXG4gICAgW1tdLCBbXV1cbiAgKTtcbiAgLy8gY29uc29sZS5sb2coZHluYW1pY0RvbWFpbkZpbHRlcnMpXG4gIC8vIGNvbnNvbGUubG9nKGZpeGVkRG9tYWluRmlsdGVycylcbiAgLy8gd2Ugc2F2ZSBhIHJlZmVyZW5jZSBvZiBhbGxEYXRhIGluZGV4IGhlcmUgdG8gYWNjZXNzIGRhdGFUb0ZlYXR1cmVcbiAgLy8gaW4gZ2VvanNvbiBhbmQgaGV4Z29uSWQgbGF5ZXJcbiAgLy8gY29uc29sZS50aW1lKCdmaWx0ZXJEYXRhJyk7XG5cbiAgY29uc3Qge2ZpbHRlcmVkLCBmaWx0ZXJlZEluZGV4LCBmaWx0ZXJlZEluZGV4Rm9yRG9tYWlufSA9IGRhdGEucmVkdWNlKFxuICAgIChhY2N1LCBkLCBpKSA9PiB7XG4gICAgICAvLyBnZW5lcmF0ZSAyIHNldHMgb2ZcbiAgICAgIC8vIGZpbHRlciBkYXRhIHVzZWQgdG8gY2FsY3VsYXRlIGxheWVyIERvbWFpblxuICAgICAgY29uc3QgbWF0Y2hGb3JEb21haW4gPSBkeW5hbWljRG9tYWluRmlsdGVycy5ldmVyeShmaWx0ZXIgPT5cbiAgICAgICAgaXNEYXRhTWF0Y2hGaWx0ZXIoZCwgZmlsdGVyLCBpKVxuICAgICAgKTtcblxuICAgICAgaWYgKG1hdGNoRm9yRG9tYWluKSB7XG4gICAgICAgIGFjY3UuZmlsdGVyZWRJbmRleEZvckRvbWFpbi5wdXNoKGkpO1xuXG4gICAgICAgIC8vIGZpbHRlciBkYXRhIGZvciByZW5kZXJcbiAgICAgICAgY29uc3QgbWF0Y2hGb3JSZW5kZXIgPSBmaXhlZERvbWFpbkZpbHRlcnMuZXZlcnkoZmlsdGVyID0+XG4gICAgICAgICAgaXNEYXRhTWF0Y2hGaWx0ZXIoZCwgZmlsdGVyLCBpKVxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChtYXRjaEZvclJlbmRlcikge1xuICAgICAgICAgIGFjY3UuZmlsdGVyZWQucHVzaChkKTtcbiAgICAgICAgICBhY2N1LmZpbHRlcmVkSW5kZXgucHVzaChpKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gYWNjdTtcbiAgICB9LFxuICAgIHtmaWx0ZXJlZDogW10sIGZpbHRlcmVkSW5kZXg6IFtdLCBmaWx0ZXJlZEluZGV4Rm9yRG9tYWluOiBbXX1cbiAgKTtcblxuICAvLyBjb25zb2xlLmxvZygnZGF0YT09JywgZGF0YS5sZW5ndGgpXG4gIC8vIGNvbnNvbGUubG9nKCdmaWx0ZXJlZD09JywgZmlsdGVyZWQubGVuZ3RoKVxuICAvLyBjb25zb2xlLmxvZygnZmlsdGVyZWRJbmRleD09JywgZmlsdGVyZWRJbmRleC5sZW5ndGgpXG4gIC8vIGNvbnNvbGUubG9nKCdmaWx0ZXJlZEluZGV4Rm9yRG9tYWluPT0nLCBmaWx0ZXJlZEluZGV4Rm9yRG9tYWluLmxlbmd0aClcbiAgLy9cbiAgLy8gY29uc29sZS50aW1lRW5kKCdmaWx0ZXJEYXRhJyk7XG5cbiAgcmV0dXJuIHtkYXRhOiBmaWx0ZXJlZCwgZmlsdGVyZWRJbmRleCwgZmlsdGVyZWRJbmRleEZvckRvbWFpbn07XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgdmFsdWUgaXMgaW4gcmFuZ2Ugb2YgZmlsdGVyXG4gKlxuICogQHBhcmFtIHtPYmplY3RbXX0gZGF0YVxuICogQHBhcmFtIHtPYmplY3R9IGZpbHRlclxuICogQHBhcmFtIHtudW1iZXJ9IGlcbiAqIEByZXR1cm5zIHtCb29sZWFufSAtIHdoZXRoZXIgdmFsdWUgZmFsbHMgaW4gdGhlIHJhbmdlIG9mIHRoZSBmaWx0ZXJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzRGF0YU1hdGNoRmlsdGVyKGRhdGEsIGZpbHRlciwgaSkge1xuICBjb25zdCB2YWwgPSBkYXRhW2ZpbHRlci5maWVsZElkeF07XG4gIGlmICghZmlsdGVyLnR5cGUpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHN3aXRjaCAoZmlsdGVyLnR5cGUpIHtcbiAgICBjYXNlIEZJTFRFUl9UWVBFUy5yYW5nZTpcbiAgICAgIHJldHVybiBpc0luUmFuZ2UodmFsLCBmaWx0ZXIudmFsdWUpO1xuXG4gICAgY2FzZSBGSUxURVJfVFlQRVMudGltZVJhbmdlOlxuICAgICAgY29uc3QgdGltZVZhbCA9IGZpbHRlci5tYXBwZWRWYWx1ZVxuICAgICAgICA/IGZpbHRlci5tYXBwZWRWYWx1ZVtpXVxuICAgICAgICA6IG1vbWVudC51dGModmFsKS52YWx1ZU9mKCk7XG4gICAgICByZXR1cm4gaXNJblJhbmdlKHRpbWVWYWwsIGZpbHRlci52YWx1ZSk7XG5cbiAgICBjYXNlIEZJTFRFUl9UWVBFUy5tdWx0aVNlbGVjdDpcbiAgICAgIHJldHVybiBmaWx0ZXIudmFsdWUuaW5jbHVkZXModmFsKTtcblxuICAgIGNhc2UgRklMVEVSX1RZUEVTLnNlbGVjdDpcbiAgICAgIHJldHVybiBmaWx0ZXIudmFsdWUgPT09IHZhbDtcblxuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufVxuXG4vKipcbiAqIENhbGwgYnkgcGFyc2luZyBmaWx0ZXJzIGZyb20gVVJMXG4gKiBDaGVjayBpZiB2YWx1ZSBvZiBmaWx0ZXIgd2l0aGluIGZpbHRlciBkb21haW4sIGlmIG5vdCBhZGp1c3QgaXQgdG8gbWF0Y2hcbiAqIGZpbHRlciBkb21haW5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ1tdIHwgc3RyaW5nIHwgbnVtYmVyIHwgbnVtYmVyW119IHZhbHVlXG4gKiBAcGFyYW0ge0FycmF5fSBmaWx0ZXIuZG9tYWluXG4gKiBAcGFyYW0ge1N0cmluZ30gZmlsdGVyLnR5cGVcbiAqIEByZXR1cm5zIHsqfSAtIGFkanVzdGVkIHZhbHVlIHRvIG1hdGNoIGZpbHRlciBvciBudWxsIHRvIHJlbW92ZSBmaWx0ZXJcbiAqL1xuXG4vKiBlc2xpbnQtZGlzYWJsZSBjb21wbGV4aXR5ICovXG5leHBvcnQgZnVuY3Rpb24gYWRqdXN0VmFsdWVUb0ZpbHRlckRvbWFpbih2YWx1ZSwge2RvbWFpbiwgdHlwZX0pIHtcbiAgaWYgKCFkb21haW4gfHwgIXR5cGUpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBzd2l0Y2ggKHR5cGUpIHtcbiAgICBjYXNlIEZJTFRFUl9UWVBFUy5yYW5nZTpcbiAgICBjYXNlIEZJTFRFUl9UWVBFUy50aW1lUmFuZ2U6XG4gICAgICBpZiAoIUFycmF5LmlzQXJyYXkodmFsdWUpIHx8IHZhbHVlLmxlbmd0aCAhPT0gMikge1xuICAgICAgICByZXR1cm4gZG9tYWluLm1hcChkID0+IGQpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdmFsdWUubWFwKChkLCBpKSA9PlxuICAgICAgICBub3ROdWxsb3JVbmRlZmluZWQoZCkgJiYgaXNJblJhbmdlKGQsIGRvbWFpbikgPyBkIDogZG9tYWluW2ldXG4gICAgICApO1xuXG4gICAgY2FzZSBGSUxURVJfVFlQRVMubXVsdGlTZWxlY3Q6XG4gICAgICBpZiAoIUFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGZpbHRlcmVkVmFsdWUgPSB2YWx1ZS5maWx0ZXIoZCA9PiBkb21haW4uaW5jbHVkZXMoZCkpO1xuICAgICAgcmV0dXJuIGZpbHRlcmVkVmFsdWUubGVuZ3RoID8gZmlsdGVyZWRWYWx1ZSA6IFtdO1xuXG4gICAgY2FzZSBGSUxURVJfVFlQRVMuc2VsZWN0OlxuICAgICAgcmV0dXJuIGRvbWFpbi5pbmNsdWRlcyh2YWx1ZSkgPyB2YWx1ZSA6IHRydWU7XG5cbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cbi8qIGVzbGludC1lbmFibGUgY29tcGxleGl0eSAqL1xuXG4vKipcbiAqIENhbGN1bGF0ZSBudW1lcmljIGRvbWFpbiBhbmQgc3VpdGFibGUgc3RlcFxuICpcbiAqIEBwYXJhbSB7T2JqZWN0W119IGRhdGFcbiAqIEBwYXJhbSB7ZnVuY3Rpb259IHZhbHVlQWNjZXNzb3JcbiAqIEByZXR1cm5zIHtvYmplY3R9IGRvbWFpbiBhbmQgc3RlcFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0TnVtZXJpY0ZpZWxkRG9tYWluKGRhdGEsIHZhbHVlQWNjZXNzb3IpIHtcbiAgbGV0IGRvbWFpbiA9IFswLCAxXTtcbiAgbGV0IHN0ZXAgPSAwLjE7XG5cbiAgY29uc3QgbWFwcGVkVmFsdWUgPSBBcnJheS5pc0FycmF5KGRhdGEpID8gZGF0YS5tYXAodmFsdWVBY2Nlc3NvcikgOiBbXTtcblxuICBpZiAoQXJyYXkuaXNBcnJheShkYXRhKSAmJiBkYXRhLmxlbmd0aCA+IDEpIHtcbiAgICBkb21haW4gPSBTY2FsZVV0aWxzLmdldExpbmVhckRvbWFpbihtYXBwZWRWYWx1ZSk7XG4gICAgY29uc3QgZGlmZiA9IGRvbWFpblsxXSAtIGRvbWFpblswXTtcblxuICAgIC8vIGluIGNhc2UgZXF1YWwgZG9tYWluLCBbOTYsIDk2XSwgd2hpY2ggd2lsbCBicmVhayBxdWFudGl6ZSBzY2FsZVxuICAgIGlmICghZGlmZikge1xuICAgICAgZG9tYWluWzFdID0gZG9tYWluWzBdICsgMTtcbiAgICB9XG5cbiAgICBzdGVwID0gZ2V0TnVtZXJpY1N0ZXBTaXplKGRpZmYpIHx8IHN0ZXA7XG4gICAgZG9tYWluWzBdID0gZm9ybWF0TnVtYmVyQnlTdGVwKGRvbWFpblswXSwgc3RlcCwgJ2Zsb29yJyk7XG4gICAgZG9tYWluWzFdID0gZm9ybWF0TnVtYmVyQnlTdGVwKGRvbWFpblsxXSwgc3RlcCwgJ2NlaWwnKTtcbiAgfVxuXG4gIGNvbnN0IHtoaXN0b2dyYW0sIGVubGFyZ2VkSGlzdG9ncmFtfSA9IGdldEhpc3RvZ3JhbShkb21haW4sIG1hcHBlZFZhbHVlKTtcblxuICByZXR1cm4ge2RvbWFpbiwgc3RlcCwgaGlzdG9ncmFtLCBlbmxhcmdlZEhpc3RvZ3JhbX07XG59XG5cbmZ1bmN0aW9uIGdldE51bWVyaWNTdGVwU2l6ZShkaWZmKSB7XG4gIGlmIChkaWZmID4gMTAwKSB7XG4gICAgcmV0dXJuIDE7XG4gIH0gZWxzZSBpZiAoZGlmZiA8IDIwICYmIGRpZmYgPiAzKSB7XG4gICAgcmV0dXJuIDAuMDE7XG4gIH0gZWxzZSBpZiAoZGlmZiA8PSAzKSB7XG4gICAgcmV0dXJuIDAuMDAxO1xuICB9XG59XG5cbi8qKlxuICogQ2FsY3VsYXRlIHRpbWVzdGFtcCBkb21haW4gYW5kIHN1aXRhYmxlIHN0ZXBcbiAqXG4gKiBAcGFyYW0ge09iamVjdFtdfSBkYXRhXG4gKiBAcGFyYW0ge2Z1bmN0aW9ufSB2YWx1ZUFjY2Vzc29yXG4gKiBAcmV0dXJucyB7b2JqZWN0fSBkb21haW4gYW5kIHN0ZXBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFRpbWVzdGFtcEZpZWxkRG9tYWluKGRhdGEsIHZhbHVlQWNjZXNzb3IpIHtcbiAgLy8gdG8gYXZvaWQgY29udmVydGluZyBzdHJpbmcgZm9ybWF0IHRpbWUgdG8gZXBvY2hcbiAgLy8gZXZlcnkgdGltZSB3ZSBjb21wYXJlIHdlIHN0b3JlIGEgdmFsdWUgbWFwcGVkIHRvIGludCBpbiBmaWx0ZXIgZG9tYWluXG5cbiAgY29uc3QgbWFwcGVkVmFsdWUgPSBBcnJheS5pc0FycmF5KGRhdGEpID8gZGF0YS5tYXAodmFsdWVBY2Nlc3NvcikgOiBbXTtcbiAgY29uc3QgZG9tYWluID0gU2NhbGVVdGlscy5nZXRMaW5lYXJEb21haW4obWFwcGVkVmFsdWUpO1xuICBsZXQgc3RlcCA9IDAuMDE7XG5cbiAgY29uc3QgZGlmZiA9IGRvbWFpblsxXSAtIGRvbWFpblswXTtcbiAgY29uc3QgZW50cnkgPSBUaW1lc3RhbXBTdGVwTWFwLmZpbmQoZiA9PiBmLm1heCA+PSBkaWZmKTtcbiAgaWYgKGVudHJ5KSB7XG4gICAgc3RlcCA9IGVudHJ5LnN0ZXA7XG4gIH1cblxuICBjb25zdCB7aGlzdG9ncmFtLCBlbmxhcmdlZEhpc3RvZ3JhbX0gPSBnZXRIaXN0b2dyYW0oZG9tYWluLCBtYXBwZWRWYWx1ZSk7XG5cbiAgcmV0dXJuIHtkb21haW4sIHN0ZXAsIG1hcHBlZFZhbHVlLCBoaXN0b2dyYW0sIGVubGFyZ2VkSGlzdG9ncmFtfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhpc3RvZ3JhbUNvbnN0cnVjdChkb21haW4sIG1hcHBlZFZhbHVlLCBiaW5zKSB7XG4gIHJldHVybiBkM0hpc3RvZ3JhbSgpXG4gICAgLnRocmVzaG9sZHModGlja3MoZG9tYWluWzBdLCBkb21haW5bMV0sIGJpbnMpKVxuICAgIC5kb21haW4oZG9tYWluKShtYXBwZWRWYWx1ZSlcbiAgICAubWFwKGJpbiA9PiAoe1xuICAgICAgY291bnQ6IGJpbi5sZW5ndGgsXG4gICAgICB4MDogYmluLngwLFxuICAgICAgeDE6IGJpbi54MVxuICAgIH0pKTtcbn1cbi8qKlxuICogQ2FsY3VsYXRlIGhpc3RvZ3JhbSBmcm9tIGRvbWFpbiBhbmQgYXJyYXkgb2YgdmFsdWVzXG4gKlxuICogQHBhcmFtIHtudW1iZXJbXX0gZG9tYWluXG4gKiBAcGFyYW0ge09iamVjdFtdfSBtYXBwZWRWYWx1ZVxuICogQHJldHVybnMge0FycmF5W119IGhpc3RvZ3JhbVxuICovXG5mdW5jdGlvbiBnZXRIaXN0b2dyYW0oZG9tYWluLCBtYXBwZWRWYWx1ZSkge1xuICBjb25zdCBoaXN0b2dyYW0gPSBoaXN0b2dyYW1Db25zdHJ1Y3QoZG9tYWluLCBtYXBwZWRWYWx1ZSwgaGlzdG9ncmFtQmlucyk7XG4gIGNvbnN0IGVubGFyZ2VkSGlzdG9ncmFtID0gaGlzdG9ncmFtQ29uc3RydWN0KFxuICAgIGRvbWFpbixcbiAgICBtYXBwZWRWYWx1ZSxcbiAgICBlbmxhcmdlZEhpc3RvZ3JhbUJpbnNcbiAgKTtcblxuICByZXR1cm4ge2hpc3RvZ3JhbSwgZW5sYXJnZWRIaXN0b2dyYW19O1xufVxuXG4vKipcbiAqIHJvdW5kIG51bWJlciBiYXNlZCBvbiBzdGVwXG4gKlxuICogQHBhcmFtIHtudW1iZXJ9IHZhbFxuICogQHBhcmFtIHtudW1iZXJ9IHN0ZXBcbiAqIEBwYXJhbSB7c3RyaW5nfSBib3VuZFxuICogQHJldHVybnMge251bWJlcn0gcm91bmRlZCBudW1iZXJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdE51bWJlckJ5U3RlcCh2YWwsIHN0ZXAsIGJvdW5kKSB7XG4gIGlmIChib3VuZCA9PT0gJ2Zsb29yJykge1xuICAgIHJldHVybiBNYXRoLmZsb29yKHZhbCAqICgxIC8gc3RlcCkpIC8gKDEgLyBzdGVwKTtcbiAgfVxuXG4gIHJldHVybiBNYXRoLmNlaWwodmFsICogKDEgLyBzdGVwKSkgLyAoMSAvIHN0ZXApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNJblJhbmdlKHZhbCwgZG9tYWluKSB7XG4gIGlmICghQXJyYXkuaXNBcnJheShkb21haW4pKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIHZhbCA+PSBkb21haW5bMF0gJiYgdmFsIDw9IGRvbWFpblsxXTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFRpbWVXaWRnZXRUaXRsZUZvcm1hdHRlcihkb21haW4pIHtcbiAgaWYgKCFBcnJheS5pc0FycmF5KGRvbWFpbikpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGNvbnN0IGRpZmYgPSBkb21haW5bMV0gLSBkb21haW5bMF07XG4gIHJldHVybiBkaWZmID4gZHVyYXRpb25ZZWFyXG4gICAgPyAnTU0vREQvWVknXG4gICAgOiBkaWZmID4gZHVyYXRpb25EYXlcbiAgICA/ICdNTS9ERC9ZWSBoaDptbWEnXG4gICAgOiAnTU0vREQvWVkgaGg6bW06c3NhJztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFRpbWVXaWRnZXRIaW50Rm9ybWF0dGVyKGRvbWFpbikge1xuICBpZiAoIUFycmF5LmlzQXJyYXkoZG9tYWluKSkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgY29uc3QgZGlmZiA9IGRvbWFpblsxXSAtIGRvbWFpblswXTtcbiAgcmV0dXJuIGRpZmYgPiBkdXJhdGlvblllYXJcbiAgICA/ICdNTS9ERC9ZWSdcbiAgICA6IGRpZmYgPiBkdXJhdGlvbldlZWtcbiAgICA/ICdNTS9ERCdcbiAgICA6IGRpZmYgPiBkdXJhdGlvbkRheVxuICAgID8gJ01NL0REIGhoYSdcbiAgICA6IGRpZmYgPiBkdXJhdGlvbkhvdXJcbiAgICA/ICdoaDptbWEnXG4gICAgOiAnaGg6bW06c3NhJztcbn1cblxuLyoqXG4gKiBTYW5pdHkgY2hlY2sgb24gZmlsdGVycyB0byBwcmVwYXJlIGZvciBzYXZlXG4gKiBAcGFyYW0ge1N0cmluZ30gdHlwZSAtIGZpbHRlciB0eXBlXG4gKiBAcGFyYW0geyp9IHZhbHVlIC0gZmlsdGVyIHZhbHVlXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gd2hldGhlciBmaWx0ZXIgaXMgdmFsdWVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzVmFsaWRGaWx0ZXJWYWx1ZSh7dHlwZSwgdmFsdWV9KSB7XG4gIGlmICghdHlwZSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBzd2l0Y2ggKHR5cGUpIHtcbiAgICBjYXNlIEZJTFRFUl9UWVBFUy5zZWxlY3Q6XG4gICAgICByZXR1cm4gdmFsdWUgPT09IHRydWUgfHwgdmFsdWUgPT09IGZhbHNlO1xuXG4gICAgY2FzZSBGSUxURVJfVFlQRVMucmFuZ2U6XG4gICAgY2FzZSBGSUxURVJfVFlQRVMudGltZVJhbmdlOlxuICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkodmFsdWUpICYmIHZhbHVlLmV2ZXJ5KHYgPT4gdiAhPT0gbnVsbCAmJiAhaXNOYU4odikpO1xuXG4gICAgY2FzZSBGSUxURVJfVFlQRVMubXVsdGlTZWxlY3Q6XG4gICAgICByZXR1cm4gQXJyYXkuaXNBcnJheSh2YWx1ZSkgJiYgQm9vbGVhbih2YWx1ZS5sZW5ndGgpO1xuXG4gICAgY2FzZSBGSUxURVJfVFlQRVMuaW5wdXQ6XG4gICAgICByZXR1cm4gQm9vbGVhbih2YWx1ZS5sZW5ndGgpO1xuXG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiB0cnVlO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRGaWx0ZXJQbG90KGZpbHRlciwgYWxsRGF0YSkge1xuICBpZiAoZmlsdGVyLnBsb3RUeXBlID09PSBQTE9UX1RZUEVTLmhpc3RvZ3JhbSB8fCAhZmlsdGVyLnlBeGlzKSB7XG4gICAgLy8gaGlzdG9ncmFtIHNob3VsZCBiZSBjYWxjdWxhdGVkIHdoZW4gY3JlYXRlIGZpbHRlclxuICAgIHJldHVybiB7fTtcbiAgfVxuXG4gIGNvbnN0IHttYXBwZWRWYWx1ZX0gPSBmaWx0ZXI7XG4gIGNvbnN0IHt5QXhpc30gPSBmaWx0ZXI7XG5cbiAgLy8gcmV0dXJuIGxpbmVDaGFydFxuICBjb25zdCBzZXJpZXMgPSBhbGxEYXRhXG4gICAgLm1hcCgoZCwgaSkgPT4gKHtcbiAgICAgIHg6IG1hcHBlZFZhbHVlW2ldLFxuICAgICAgeTogZFt5QXhpcy50YWJsZUZpZWxkSW5kZXggLSAxXVxuICAgIH0pKVxuICAgIC5maWx0ZXIoKHt4LCB5fSkgPT4gTnVtYmVyLmlzRmluaXRlKHgpICYmIE51bWJlci5pc0Zpbml0ZSh5KSlcbiAgICAuc29ydCgoYSwgYikgPT4gYXNjZW5kaW5nKGEueCwgYi54KSk7XG5cbiAgY29uc3QgeURvbWFpbiA9IGV4dGVudChzZXJpZXMsIGQgPT4gZC55KTtcbiAgY29uc3QgeERvbWFpbiA9IFtzZXJpZXNbMF0ueCwgc2VyaWVzW3Nlcmllcy5sZW5ndGggLSAxXS54XTtcblxuICByZXR1cm4ge2xpbmVDaGFydDoge3NlcmllcywgeURvbWFpbiwgeERvbWFpbn0sIHlBeGlzfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldERlZmF1bHRGaWx0ZXJQbG90VHlwZShmaWx0ZXIpIHtcbiAgY29uc3QgZmlsdGVyUGxvdFR5cGVzID0gU3VwcG9ydGVkUGxvdFR5cGVbZmlsdGVyLnR5cGVdO1xuICBpZiAoIWZpbHRlclBsb3RUeXBlcykge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgaWYgKCFmaWx0ZXIueUF4aXMpIHtcbiAgICByZXR1cm4gZmlsdGVyUGxvdFR5cGVzLmRlZmF1bHQ7XG4gIH1cblxuICByZXR1cm4gZmlsdGVyUGxvdFR5cGVzW2ZpbHRlci55QXhpcy50eXBlXSB8fCBudWxsO1xufVxuIl19