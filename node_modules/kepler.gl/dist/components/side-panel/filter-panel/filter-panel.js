"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf3 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _taggedTemplateLiteral2 = _interopRequireDefault(require("@babel/runtime/helpers/taggedTemplateLiteral"));

var _react = _interopRequireWildcard(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _reselect = require("reselect");

var _styledComponents = _interopRequireDefault(require("styled-components"));

var _panelHeaderAction = _interopRequireDefault(require("../panel-header-action"));

var _fieldSelector = _interopRequireDefault(require("../../common/field-selector"));

var _icons = require("../../common/icons");

var _sourceDataSelector = _interopRequireDefault(require("../common/source-data-selector"));

var _styledComponents2 = require("../../common/styled-components");

var _singleSelectFilter = _interopRequireDefault(require("../../filters/single-select-filter"));

var _multiSelectFilter = _interopRequireDefault(require("../../filters/multi-select-filter"));

var _timeRangeFilter = _interopRequireDefault(require("../../filters/time-range-filter"));

var _rangeFilter = _interopRequireDefault(require("../../filters/range-filter"));

var _filterUtils = require("../../../utils/filter-utils");

var _defaultSettings = require("../../../constants/default-settings");

function _templateObject3() {
  var data = (0, _taggedTemplateLiteral2["default"])(["\n  background-color: ", ";\n  padding: 12px;\n"]);

  _templateObject3 = function _templateObject3() {
    return data;
  };

  return data;
}

function _templateObject2() {
  var data = (0, _taggedTemplateLiteral2["default"])(["\n  cursor: pointer;\n  padding: 10px 12px;\n\n  .field-selector {\n    width: calc(100% - 58px);\n  }\n"]);

  _templateObject2 = function _templateObject2() {
    return data;
  };

  return data;
}

function _templateObject() {
  var data = (0, _taggedTemplateLiteral2["default"])(["\n  margin-bottom: 12px;\n  border-radius: 1px;\n\n  .filter-panel__filter {\n    margin-top: 24px;\n  }\n"]);

  _templateObject = function _templateObject() {
    return data;
  };

  return data;
}

var StyledFilterPanel = _styledComponents["default"].div(_templateObject());

var StyledFilterHeader = (0, _styledComponents["default"])(_styledComponents2.StyledPanelHeader)(_templateObject2());

var StyledFilterContent = _styledComponents["default"].div(_templateObject3(), function (props) {
  return props.theme.panelBackground;
});

FilterPanelFactory.deps = [_sourceDataSelector["default"], _singleSelectFilter["default"], _multiSelectFilter["default"], _timeRangeFilter["default"], _rangeFilter["default"]];

function FilterPanelFactory(SourceDataSelector, SingleSelectFilter, MultiSelectFilter, TimeRangeFilter, RangeFilter) {
  var _class, _temp;

  var FilterComponents = {
    SingleSelectFilter: SingleSelectFilter,
    MultiSelectFilter: MultiSelectFilter,
    TimeRangeFilter: TimeRangeFilter,
    RangeFilter: RangeFilter
  };
  return _temp = _class =
  /*#__PURE__*/
  function (_Component) {
    (0, _inherits2["default"])(FilterPanel, _Component);

    function FilterPanel() {
      var _getPrototypeOf2;

      var _this;

      (0, _classCallCheck2["default"])(this, FilterPanel);

      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      _this = (0, _possibleConstructorReturn2["default"])(this, (_getPrototypeOf2 = (0, _getPrototypeOf3["default"])(FilterPanel)).call.apply(_getPrototypeOf2, [this].concat(args)));
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "fieldsSelector", function (props) {
        return props.filter.dataId && props.datasets[props.filter.dataId].fields || [];
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "filterSelector", function (props) {
        return props.filters;
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "nameSelector", function (props) {
        return props.filter.name;
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "dataIdSelector", function (props) {
        return props.filter.dataId;
      });
      (0, _defineProperty2["default"])((0, _assertThisInitialized2["default"])(_this), "availableFieldsSelector", (0, _reselect.createSelector)(_this.fieldsSelector, _this.filterSelector, _this.nameSelector, _this.dataIdSelector, function (fields, filters, name, dataId) {
        return fields.filter(function (f) {
          return f.type && f.type !== _defaultSettings.ALL_FIELD_TYPES.geojson && (f.name === name || !filters.find(function (d) {
            return d.name === f.name && d.dataId === dataId;
          }));
        });
      }));
      return _this;
    }

    (0, _createClass2["default"])(FilterPanel, [{
      key: "render",
      value: function render() {
        var _this$props = this.props,
            datasets = _this$props.datasets,
            enlargeFilter = _this$props.enlargeFilter,
            filter = _this$props.filter,
            idx = _this$props.idx,
            isAnyFilterAnimating = _this$props.isAnyFilterAnimating,
            removeFilter = _this$props.removeFilter,
            _setFilter = _this$props.setFilter,
            toggleAnimation = _this$props.toggleAnimation;
        var name = filter.name,
            enlarged = filter.enlarged,
            type = filter.type,
            dataId = filter.dataId;
        var FilterComponent = type && FilterComponents[_filterUtils.FILTER_COMPONENTS[type]];
        var allAvailableFields = this.availableFieldsSelector(this.props);
        return _react["default"].createElement(StyledFilterPanel, {
          className: "filter-panel"
        }, _react["default"].createElement(StyledFilterHeader, {
          className: "filter-panel__header",
          labelRCGColorValues: datasets[dataId].color
        }, _react["default"].createElement(_fieldSelector["default"], {
          inputTheme: "secondary",
          fields: allAvailableFields,
          value: name,
          erasable: false,
          onSelect: function onSelect(value) {
            return _setFilter(idx, 'name', value.name);
          }
        }), _react["default"].createElement(_panelHeaderAction["default"], {
          id: filter.id,
          tooltip: "delete",
          tooltipType: "error",
          onClick: removeFilter,
          hoverColor: 'errorColor',
          IconComponent: _icons.Trash
        }), type === _filterUtils.FILTER_TYPES.timeRange && _react["default"].createElement(_panelHeaderAction["default"], {
          id: filter.id,
          onClick: enlargeFilter,
          tooltip: "Time Playback",
          IconComponent: _icons.Clock,
          active: enlarged
        })), _react["default"].createElement(StyledFilterContent, {
          className: "filter-panel__content"
        }, Object.keys(datasets).length > 1 && _react["default"].createElement(SourceDataSelector, {
          inputTheme: "secondary",
          datasets: datasets,
          disabled: filter.freeze,
          dataId: filter.dataId,
          onSelect: function onSelect(value) {
            return _setFilter(idx, 'dataId', value);
          }
        }), type && !enlarged && _react["default"].createElement("div", {
          className: "filter-panel__filter"
        }, _react["default"].createElement(FilterComponent, {
          filter: filter,
          idx: idx,
          isAnyFilterAnimating: isAnyFilterAnimating,
          toggleAnimation: toggleAnimation,
          setFilter: function setFilter(value) {
            return _setFilter(idx, 'value', value);
          }
        }))));
      }
    }]);
    return FilterPanel;
  }(_react.Component), (0, _defineProperty2["default"])(_class, "propTypes", {
    idx: _propTypes["default"].number,
    filters: _propTypes["default"].arrayOf(_propTypes["default"].any).isRequired,
    filter: _propTypes["default"].object.isRequired,
    setFilter: _propTypes["default"].func.isRequired,
    removeFilter: _propTypes["default"].func.isRequired,
    enlargeFilter: _propTypes["default"].func.isRequired,
    toggleAnimation: _propTypes["default"].func.isRequired,
    datasets: _propTypes["default"].object,
    showDatasetTable: _propTypes["default"].func,
    isAnyFilterAnimating: _propTypes["default"].bool
  }), _temp;
}

var _default = FilterPanelFactory;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL3NpZGUtcGFuZWwvZmlsdGVyLXBhbmVsL2ZpbHRlci1wYW5lbC5qcyJdLCJuYW1lcyI6WyJTdHlsZWRGaWx0ZXJQYW5lbCIsInN0eWxlZCIsImRpdiIsIlN0eWxlZEZpbHRlckhlYWRlciIsIlN0eWxlZFBhbmVsSGVhZGVyIiwiU3R5bGVkRmlsdGVyQ29udGVudCIsInByb3BzIiwidGhlbWUiLCJwYW5lbEJhY2tncm91bmQiLCJGaWx0ZXJQYW5lbEZhY3RvcnkiLCJkZXBzIiwiU291cmNlRGF0YVNlbGVjdG9yRmFjdG9yeSIsIlNpbmdsZVNlbGVjdEZpbHRlckZhY3RvcnkiLCJNdWx0aVNlbGVjdEZpbHRlckZhY3RvcnkiLCJUaW1lUmFuZ2VGaWx0ZXJGYWN0b3J5IiwiUmFuZ2VGaWx0ZXJGYWN0b3J5IiwiU291cmNlRGF0YVNlbGVjdG9yIiwiU2luZ2xlU2VsZWN0RmlsdGVyIiwiTXVsdGlTZWxlY3RGaWx0ZXIiLCJUaW1lUmFuZ2VGaWx0ZXIiLCJSYW5nZUZpbHRlciIsIkZpbHRlckNvbXBvbmVudHMiLCJmaWx0ZXIiLCJkYXRhSWQiLCJkYXRhc2V0cyIsImZpZWxkcyIsImZpbHRlcnMiLCJuYW1lIiwiZmllbGRzU2VsZWN0b3IiLCJmaWx0ZXJTZWxlY3RvciIsIm5hbWVTZWxlY3RvciIsImRhdGFJZFNlbGVjdG9yIiwiZiIsInR5cGUiLCJBTExfRklFTERfVFlQRVMiLCJnZW9qc29uIiwiZmluZCIsImQiLCJlbmxhcmdlRmlsdGVyIiwiaWR4IiwiaXNBbnlGaWx0ZXJBbmltYXRpbmciLCJyZW1vdmVGaWx0ZXIiLCJzZXRGaWx0ZXIiLCJ0b2dnbGVBbmltYXRpb24iLCJlbmxhcmdlZCIsIkZpbHRlckNvbXBvbmVudCIsIkZJTFRFUl9DT01QT05FTlRTIiwiYWxsQXZhaWxhYmxlRmllbGRzIiwiYXZhaWxhYmxlRmllbGRzU2VsZWN0b3IiLCJjb2xvciIsInZhbHVlIiwiaWQiLCJUcmFzaCIsIkZJTFRFUl9UWVBFUyIsInRpbWVSYW5nZSIsIkNsb2NrIiwiT2JqZWN0Iiwia2V5cyIsImxlbmd0aCIsImZyZWV6ZSIsIkNvbXBvbmVudCIsIlByb3BUeXBlcyIsIm51bWJlciIsImFycmF5T2YiLCJhbnkiLCJpc1JlcXVpcmVkIiwib2JqZWN0IiwiZnVuYyIsInNob3dEYXRhc2V0VGFibGUiLCJib29sIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvQkE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUEsSUFBTUEsaUJBQWlCLEdBQUdDLDZCQUFPQyxHQUFWLG1CQUF2Qjs7QUFTQSxJQUFNQyxrQkFBa0IsR0FBRyxrQ0FBT0Msb0NBQVAsQ0FBSCxvQkFBeEI7O0FBU0EsSUFBTUMsbUJBQW1CLEdBQUdKLDZCQUFPQyxHQUFWLHFCQUNILFVBQUFJLEtBQUs7QUFBQSxTQUFJQSxLQUFLLENBQUNDLEtBQU4sQ0FBWUMsZUFBaEI7QUFBQSxDQURGLENBQXpCOztBQUtBQyxrQkFBa0IsQ0FBQ0MsSUFBbkIsR0FBMEIsQ0FDeEJDLDhCQUR3QixFQUV4QkMsOEJBRndCLEVBR3hCQyw2QkFId0IsRUFJeEJDLDJCQUp3QixFQUt4QkMsdUJBTHdCLENBQTFCOztBQVFBLFNBQVNOLGtCQUFULENBQ0VPLGtCQURGLEVBRUVDLGtCQUZGLEVBR0VDLGlCQUhGLEVBSUVDLGVBSkYsRUFLRUMsV0FMRixFQU1FO0FBQUE7O0FBQ0EsTUFBTUMsZ0JBQWdCLEdBQUc7QUFDdkJKLElBQUFBLGtCQUFrQixFQUFsQkEsa0JBRHVCO0FBRXZCQyxJQUFBQSxpQkFBaUIsRUFBakJBLGlCQUZ1QjtBQUd2QkMsSUFBQUEsZUFBZSxFQUFmQSxlQUh1QjtBQUl2QkMsSUFBQUEsV0FBVyxFQUFYQTtBQUp1QixHQUF6QjtBQU9BO0FBQUE7QUFBQTtBQUFBOztB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RUFBRXRCLE1BRFY7QUFFRSxVQUFBLEdBQUcsRUFBRWlCLEdBRlA7QUFHRSxVQUFBLG9CQUFvQixFQUFFQyxvQkFIeEI7QUFJRSxVQUFBLGVBQWUsRUFBRUcsZUFKbkI7QUFLRSxVQUFBLFNBQVMsRUFBRSxtQkFBQU8sS0FBSztBQUFBLG1CQUFJUixVQUFTLENBQUNILEdBQUQsRUFBTSxPQUFOLEVBQWVXLEtBQWYsQ0FBYjtBQUFBO0FBTGxCLFVBREYsQ0FaSixDQTVCRixDQURGO0FBc0REO0FBM0dIO0FBQUE7QUFBQSxJQUFpQ1UsZ0JBQWpDLHlEQUNxQjtBQUNqQnJCLElBQUFBLEdBQUcsRUFBRXNCLHNCQUFVQyxNQURFO0FBRWpCcEMsSUFBQUEsT0FBTyxFQUFFbUMsc0JBQVVFLE9BQVYsQ0FBa0JGLHNCQUFVRyxHQUE1QixFQUFpQ0MsVUFGekI7QUFHakIzQyxJQUFBQSxNQUFNLEVBQUV1QyxzQkFBVUssTUFBVixDQUFpQkQsVUFIUjtBQUlqQnZCLElBQUFBLFNBQVMsRUFBRW1CLHNCQUFVTSxJQUFWLENBQWVGLFVBSlQ7QUFLakJ4QixJQUFBQSxZQUFZLEVBQUVvQixzQkFBVU0sSUFBVixDQUFlRixVQUxaO0FBTWpCM0IsSUFBQUEsYUFBYSxFQUFFdUIsc0JBQVVNLElBQVYsQ0FBZUYsVUFOYjtBQU9qQnRCLElBQUFBLGVBQWUsRUFBRWtCLHNCQUFVTSxJQUFWLENBQWVGLFVBUGY7QUFRakJ6QyxJQUFBQSxRQUFRLEVBQUVxQyxzQkFBVUssTUFSSDtBQVNqQkUsSUFBQUEsZ0JBQWdCLEVBQUVQLHNCQUFVTSxJQVRYO0FBVWpCM0IsSUFBQUEsb0JBQW9CLEVBQUVxQixzQkFBVVE7QUFWZixHQURyQjtBQTZHRDs7ZUFFYzVELGtCIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IChjKSAyMDE5IFViZXIgVGVjaG5vbG9naWVzLCBJbmMuXG4vL1xuLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxuLy8gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuLy8gaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xuLy8gdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuLy8gY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG4vLyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuLy9cbi8vIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluXG4vLyBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cbi8vXG4vLyBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG4vLyBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbi8vIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuLy8gQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuLy8gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbi8vIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU5cbi8vIFRIRSBTT0ZUV0FSRS5cblxuaW1wb3J0IFJlYWN0LCB7Q29tcG9uZW50fSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUHJvcFR5cGVzIGZyb20gJ3Byb3AtdHlwZXMnO1xuaW1wb3J0IHtjcmVhdGVTZWxlY3Rvcn0gZnJvbSAncmVzZWxlY3QnO1xuaW1wb3J0IHN0eWxlZCBmcm9tICdzdHlsZWQtY29tcG9uZW50cyc7XG5pbXBvcnQgUGFuZWxIZWFkZXJBY3Rpb24gZnJvbSAnY29tcG9uZW50cy9zaWRlLXBhbmVsL3BhbmVsLWhlYWRlci1hY3Rpb24nO1xuaW1wb3J0IEZpZWxkU2VsZWN0b3IgZnJvbSAnY29tcG9uZW50cy9jb21tb24vZmllbGQtc2VsZWN0b3InO1xuaW1wb3J0IHtUcmFzaCwgQ2xvY2t9IGZyb20gJ2NvbXBvbmVudHMvY29tbW9uL2ljb25zJztcbmltcG9ydCBTb3VyY2VEYXRhU2VsZWN0b3JGYWN0b3J5IGZyb20gJ2NvbXBvbmVudHMvc2lkZS1wYW5lbC9jb21tb24vc291cmNlLWRhdGEtc2VsZWN0b3InO1xuaW1wb3J0IHtTdHlsZWRQYW5lbEhlYWRlcn0gZnJvbSAnY29tcG9uZW50cy9jb21tb24vc3R5bGVkLWNvbXBvbmVudHMnO1xuXG5pbXBvcnQgU2luZ2xlU2VsZWN0RmlsdGVyRmFjdG9yeSBmcm9tICdjb21wb25lbnRzL2ZpbHRlcnMvc2luZ2xlLXNlbGVjdC1maWx0ZXInO1xuaW1wb3J0IE11bHRpU2VsZWN0RmlsdGVyRmFjdG9yeSBmcm9tICdjb21wb25lbnRzL2ZpbHRlcnMvbXVsdGktc2VsZWN0LWZpbHRlcic7XG5pbXBvcnQgVGltZVJhbmdlRmlsdGVyRmFjdG9yeSBmcm9tICdjb21wb25lbnRzL2ZpbHRlcnMvdGltZS1yYW5nZS1maWx0ZXInO1xuaW1wb3J0IFJhbmdlRmlsdGVyRmFjdG9yeSBmcm9tICdjb21wb25lbnRzL2ZpbHRlcnMvcmFuZ2UtZmlsdGVyJztcbmltcG9ydCB7RklMVEVSX1RZUEVTLCBGSUxURVJfQ09NUE9ORU5UU30gZnJvbSAndXRpbHMvZmlsdGVyLXV0aWxzJztcbmltcG9ydCB7QUxMX0ZJRUxEX1RZUEVTfSBmcm9tICdjb25zdGFudHMvZGVmYXVsdC1zZXR0aW5ncyc7XG5cbmNvbnN0IFN0eWxlZEZpbHRlclBhbmVsID0gc3R5bGVkLmRpdmBcbiAgbWFyZ2luLWJvdHRvbTogMTJweDtcbiAgYm9yZGVyLXJhZGl1czogMXB4O1xuXG4gIC5maWx0ZXItcGFuZWxfX2ZpbHRlciB7XG4gICAgbWFyZ2luLXRvcDogMjRweDtcbiAgfVxuYDtcblxuY29uc3QgU3R5bGVkRmlsdGVySGVhZGVyID0gc3R5bGVkKFN0eWxlZFBhbmVsSGVhZGVyKWBcbiAgY3Vyc29yOiBwb2ludGVyO1xuICBwYWRkaW5nOiAxMHB4IDEycHg7XG5cbiAgLmZpZWxkLXNlbGVjdG9yIHtcbiAgICB3aWR0aDogY2FsYygxMDAlIC0gNThweCk7XG4gIH1cbmA7XG5cbmNvbnN0IFN0eWxlZEZpbHRlckNvbnRlbnQgPSBzdHlsZWQuZGl2YFxuICBiYWNrZ3JvdW5kLWNvbG9yOiAke3Byb3BzID0+IHByb3BzLnRoZW1lLnBhbmVsQmFja2dyb3VuZH07XG4gIHBhZGRpbmc6IDEycHg7XG5gO1xuXG5GaWx0ZXJQYW5lbEZhY3RvcnkuZGVwcyA9IFtcbiAgU291cmNlRGF0YVNlbGVjdG9yRmFjdG9yeSxcbiAgU2luZ2xlU2VsZWN0RmlsdGVyRmFjdG9yeSxcbiAgTXVsdGlTZWxlY3RGaWx0ZXJGYWN0b3J5LFxuICBUaW1lUmFuZ2VGaWx0ZXJGYWN0b3J5LFxuICBSYW5nZUZpbHRlckZhY3Rvcnlcbl07XG5cbmZ1bmN0aW9uIEZpbHRlclBhbmVsRmFjdG9yeShcbiAgU291cmNlRGF0YVNlbGVjdG9yLFxuICBTaW5nbGVTZWxlY3RGaWx0ZXIsXG4gIE11bHRpU2VsZWN0RmlsdGVyLFxuICBUaW1lUmFuZ2VGaWx0ZXIsXG4gIFJhbmdlRmlsdGVyXG4pIHtcbiAgY29uc3QgRmlsdGVyQ29tcG9uZW50cyA9IHtcbiAgICBTaW5nbGVTZWxlY3RGaWx0ZXIsXG4gICAgTXVsdGlTZWxlY3RGaWx0ZXIsXG4gICAgVGltZVJhbmdlRmlsdGVyLFxuICAgIFJhbmdlRmlsdGVyXG4gIH07XG5cbiAgcmV0dXJuIGNsYXNzIEZpbHRlclBhbmVsIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgICAgaWR4OiBQcm9wVHlwZXMubnVtYmVyLFxuICAgICAgZmlsdGVyczogUHJvcFR5cGVzLmFycmF5T2YoUHJvcFR5cGVzLmFueSkuaXNSZXF1aXJlZCxcbiAgICAgIGZpbHRlcjogUHJvcFR5cGVzLm9iamVjdC5pc1JlcXVpcmVkLFxuICAgICAgc2V0RmlsdGVyOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgICAgcmVtb3ZlRmlsdGVyOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgICAgZW5sYXJnZUZpbHRlcjogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICAgIHRvZ2dsZUFuaW1hdGlvbjogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICAgIGRhdGFzZXRzOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgICAgc2hvd0RhdGFzZXRUYWJsZTogUHJvcFR5cGVzLmZ1bmMsXG4gICAgICBpc0FueUZpbHRlckFuaW1hdGluZzogUHJvcFR5cGVzLmJvb2xcbiAgICB9O1xuXG4gICAgLyogc2VsZWN0b3JzICovXG4gICAgZmllbGRzU2VsZWN0b3IgPSBwcm9wcyA9PlxuICAgICAgKHByb3BzLmZpbHRlci5kYXRhSWQgJiYgcHJvcHMuZGF0YXNldHNbcHJvcHMuZmlsdGVyLmRhdGFJZF0uZmllbGRzKSB8fCBbXTtcbiAgICBmaWx0ZXJTZWxlY3RvciA9IHByb3BzID0+IHByb3BzLmZpbHRlcnM7XG4gICAgbmFtZVNlbGVjdG9yID0gcHJvcHMgPT4gcHJvcHMuZmlsdGVyLm5hbWU7XG4gICAgZGF0YUlkU2VsZWN0b3IgPSBwcm9wcyA9PiBwcm9wcy5maWx0ZXIuZGF0YUlkO1xuXG4gICAgLy8gb25seSBzaG93IGN1cnJlbnQgZmllbGQgYW5kIGZpZWxkIHRoYXQncyBub3QgYWxyZWFkeSBiZWVuIHVzZWQgYXMgYSBmaWx0ZXJcbiAgICBhdmFpbGFibGVGaWVsZHNTZWxlY3RvciA9IGNyZWF0ZVNlbGVjdG9yKFxuICAgICAgdGhpcy5maWVsZHNTZWxlY3RvcixcbiAgICAgIHRoaXMuZmlsdGVyU2VsZWN0b3IsXG4gICAgICB0aGlzLm5hbWVTZWxlY3RvcixcbiAgICAgIHRoaXMuZGF0YUlkU2VsZWN0b3IsXG4gICAgICAoZmllbGRzLCBmaWx0ZXJzLCBuYW1lLCBkYXRhSWQpID0+XG4gICAgICAgIGZpZWxkcy5maWx0ZXIoXG4gICAgICAgICAgZiA9PlxuICAgICAgICAgICAgZi50eXBlICYmXG4gICAgICAgICAgICBmLnR5cGUgIT09IEFMTF9GSUVMRF9UWVBFUy5nZW9qc29uICYmXG4gICAgICAgICAgICAoZi5uYW1lID09PSBuYW1lIHx8XG4gICAgICAgICAgICAgICFmaWx0ZXJzLmZpbmQoZCA9PiBkLm5hbWUgPT09IGYubmFtZSAmJiBkLmRhdGFJZCA9PT0gZGF0YUlkKSlcbiAgICAgICAgKVxuICAgICk7XG5cbiAgICByZW5kZXIoKSB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIGRhdGFzZXRzLFxuICAgICAgICBlbmxhcmdlRmlsdGVyLFxuICAgICAgICBmaWx0ZXIsXG4gICAgICAgIGlkeCxcbiAgICAgICAgaXNBbnlGaWx0ZXJBbmltYXRpbmcsXG4gICAgICAgIHJlbW92ZUZpbHRlcixcbiAgICAgICAgc2V0RmlsdGVyLFxuICAgICAgICB0b2dnbGVBbmltYXRpb25cbiAgICAgIH0gPSB0aGlzLnByb3BzO1xuICAgICAgY29uc3Qge25hbWUsIGVubGFyZ2VkLCB0eXBlLCBkYXRhSWR9ID0gZmlsdGVyO1xuXG4gICAgICBjb25zdCBGaWx0ZXJDb21wb25lbnQgPSB0eXBlICYmIEZpbHRlckNvbXBvbmVudHNbRklMVEVSX0NPTVBPTkVOVFNbdHlwZV1dO1xuICAgICAgY29uc3QgYWxsQXZhaWxhYmxlRmllbGRzID0gdGhpcy5hdmFpbGFibGVGaWVsZHNTZWxlY3Rvcih0aGlzLnByb3BzKTtcblxuICAgICAgcmV0dXJuIChcbiAgICAgICAgPFN0eWxlZEZpbHRlclBhbmVsIGNsYXNzTmFtZT1cImZpbHRlci1wYW5lbFwiPlxuICAgICAgICAgIDxTdHlsZWRGaWx0ZXJIZWFkZXIgY2xhc3NOYW1lPVwiZmlsdGVyLXBhbmVsX19oZWFkZXJcIlxuICAgICAgICAgICAgbGFiZWxSQ0dDb2xvclZhbHVlcz17ZGF0YXNldHNbZGF0YUlkXS5jb2xvcn0+XG4gICAgICAgICAgICA8RmllbGRTZWxlY3RvclxuICAgICAgICAgICAgICBpbnB1dFRoZW1lPVwic2Vjb25kYXJ5XCJcbiAgICAgICAgICAgICAgZmllbGRzPXthbGxBdmFpbGFibGVGaWVsZHN9XG4gICAgICAgICAgICAgIHZhbHVlPXtuYW1lfVxuICAgICAgICAgICAgICBlcmFzYWJsZT17ZmFsc2V9XG4gICAgICAgICAgICAgIG9uU2VsZWN0PXt2YWx1ZSA9PiBzZXRGaWx0ZXIoaWR4LCAnbmFtZScsIHZhbHVlLm5hbWUpfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDxQYW5lbEhlYWRlckFjdGlvblxuICAgICAgICAgICAgICBpZD17ZmlsdGVyLmlkfVxuICAgICAgICAgICAgICB0b29sdGlwPVwiZGVsZXRlXCJcbiAgICAgICAgICAgICAgdG9vbHRpcFR5cGU9XCJlcnJvclwiXG4gICAgICAgICAgICAgIG9uQ2xpY2s9e3JlbW92ZUZpbHRlcn1cbiAgICAgICAgICAgICAgaG92ZXJDb2xvcj17J2Vycm9yQ29sb3InfVxuICAgICAgICAgICAgICBJY29uQ29tcG9uZW50PXtUcmFzaH1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgICB7dHlwZSA9PT0gRklMVEVSX1RZUEVTLnRpbWVSYW5nZSAmJiAoXG4gICAgICAgICAgICAgIDxQYW5lbEhlYWRlckFjdGlvblxuICAgICAgICAgICAgICAgIGlkPXtmaWx0ZXIuaWR9XG4gICAgICAgICAgICAgICAgb25DbGljaz17ZW5sYXJnZUZpbHRlcn1cbiAgICAgICAgICAgICAgICB0b29sdGlwPVwiVGltZSBQbGF5YmFja1wiXG4gICAgICAgICAgICAgICAgSWNvbkNvbXBvbmVudD17Q2xvY2t9XG4gICAgICAgICAgICAgICAgYWN0aXZlPXtlbmxhcmdlZH1cbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICl9XG4gICAgICAgICAgPC9TdHlsZWRGaWx0ZXJIZWFkZXI+XG4gICAgICAgICAgPFN0eWxlZEZpbHRlckNvbnRlbnQgY2xhc3NOYW1lPVwiZmlsdGVyLXBhbmVsX19jb250ZW50XCI+XG4gICAgICAgICAgICB7T2JqZWN0LmtleXMoZGF0YXNldHMpLmxlbmd0aCA+IDEgJiYgKFxuICAgICAgICAgICAgICA8U291cmNlRGF0YVNlbGVjdG9yXG4gICAgICAgICAgICAgICAgaW5wdXRUaGVtZT1cInNlY29uZGFyeVwiXG4gICAgICAgICAgICAgICAgZGF0YXNldHM9e2RhdGFzZXRzfVxuICAgICAgICAgICAgICAgIGRpc2FibGVkPXtmaWx0ZXIuZnJlZXplfVxuICAgICAgICAgICAgICAgIGRhdGFJZD17ZmlsdGVyLmRhdGFJZH1cbiAgICAgICAgICAgICAgICBvblNlbGVjdD17dmFsdWUgPT4gc2V0RmlsdGVyKGlkeCwgJ2RhdGFJZCcsIHZhbHVlKX1cbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICl9XG4gICAgICAgICAgICB7dHlwZSAmJlxuICAgICAgICAgICAgIWVubGFyZ2VkICYmIChcbiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmaWx0ZXItcGFuZWxfX2ZpbHRlclwiPlxuICAgICAgICAgICAgICAgIDxGaWx0ZXJDb21wb25lbnRcbiAgICAgICAgICAgICAgICAgIGZpbHRlcj17ZmlsdGVyfVxuICAgICAgICAgICAgICAgICAgaWR4PXtpZHh9XG4gICAgICAgICAgICAgICAgICBpc0FueUZpbHRlckFuaW1hdGluZz17aXNBbnlGaWx0ZXJBbmltYXRpbmd9XG4gICAgICAgICAgICAgICAgICB0b2dnbGVBbmltYXRpb249e3RvZ2dsZUFuaW1hdGlvbn1cbiAgICAgICAgICAgICAgICAgIHNldEZpbHRlcj17dmFsdWUgPT4gc2V0RmlsdGVyKGlkeCwgJ3ZhbHVlJywgdmFsdWUpfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA8L1N0eWxlZEZpbHRlckNvbnRlbnQ+XG4gICAgICAgIDwvU3R5bGVkRmlsdGVyUGFuZWw+XG4gICAgICApO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBGaWx0ZXJQYW5lbEZhY3Rvcnk7XG4iXX0=